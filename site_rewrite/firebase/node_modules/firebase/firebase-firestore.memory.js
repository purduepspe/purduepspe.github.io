!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function($l){"use strict";try{(function(){$l=$l&&Object.prototype.hasOwnProperty.call($l,"default")?$l.default:$l;var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var e,a,n,l=function(){return(l=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function c(t,s,a,u){return new(a=a||Promise)(function(e,n){function i(t){try{o(u.next(t))}catch(t){n(t)}}function r(t){try{o(u.throw(t))}catch(t){n(t)}}function o(t){t.done?e(t.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(t.value).then(i,r)}o((u=u.apply(t,s||[])).next())})}function y(n,i){var r,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=i.call(n,a)}catch(t){e=[6,t],o=0}finally{r=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i}(n=a=a||{})[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT";a.DEBUG,a.VERBOSE,a.INFO,a.WARN,a.ERROR,a.SILENT;function o(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var r=(new Date).toISOString(),o=h[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+r+"]  "+t.name+":"],n))}}var u=a.INFO,h=((e={})[a.DEBUG]="log",e[a.VERBOSE]="log",e[a.INFO]="info",e[a.WARN]="warn",e[a.ERROR]="error",e),f=(Object.defineProperty(p.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in a))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),p.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.DEBUG],t)),this._logHandler.apply(this,s([this,a.DEBUG],t))},p.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.VERBOSE],t)),this._logHandler.apply(this,s([this,a.VERBOSE],t))},p.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.INFO],t)),this._logHandler.apply(this,s([this,a.INFO],t))},p.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.WARN],t)),this._logHandler.apply(this,s([this,a.WARN],t))},p.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.ERROR],t)),this._logHandler.apply(this,s([this,a.ERROR],t))},p);function p(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var v,m=(t(g,v=Error),g);function g(t,e){var n=v.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,w.prototype.create),n}var w=(b.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=e[0]||{},r=this.service+"/"+t,o=this.errors[t],s=o?function(t,i){return t.replace(E,function(t,e){var n=i[e];return null!=n?n.toString():"<"+e+"?>"})}(o,i):"Error",a=this.serviceName+": "+s+" ("+r+").",u=new m(r,a),h=0,c=Object.keys(i);h<c.length;h++){var l=c[h];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=i[l])}return u},b);function b(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,I=(T.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},T.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},T.prototype.setServiceProps=function(t){return this.serviceProps=t,this},T);function T(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var N,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=S||{},k=A;function R(t){return"string"==typeof t}function _(t){return"number"==typeof t}function D(t,e){t=t.split("."),e=e||k;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function O(){}function C(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function L(t){return"array"==C(t)}function V(t){var e=C(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var U="closure_uid_"+(1e9*Math.random()>>>0),M=0;function F(t,e,n){return t.call.apply(t.bind,arguments)}function x(e,n,t){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,i),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?F:x).apply(null,arguments)}function j(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var G=Date.now||function(){return+new Date};function B(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return o.prototype[e].apply(t,i)}}function H(){this.j=this.j,this.i=this.i}H.prototype.j=!1,H.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[U]||(this[U]=++M)},H.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var z=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(R(t))return R(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Q=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,r=R(t)?t.split(""):t,o=0;o<i;o++)o in r&&e.call(n,r[o],o,t)};function Y(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),i=0;i<e;i++)n[i]=t[i];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var X,J=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function $(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:e<t?1:0}t:{var tt=k.navigator;if(tt){var et=tt.userAgent;if(et){X=et;break t}}X=""}function nt(t,e,n){for(var i in t)e.call(n,t[i],i,t)}function it(t){var e,n={};for(e in t)n[e]=t[e];return n}var rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ot(t,e){for(var n,i,r=1;r<arguments.length;r++){for(n in i=arguments[r])t[n]=i[n];for(var o=0;o<rt.length;o++)n=rt[o],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function st(t){return st[" "](t),t}st[" "]=O;var at,ut,ht=$(X,"Opera"),ct=$(X,"Trident")||$(X,"MSIE"),lt=$(X,"Edge"),ft=lt||ct,pt=$(X,"Gecko")&&!($(X.toLowerCase(),"webkit")&&!$(X,"Edge"))&&!($(X,"Trident")||$(X,"MSIE"))&&!$(X,"Edge"),dt=$(X.toLowerCase(),"webkit")&&!$(X,"Edge");function yt(){var t=k.document;return t?t.documentMode:void 0}t:{var vt="",mt=(ut=X,pt?/rv:([^\);]+)(\)|;)/.exec(ut):lt?/Edge\/([\d\.]+)/.exec(ut):ct?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ut):dt?/WebKit\/(\S+)/.exec(ut):ht?/(?:Version)[ \/]?(\S+)/.exec(ut):void 0);if(mt&&(vt=mt?mt[1]:""),ct){var gt=yt();if(null!=gt&&gt>parseFloat(vt)){at=String(gt);break t}}at=vt}var wt,bt={};function Et(a){return function(t,e){var n=bt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(a,function(){for(var t=0,e=J(String(at)).split("."),n=J(String(a)).split("."),i=Math.max(e.length,n.length),r=0;0==t&&r<i;r++){var o=e[r]||"",s=n[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Z(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Z(0==o[2].length,0==s[2].length)||Z(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t})}var It=k.document;wt=It&&ct?yt()||("CSS1Compat"==It.compatMode?parseInt(at,10):5):void 0;var Tt=!ct||9<=Number(wt),Nt=ct&&!Et("9"),At=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{k.addEventListener("test",O,e),k.removeEventListener("test",O,e)}catch(t){}return t}();function St(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function kt(t,e){if(St.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(pt){t:{try{st(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=R(t.pointerType)?t.pointerType:Rt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}St.prototype.b=function(){this.Ia=!1},B(kt,St);var Rt={2:"touch",3:"pen",4:"mouse"};kt.prototype.b=function(){kt.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Nt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var _t="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Ot(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.da=r,this.key=++Dt,this.X=this.Z=!1}function Ct(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Lt(t){this.src=t,this.a={},this.b=0}function Vt(t,e){var n=e.type;if(n in t.a){var i,r=t.a[n],o=z(r,e);(i=0<=o)&&Array.prototype.splice.call(r,o,1),i&&(Ct(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Pt(t,e,n,i){for(var r=0;r<t.length;++r){var o=t[r];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==i)return r}return-1}Lt.prototype.add=function(t,e,n,i,r){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Pt(t,e,i,r);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Ot(e,this.src,o,!!i,r)).Z=n,t.push(e)),e};var Ut="closure_lm_"+(1e6*Math.random()|0),Mt={};function Ft(t,e,n,i,r){if(i&&i.once)return function t(e,n,i,r,o){if(L(n)){for(var s=0;s<n.length;s++)t(e,n[s],i,r,o);return null}i=Qt(i);return e&&e[_t]?e.Aa(n,i,P(r)?!!r.capture:!!r,o):xt(e,n,i,!0,r,o)}(t,e,n,i,r);if(L(e)){for(var o=0;o<e.length;o++)Ft(t,e[o],n,i,r);return null}return n=Qt(n),t&&t[_t]?t.za(e,n,P(i)?!!i.capture:!!i,r):xt(t,e,n,!1,i,r)}function xt(t,e,n,i,r,o){if(!e)throw Error("Invalid event type");var s=P(r)?!!r.capture:!!r;if(s&&!Tt)return null;var a=Ht(t);if(a||(t[Ut]=a=new Lt(t)),(n=a.add(e,n,i,s,o)).proxy)return n;if(i=function(){var e=Bt,n=Tt?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=i).src=t,i.listener=n,t.addEventListener)At||(r=s),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(jt(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function qt(t){if(!_(t)&&t&&!t.X){var e=t.src;if(e&&e[_t])Vt(e.c,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(jt(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=Ht(e))?(Vt(n,t),0==n.b&&(n.src=null,e[Ut]=null)):Ct(t)}}}function jt(t){return t in Mt?Mt[t]:Mt[t]="on"+t}function Gt(t,e){var n=t.listener,i=t.da||t.src;return t.Z&&qt(t),n.call(i,e)}function Bt(t,e){return!!t.X||(Tt?Gt(t,new kt(e,this)):Gt(t,e=new kt(e||D("window.event"),this)))}function Ht(t){return(t=t[Ut])instanceof Lt?t:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Qt(e){return"function"==C(e)?e:(e[zt]||(e[zt]=function(t){return e.handleEvent(t)}),e[zt])}function Yt(){H.call(this),this.c=new Lt(this),(this.J=this).B=null}function Wt(t,e,n,i){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var r=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Vt(t.c,s),r=!1!==a.call(u,i)&&r}}return r&&0!=i.Ia}B(Yt,H),Yt.prototype[_t]=!0,(N=Yt.prototype).addEventListener=function(t,e,n,i){Ft(this,t,e,n,i)},N.removeEventListener=function(t,e,n,i){!function t(e,n,i,r,o){if(L(n))for(var s=0;s<n.length;s++)t(e,n[s],i,r,o);else r=P(r)?!!r.capture:!!r,i=Qt(i),e&&e[_t]?(e=e.c,(n=String(n).toString())in e.a&&-1<(i=Pt(s=e.a[n],i,r,o))&&(Ct(s[i]),Array.prototype.splice.call(s,i,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ht(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Pt(n,i,r,o)),(i=-1<e?n[e]:null)&&qt(i))}(this,t,e,n,i)},N.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var i=t.type||t;if(R(t))t=new St(t,n);else if(t instanceof St)t.target=t.target||n;else{var r=t;ot(t=new St(i,n),r)}if(r=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];r=Wt(s,i,!0,t)&&r}if(r=Wt(s=t.a=n,i,!0,t)&&r,r=Wt(s,i,!1,t)&&r,e)for(o=0;o<e.length;o++)r=Wt(s=t.a=e[o],i,!1,t)&&r;return r},N.G=function(){if(Yt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],i=0;i<n.length;i++)Ct(n[i]);delete e.a[t],e.b--}}this.B=null},N.za=function(t,e,n,i){return this.c.add(String(t),e,!1,n,i)},N.Aa=function(t,e,n,i){return this.c.add(String(t),e,!0,n,i)};var Kt=k.JSON.stringify;function Xt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Jt(){this.b=this.a=null}Xt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var $t,Zt=new Xt(function(){return new te},function(t){t.reset()});function te(){this.next=this.b=this.a=null}function ee(t){k.setTimeout(function(){throw t},0)}function ne(t,e){$t||function(){var t=k.Promise.resolve(void 0);$t=function(){t.then(oe)}}(),ie||($t(),ie=!0),re.add(t,e)}Jt.prototype.add=function(t,e){var n=Zt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},te.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ie=!(te.prototype.reset=function(){this.next=this.b=this.a=null}),re=new Jt;function oe(){for(var t;i=n=void 0,i=null,(n=re).a&&(i=n.a,n.a=n.a.next,n.a||(n.b=null),i.next=null),t=i;){try{t.a.call(t.b)}catch(t){ee(t)}var e=Zt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,i;ie=!1}function se(t,e){Yt.call(this),this.b=t||1,this.a=e||k,this.f=q(this.gb,this),this.g=G()}function ae(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ue(t,e,n){if("function"==C(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:k.setTimeout(t,e||0)}function he(t,e,n){H.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function ce(t){t.U=ue(t.b,t.c),t.f.apply(null,t.a)}function le(t){H.call(this),this.b=t,this.a={}}B(se,Yt),(N=se.prototype).ba=!1,N.L=null,N.gb=function(){if(this.ba){var t=G()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(ae(this),this.start()))}},N.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=G())},N.G=function(){se.N.G.call(this),ae(this),delete this.a},B(he,H),(N=he.prototype).ea=!1,N.U=null,N.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ce(this)},N.G=function(){he.N.G.call(this),this.U&&(k.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},N.$a=function(){this.U=null,this.ea&&(this.ea=!1,ce(this))},B(le,H);var fe=[];function pe(t,e,n,i){L(n)||(n&&(fe[0]=n.toString()),n=fe);for(var r=0;r<n.length;r++){var o=Ft(e,n[r],i||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function de(t){nt(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function ye(){}le.prototype.G=function(){le.N.G.call(this),de(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ve=new Yt;function me(t){St.call(this,"serverreachability",t)}function ge(t){ve.dispatchEvent(new me(ve,t))}function we(t){St.call(this,"statevent",t)}function be(t){ve.dispatchEvent(new we(ve,t))}function Ee(t){St.call(this,"timingevent",t)}function Ie(t,e){if("function"!=C(t))throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){t()},e)}B(me,St),B(we,St),B(Ee,St);var Te={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,La:7,TIMEOUT:8,sb:9},Ne={jb:"complete",wb:"success",Ma:"error",La:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Ae(){}function Se(t){var e;return(e=t.a)||(e=t.a={}),e}function ke(){}Ae.prototype.a=null;var Re,_e={OPEN:"a",ib:"b",Ma:"c",rb:"d"};function De(){St.call(this,"d")}function Oe(){St.call(this,"c")}function Ce(){}function Le(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new le(this),this.O=Ve,t=ft?125:void 0,this.P=new se(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}B(De,St),B(Oe,St),B(Ce,Ae),Re=new Ce;var Ve=45e3,Pe={},Ue={};function Me(t,e,n){t.F=1,t.f=hn(en(e)),t.l=n,t.H=!0,xe(t,null)}function Fe(t,e,n,i){t.F=1,t.f=hn(en(e)),t.l=null,t.H=n,xe(t,i)}function xe(t,e){t.v=G(),Ge(t),t.D=en(t.f),un(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new he(q(t.Ja,t,t.a),t.J)),pe(t.I,t.a,"readystatechange",t.cb),e=t.h?it(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ge(1)}function qe(t,e,n){for(var i=!0;!t.m&&t.A<n.length;){var r=je(t,n);if(r==Ue){4==e&&(t.c=4,be(14),i=!1);break}if(r==Pe){t.c=4,be(15),i=!1;break}Ye(t,r)}4==e&&0==n.length&&(t.c=1,be(16),i=!1),t.b=t.b&&i,i||(Qe(t),ze(t))}function je(t,e){var n=t.A,i=e.indexOf("\n",n);return-1==i?Ue:(n=Number(e.substring(n,i)),isNaN(n)?Pe:(i+=1)+n>e.length?Ue:(e=e.substr(i,n),t.A=i+n,e))}function Ge(t){t.R=G()+t.O,Be(t,t.O)}function Be(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Ie(q(t.ab,t),e)}function He(t){t.i&&(k.clearTimeout(t.i),t.i=null)}function ze(t){t.g.Ca()||t.m||t.g.na(t)}function Qe(t){He(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,ae(t.P),de(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Ye(t,e){try{t.g.Fa(t,e),ge(4)}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(V(t)||R(t))Q(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(V(t)||R(t)){n=[];for(var i=t.length,r=0;r<i;r++)n.push(r)}else for(r in n=[],i=0,t)n[i++]=r;r=(i=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(R(t))return t.split("");if(V(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t)).length;for(var o=0;o<r;o++)e.call(void 0,i[o],n&&n[o],t)}}function Ke(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof Ke)for(n=t.K(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function Xe(t,e){$e(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Je(t))}function Je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var i=t.a[e];$e(t.b,i)&&(t.a[n++]=i),e++}t.a.length=n}if(t.c!=t.a.length){var r={};for(n=e=0;e<t.a.length;)$e(r,i=t.a[e])||(r[t.a[n++]=i]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Le.prototype).setTimeout=function(t){this.O=t},N.cb=function(t){t=t.target;var e=this.B;e&&3==ei(t)?e.Ta():this.Ja(t)},N.Ja=function(t){try{if(t==this.a)t:{var e=ei(this.a),n=this.a.ya(),i=this.a.T();if(!(e<3||3==e&&!ft&&!this.a.aa())){this.m||4!=e||7==n||ge(8==n||i<=0?3:2),He(this);var r=this.a.T();this.o=r;var o=this.a.aa();if(this.b=200==r){if(this.S&&!this.s){e:{if(this.a){var s=ni(this.a,"X-HTTP-Initial-Response");if(s&&!K(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,be(12),Qe(this),ze(this);break t}this.s=!0,Ye(this,a)}this.H?(qe(this,e,o),ft&&this.b&&3==e&&(pe(this.I,this.P,"tick",this.bb),this.P.start())):Ye(this,o),4==e&&Qe(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Ge(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.c=3,be(12)):(this.c=0,be(13)),Qe(this),ze(this)}}}catch(t){}},N.bb=function(){if(this.a){var t=ei(this.a),e=this.a.aa();this.A<e.length&&(He(this),qe(this,t,e),this.b&&4!=t&&Ge(this))}},N.cancel=function(){this.m=!0,Qe(this)},N.ab=function(){this.i=null;var t=G();0<=t-this.R?(2!=this.F&&(ge(3),be(17)),Qe(this),this.c=2,ze(this)):Be(this,this.R-t)},(N=Ke.prototype).C=function(){Je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.K=function(){return Je(this),this.a.concat()},N.get=function(t,e){return $e(this.b,t)?this.b[t]:e},N.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.K(),i=0;i<n.length;i++){var r=n[i],o=this.get(r);t.call(e,o,r,this)}};var Ze=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tn(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof tn?(this.h=void 0!==e?e:t.h,nn(this,t.f),this.j=t.j,rn(this,t.b),on(this,t.i),this.a=t.a,sn(this,Tn(t.c)),this.g=t.g):t&&(n=String(t).match(Ze))?(this.h=!!e,nn(this,n[1]||"",!0),this.j=cn(n[2]||""),rn(this,n[3]||"",!0),on(this,n[4]),this.a=cn(n[5]||"",!0),sn(this,n[6]||"",!0),this.g=cn(n[7]||"")):(this.h=!!e,this.c=new gn(null,this.h))}function en(t){return new tn(t)}function nn(t,e,n){t.f=n?cn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function rn(t,e,n){t.b=n?cn(e,!0):e}function on(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function sn(t,e,n){e instanceof gn?(t.c=e,function(t,e){e&&!t.f&&(wn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(bn(this,e),In(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=ln(e,vn)),t.c=new gn(e,t.h))}function an(t,e,n){t.c.set(e,n)}function un(t,e,n){L(n)||(n=[String(n)]),In(t.c,e,n)}function hn(t){return an(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^G()).toString(36)),t}function cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ln(t,e,n){return R(t)?(t=encodeURI(t).replace(e,fn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function fn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}tn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(ln(e,pn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(ln(e,pn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(ln(n,"/"==n.charAt(0)?yn:dn,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",ln(n,mn)),t.join("")},tn.prototype.resolve=function(t){var e=en(this),n=!!t.f;n?nn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?rn(e,t.b):n=null!=t.i;var i=t.a;if(n)on(e,t.i);else if(n=!!t.a){if("/"!=i.charAt(0))if(this.b&&!this.a)i="/"+i;else{var r=e.a.lastIndexOf("/");-1!=r&&(i=e.a.substr(0,r+1)+i)}if(".."==(r=i)||"."==r)i="";else if($(r,"./")||$(r,"/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");for(var o=[],s=0;s<r.length;){var a=r[s++];"."==a?i&&s==r.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),i&&s==r.length&&o.push("")):(o.push(a),i=!0)}i=o.join("/")}else i=r}return n?e.a=i:n=""!==t.c.toString(),n?sn(e,Tn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var pn=/[#\/\?@]/g,dn=/[#\?:]/g,yn=/[#\?]/g,vn=/[#\?@]/g,mn=/#/g;function gn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function wn(n){n.a||(n.a=new Ke,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var o=t[n].substring(0,i);r=t[n].substring(i+1)}else o=t[n];e(o,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function bn(t,e){wn(t),e=Nn(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Xe(t.a,e))}function En(t,e){return wn(t),e=Nn(t,e),$e(t.a.b,e)}function In(t,e,n){bn(t,e),0<n.length&&(t.c=null,t.a.set(Nn(t,e),W(n)),t.b+=n.length)}function Tn(t){var e=new gn;return e.c=t.c,t.a&&(e.a=new Ke(t.a),e.b=t.b),e}function Nn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function An(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Sn(t){var e=t.a.F.a;if(null!=e)be(4),e?(be(10),di(t.a,t,!1)):(be(11),di(t.a,t,!0));else{t.b=new Le(t,void 0,void 0),t.b.h=t.h,e=wi(e=t.a,e.Y()?t.f:null,t.i),be(4),un(e,"TYPE","xmlhttp");var n=t.a.j,i=t.a.I;n&&i&&an(e,n,i),Fe(t.b,e,!1,t.f)}}function kn(){this.a=this.b=null}function Rn(){this.a=new Ke}function _n(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[U]||(t[U]=++M)):e.charAt(0)+t}function Dn(t,e){this.b=t,this.a=e}function On(t){this.g=t||Cn,t=k.PerformanceNavigationTiming?0<(t=k.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(k.ka&&k.ka.Da&&k.ka.Da()&&k.ka.Da().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Rn),this.b=null,this.c=[]}(N=gn.prototype).add=function(t,e){wn(this),this.c=null,t=Nn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,i){wn(this),this.a.forEach(function(t,e){Q(t,function(t){n.call(i,t,e,this)},this)},this)},N.K=function(){wn(this);for(var t=this.a.C(),e=this.a.K(),n=[],i=0;i<e.length;i++)for(var r=t[i],o=0;o<r.length;o++)n.push(e[i]);return n},N.C=function(t){wn(this);var e=[];if(R(t))En(this,t)&&(e=Y(e,this.a.get(Nn(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Y(e,t[n])}return e},N.set=function(t,e){return wn(this),this.c=null,En(this,t=Nn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var i=e[n],r=encodeURIComponent(String(i));i=this.C(i);for(var o=0;o<i.length;o++){var s=r;""!==i[o]&&(s+="="+encodeURIComponent(String(i[o]))),t.push(s)}}return this.c=t.join("&")},B(function(){},function(){}),(N=An.prototype).M=null,N.$=function(t){return this.a.$(t)},N.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},N.Ca=function(){return!1},N.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=ni(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=ni(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var i=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void mi(e,2)}this.f=i[0]}else(e=this.a).m=this.c,mi(e,2)}else 1==this.M&&(this.g?be(6):"11111"==e?(be(5),this.g=!0,(!ct||10<=Number(wt))&&(this.c=200,this.b.cancel(),be(11),di(this.a,this,!0))):(be(7),this.g=!1))},N.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Sn(this)):1==this.M&&(this.g?(be(11),di(this.a,this,!0)):(be(10),di(this.a,this,!1)));else{0==this.M?be(8):1==this.M&&be(9);var t=this.a;t.m=this.c,mi(t,2)}},N.Y=function(){return this.a.Y()},N.ma=function(){return this.a.ma()},Rn.prototype.add=function(t){this.a.set(_n(t),t)},Rn.prototype.C=function(){return this.a.C()};var Cn=10;function Ln(t,e){!t.a&&($(e,"spdy")||$(e,"quic")||$(e,"h2"))&&(t.f=t.g,t.a=new Rn,t.b&&(Mn(t,t.b),t.b=null))}function Vn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Pn(t){return t.b?1:t.a?t.a.a.c:0}function Un(t,e){return t=t.b?t.b==e:!!t.a&&(e=_n(e),$e(t.a.a.b,e))}function Mn(t,e){t.a?t.a.add(e):t.b=e}function Fn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=_n(e),n=$e(t.a.a.b,n)),n&&Xe(t.a.a,_n(e)))}function xn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return W(t.c);var e=t.c;return Q(t.a.C(),function(t){e=e.concat(t.j)}),e}function qn(){}function jn(){this.a=new qn}function Gn(t,i,e){var r=e||"";try{We(t,function(t,e){var n=t;P(t)&&(n=Kt(t)),i.push(r+e+"="+encodeURIComponent(n))})}catch(t){throw i.push(r+"type="+encodeURIComponent("_badmap")),t}}function Bn(t,e,n,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(t){}}On.prototype.cancel=function(){this.c=xn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Q(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},qn.prototype.stringify=function(t){return k.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return k.JSON.parse(t,void 0)};var Hn=k.JSON.parse;function zn(t){Yt.call(this),this.headers=new Ke,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Qn,this.D=this.F=!1}B(zn,Yt);var Qn="",Yn=/^https?$/i,Wn=["POST","PUT"];function Kn(t){return"content-type"==t.toLowerCase()}function Xn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Jn(t),Zn(t)}function Jn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function $n(t){if(t.b&&void 0!==S&&(!t.s[1]||4!=ei(t)||2!=t.T()))if(t.l&&4==ei(t))ue(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==ei(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break t;default:i=!1}if(!(e=i)){var r;if(r=0===n){var o=String(t.A).match(Ze)[1]||null;if(!o&&k.self&&k.self.location){var s=k.self.location.protocol;o=s.substr(0,s.length-1)}r=!Yn.test(o?o.toLowerCase():"")}e=r}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<ei(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",Jn(t)}}finally{Zn(t)}}}function Zn(t,e){if(t.a){ti(t);var n=t.a,i=t.s[0]?O:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=i}catch(t){}}}function ti(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(k.clearTimeout(t.m),t.m=null)}function ei(t){return t.a?t.a.readyState:0}function ni(t,e){return t.a?t.a.getResponseHeader(e):null}function ii(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}if(i)return t;if(n=function(t){var n="";return nt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),R(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(i=t.indexOf("?"))<0||n<i){i=n;var r=""}else r=t.substring(i+1,n);n=(t=[t.substr(0,i),r,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return an(t,e,n),t}function ri(t){this.f=[],this.F=new kn,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!D("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=D("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=D("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=D("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=D("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new On(t&&t.concurrentRequestLimit),this.ja=new jn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function oi(t){if(si(t),3==t.u){var e=t.P++,n=en(t.B);an(n,"SID",t.H),an(n,"RID",e),an(n,"TYPE","terminate"),ci(t,n),(e=new Le(t,e,void 0)).F=2,e.f=hn(en(n)),n=!1,k.navigator&&k.navigator.sendBeacon&&(n=k.navigator.sendBeacon(e.f.toString(),"")),!n&&k.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=G(),Ge(e)}gi(t)}function si(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(k.clearTimeout(t.l),t.l=null),yi(t),t.b.cancel(),t.h&&(_(t.h)&&k.clearTimeout(t.h),t.h=null)}function ai(t,e){t.f.push(new Dn(t.Qa++,e)),3==t.u&&ui(t)}function ui(t){Vn(t.b)||t.h||(t.h=!0,ne(t.Ha,t),t.A=0)}function hi(t,e){var n;n=e?e.W:t.P++;var i=en(t.B);an(i,"SID",t.H),an(i,"RID",n),an(i,"AID",t.O),ci(t,i),t.g&&t.i&&ii(i,t.g,t.i),n=new Le(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=li(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Mn(t.b,n),Me(n,i,e)}function ci(t,n){t.c&&We({},function(t,e){an(n,e,t)})}function li(t,e,n){n=Math.min(t.f.length,n);var i=t.c?q(t.c.Sa,t.c,t):null;t:for(var r=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=r[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var h=r[u].b,c=r[u].a;if((h-=o)<0)o=Math.max(0,r[u].b-100),a=!1;else try{Gn(c,s,"req"+h+"_")}catch(t){i&&i(c)}}if(a){i=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,i}function fi(t){t.a||t.l||(t.S=1,ne(t.Ga,t),t.v=0)}function pi(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=Ie(q(t.Ga,t),vi(t,t.v)),t.v++,!0)}function di(t,e,n){var i=e.l;i&&Ln(t.b,i),t.ia=t.oa&&n,t.m=e.c,t.B=wi(t,null,t.ha),ui(t)}function yi(t){null!=t.s&&(k.clearTimeout(t.s),t.s=null)}function vi(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function mi(t,e){if(2==e){var n=null;t.c&&(n=null);var i=q(t.eb,t);n||(n=new tn("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||nn(n,"https"),hn(n)),function(t,e){var n=new ye;if(k.Image){var i=new Image;i.onload=j(Bn,n,i,"TestLoadImage: loaded",!0,e),i.onerror=j(Bn,n,i,"TestLoadImage: error",!1,e),i.onabort=j(Bn,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=j(Bn,n,i,"TestLoadImage: timeout",!1,e),k.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=t}else e(!1)}(n.toString(),i)}else be(2);t.u=0,t.c&&t.c.ta(e),gi(t),si(t)}function gi(t){t.u=0,t.m=-1,t.c&&(0==xn(t.b).length&&0==t.f.length||(t.b.c.length=0,W(t.f),t.f.length=0),t.c.sa())}function wi(t,e,n){var i=function(t){return t instanceof tn?en(t):new tn(t,void 0)}(n);if(""!=i.b)e&&rn(i,e+"."+i.b),on(i,i.i);else{var r,o=k.location;r=e?e+"."+o.hostname:o.hostname,i=function(t,e,n,i){var r=new tn(null,void 0);return t&&nn(r,t),e&&rn(r,e),n&&on(r,n),i&&(r.a=i),r}(o.protocol,r,+o.port,n)}return t.V&&nt(t.V,function(t,e){an(i,e,t)}),e=t.j,n=t.I,e&&n&&an(i,e,n),an(i,"VER",t.wa),ci(t,i),i}function bi(){}function Ei(){if(ct&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function Ii(t,e){Yt.call(this),this.a=new ri(e),this.g=t,this.m=e&&e.fb?e.fb:function(t){for(var e=t,n=1;n<arguments.length;n++){var i,r=arguments[n];if(0==r.lastIndexOf("/",0))e=r;else(i=""==e)||(i=0<=(i=e.length-1)&&e.indexOf("/",i)==i),e+=i?r:"/"+r}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Ai(this)}function Ti(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ni(){Oe.call(this),this.status=1}function Ai(t){this.a=t}(N=zn.prototype).ca=function(t,e,n,i){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Se(this.H):Se(Re),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Xn(this,t)}t=n||"";var r=new Ke(this.headers);i&&We(i,function(t,e){r.set(e,t)}),i=function(t){t:{for(var e=Kn,n=t.length,i=R(t)?t.split(""):t,r=0;r<n;r++)if(r in i&&e.call(void 0,i[r],r,t)){e=r;break t}e=-1}return e<0?null:R(t)?t.charAt(e):t[e]}(r.K()),n=k.FormData&&t instanceof k.FormData,0<=z(Wn,e)&&!i&&!n&&r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{ti(this),0<this.o&&((this.D=function(t){return ct&&Et(9)&&_(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=ue(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Xn(this,t)}},N.Ba=function(){void 0!==S&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Zn(this))},N.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Zn(this,!0)),zn.N.G.call(this)},N.Ea=function(){this.j||(this.w||this.l||this.g?$n(this):this.Za())},N.Za=function(){$n(this)},N.T=function(){try{return 2<ei(this)?this.a.status:-1}catch(t){return-1}},N.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Hn(e)}},N.ya=function(){return this.h},N.Xa=function(){return R(this.f)?this.f:String(this.f)},(N=ri.prototype).wa=8,N.u=1,N.Ca=function(){return 0==this.u},N.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Le(this,t,void 0),i=this.i;if(this.J&&(i?ot(i=it(i),this.J):i=this.J),null===this.g&&(n.h=i),this.W)t:{for(var r=e=0;r<this.f.length;r++){var o=this.f[r];if(void 0===(o="__data__"in o.a&&R(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=r;break t}if(4096===e||r===this.f.length-1){e=r+1;break t}}e=1e3}else e=1e3;e=li(this,n,e),an(r=en(this.B),"RID",t),an(r,"CVER",22),this.o&&this.j&&an(r,"X-HTTP-Session-Id",this.j),ci(this,r),this.g&&i&&ii(r,this.g,i),Mn(this.b,n),this.W?(an(r,"$req",e),an(r,"SID","null"),n.S=!0,Me(n,r,null)):Me(n,r,e),this.u=2}}else 3==this.u&&(t?hi(this,t):0==this.f.length||Vn(this.b)||hi(this))},N.Ga=function(){this.l=null,this.a=new Le(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=en(this.pa);an(t,"RID","rpc"),an(t,"SID",this.H),an(t,"CI",this.ia?"0":"1"),an(t,"AID",this.O),ci(this,t),an(t,"TYPE","xmlhttp"),this.g&&this.i&&ii(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Fe(this.a,t,!0,this.ga)},N.Fa=function(t,e){if(0!=this.u&&(this.a==t||Un(this.b,t)))if(this.m=t.o,!t.s&&Un(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(L(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;yi(this),this.a.cancel(),this.a=null}pi(this),be(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=Ie(q(this.Ya,this),6e3));if(Pn(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else mi(this,11)}else if(!t.s&&this.a!=t||yi(this),!K(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var i=e[n];if(this.O=i[0],i=i[1],2==this.u)if("c"==i[0]){this.H=i[1],this.ga=i[2];var r=i[3];null!=r&&(this.wa=r),null!=(i=i[5])&&_(i)&&0<i&&(this.D=1.5*i),this.o&&(i=t.a)&&((r=ni(i,"X-Client-Wire-Protocol"))&&Ln(this.b,r),this.j&&(i=ni(i,"X-HTTP-Session-Id")))&&(this.I=i,an(this.B,this.j,i)),this.u=3,this.c&&this.c.va(),i=t,this.pa=wi(this,this.Y()?this.ga:null,this.ha),i.s?(Fn(this.b,i),(r=this.D)&&i.setTimeout(r),i.i&&(He(i),Ge(i)),this.a=i):fi(this),0<this.f.length&&ui(this)}else"stop"!=i[0]&&"close"!=i[0]||mi(this,7);else 3==this.u&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?mi(this,7):oi(this):"noop"!=i[0]&&this.c&&this.c.ua(i),this.v=0)}},N.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,pi(this),be(19))},N.na=function(t){var e=null;if(this.a==t){yi(this),this.a=null;var n=2}else{if(!Un(this.b,t))return;e=t.j,Fn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=G()-t.v,ve.dispatchEvent(new Ee(ve,t.l?t.l.length:0,e,this.A)),ui(this)):fi(this);else{var i=t.c;if(3==i||0==i&&0<this.m||!(1==n&&function(t,e){return!(Pn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=Ie(q(t.Ha,t,e),vi(t,t.A)),t.A++,!0))}(this,t)||2==n&&pi(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),i){case 1:mi(this,5);break;case 4:mi(this,10);break;case 3:mi(this,6);break;default:mi(this,2)}}},N.eb=function(t){be(t?2:1)},N.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new zn(this.Ka)).F=this.R,t},N.ma=function(){return!!this.c&&!0},N.Y=function(){return this.R},(N=bi.prototype).va=function(){},N.ua=function(){},N.ta=function(){},N.sa=function(){},N.Sa=function(){},Ei.prototype.a=function(t,e){return new Ii(t,e)},B(Ii,Yt),(N=Ii.prototype).addEventListener=function(t,e,n,i){Ii.N.addEventListener.call(this,t,e,n,i)},N.removeEventListener=function(t,e,n,i){Ii.N.removeEventListener.call(this,t,e,n,i)},N.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,i=this.b||void 0;be(0),t.ha=n,t.V=i||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new An(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=ii(e,t.g,t.i)),(t=t.w).i=n,e=wi(t.a,null,t.i),be(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Sn(t)):(un(e,"MODE","init"),!t.a.o&&t.a.j&&un(e,"X-HTTP-Session-Id",t.a.j),t.b=new Le(t,void 0,void 0),t.b.h=t.h,Fe(t.b,e,!1,null),t.M=0)},N.close=function(){oi(this.a)},N.Wa=function(t){if(R(t)){var e={};e.__data__=t,ai(this.a,e)}else this.h?((e={}).__data__=Kt(t),ai(this.a,e)):ai(this.a,t)},N.G=function(){this.a.c=null,delete this.f,oi(this.a),delete this.a,Ii.N.G.call(this)},B(Ti,De),B(Ni,Oe),B(Ai,bi),Ai.prototype.va=function(){this.a.dispatchEvent("a")},Ai.prototype.ua=function(t){this.a.dispatchEvent(new Ti(t))},Ai.prototype.ta=function(t){this.a.dispatchEvent(new Ni(t))},Ai.prototype.sa=function(){this.a.dispatchEvent("b")};var Si=j(function(t,e){function n(){}n.prototype=t.prototype;var i=new n;return t.apply(i,Array.prototype.slice.call(arguments,1)),i},Ei);Ei.prototype.createWebChannel=Ei.prototype.a,Ii.prototype.send=Ii.prototype.Wa,Ii.prototype.open=Ii.prototype.Va,Ii.prototype.close=Ii.prototype.close,Te.NO_ERROR=0,Te.TIMEOUT=8,Te.HTTP_ERROR=6,Ne.COMPLETE="complete",(ke.EventType=_e).OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",Yt.prototype.listen=Yt.prototype.za,zn.prototype.listenOnce=zn.prototype.Aa,zn.prototype.getLastError=zn.prototype.Xa,zn.prototype.getLastErrorCode=zn.prototype.ya,zn.prototype.getStatus=zn.prototype.T,zn.prototype.getResponseJson=zn.prototype.Ua,zn.prototype.getResponseText=zn.prototype.aa,zn.prototype.send=zn.prototype.ca;function ki(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}var Ri,_i={createWebChannelTransport:Si,ErrorCode:Te,EventType:Ne,WebChannel:ke,XhrIo:zn},Di=_i.createWebChannelTransport,Oi=_i.ErrorCode,Ci=_i.EventType,Li=_i.WebChannel,Vi=_i.XhrIo,Pi=$l.SDK_VERSION,Ui=(Wi.prototype.t=function(){return null!=this.uid},Wi.prototype.i=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},Wi.prototype.isEqual=function(t){return t.uid===this.uid},Wi.UNAUTHENTICATED=new Wi(null),Wi.s=new Wi("google-credentials-uid"),Wi.u=new Wi("first-party-uid"),Wi),Mi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Fi=(t(Yi,Ri=Error),Yi),xi=(Qi.prototype.getToken=function(){return Promise.resolve(null)},Qi.prototype.l=function(){},Qi.prototype.v=function(t){Na(!this.h,"Can only call setChangeListener() once."),(this.h=t)(Ui.UNAUTHENTICATED)},Qi.prototype.m=function(){Na(null!==this.h,"removeChangeListener() when no listener registered"),this.h=null},Qi),qi=(zi.prototype.getToken=function(){var e=this;Na(null!=this.p,"getToken cannot be called after listener removed.");var n=this._,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e._!==n)throw new Fi(Mi.ABORTED,"getToken aborted due to token change.");return t?(Na("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new ki(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},zi.prototype.l=function(){this.forceRefresh=!0},zi.prototype.v=function(t){Na(!this.h,"Can only call setChangeListener() once."),this.h=t,this.g&&t(this.currentUser)},zi.prototype.m=function(){Na(null!=this.p,"removeChangeListener() called twice"),Na(null!==this.h,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.p),this.p=null,this.h=null},zi.prototype.T=function(){var t=this.auth&&this.auth.getUid();return Na(null===t||"string"==typeof t,"Received invalid UID: "+t),new Ui(t)},zi),ji=(Object.defineProperty(Hi.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.A},e=this.S.auth.I([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Hi),Gi=(Bi.prototype.getToken=function(){return Promise.resolve(new ji(this.S,this.A))},Bi.prototype.v=function(t){t(Ui.u)},Bi.prototype.m=function(){},Bi.prototype.l=function(){},Bi);function Bi(t,e){this.S=t,this.A=e}function Hi(t,e){this.S=t,this.A=e,this.type="FirstParty",this.user=Ui.u}function zi(t){var e=this;this.p=null,this.currentUser=Ui.UNAUTHENTICATED,this.g=!1,this._=0,this.h=null,this.forceRefresh=!1,this.p=function(){e._++,e.currentUser=e.T(),e.g=!0,e.h&&e.h(e.currentUser)},this._=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.p):(this.p(null),t.get().then(function(t){e.auth=t,e.p&&e.auth.addAuthTokenListener(e.p)},function(){}))}function Qi(){this.h=null}function Yi(t,e){var n=Ri.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Wi(t){this.uid=t}var Ki,Xi,Ji=(mr.now=function(){return mr.fromMillis(Date.now())},mr.fromDate=function(t){return mr.fromMillis(t.getTime())},mr.fromMillis=function(t){var e=Math.floor(t/1e3);return new mr(e,1e6*(t-1e3*e))},mr.prototype.toDate=function(){return new Date(this.toMillis())},mr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},mr.prototype.R=function(t){return this.seconds===t.seconds?ka(this.nanoseconds,t.nanoseconds):ka(this.seconds,t.seconds)},mr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},mr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},mr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},mr),$i=(vr.N=function(t){var e=Math.floor(t/1e6);return new vr(new Ji(e,t%1e6*1e3))},vr.O=function(t){return new vr(t)},vr.D=function(){return vr.MIN},vr.prototype.V=function(t){return this.timestamp.R(t.timestamp)},vr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},vr.prototype.P=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},vr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},vr.prototype.k=function(){return this.timestamp},vr.MIN=new vr(new Ji(0,0)),vr),Zi=(Object.defineProperty(yr.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),yr.prototype.isEqual=function(t){return 0===yr.F(this,t)},yr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof yr?t.forEach(function(t){e.push(t)}):e.push(t),this.j(e)},yr.prototype.limit=function(){return this.offset+this.length},yr.prototype.U=function(t){return t=void 0===t?1:t,Na(this.length>=t,"Can't call popFirst() with less segments"),this.j(this.segments,this.offset+t,this.length-t)},yr.prototype.L=function(){return Na(!this.M(),"Can't call popLast() on empty path"),this.j(this.segments,this.offset,this.length-1)},yr.prototype.q=function(){return Na(!this.M(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},yr.prototype.B=function(){return this.get(this.length-1)},yr.prototype.get=function(t){return Na(t<this.length,"Index out of range"),this.segments[this.offset+t]},yr.prototype.M=function(){return 0===this.length},yr.prototype.W=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},yr.prototype.G=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},yr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},yr.prototype.J=function(){return this.segments.slice(this.offset,this.limit())},yr.F=function(t,e){for(var n=Math.min(t.length,e.length),i=0;i<n;i++){var r=t.get(i),o=e.get(i);if(r<o)return-1;if(o<r)return 1}return t.length<e.length?-1:t.length>e.length?1:0},yr),tr=(t(dr,Xi=Zi),dr.prototype.j=function(t,e,n){return new dr(t,e,n)},dr.prototype.H=function(){return this.J().join("/")},dr.prototype.toString=function(){return this.H()},dr.Y=function(t){if(0<=t.indexOf("//"))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new dr(t.split("/").filter(function(t){return 0<t.length}))},dr.K=new dr([]),dr),er=/^[_a-zA-Z][_a-zA-Z0-9]*$/,nr=(t(pr,Ki=Zi),pr.prototype.j=function(t,e,n){return new pr(t,e,n)},pr.X=function(t){return er.test(t)},pr.prototype.H=function(){return this.J().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),pr.X(t)||(t="`"+t+"`"),t}).join(".")},pr.prototype.toString=function(){return this.H()},pr.prototype.$=function(){return 1===this.length&&"__name__"===this.get(0)},pr.Z=function(){return new pr(["__name__"])},pr.tt=function(t){for(var e=[],n="",i=0,r=function(){if(0===n.length)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new Fi(Mi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Fi(Mi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,i+=2}else"`"===s?o=!o:"."!==s||o?n+=s:r(),i++}if(r(),o)throw new Fi(Mi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new pr(e)},pr.K=new pr([]),pr),ir=(fr.it=function(t){return new fr(tr.Y(t).U(5))},fr.prototype.et=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},fr.prototype.isEqual=function(t){return null!==t&&0===tr.F(this.path,t.path)},fr.prototype.toString=function(){return this.path.toString()},fr.F=function(t,e){return tr.F(t.path,e.path)},fr.nt=function(t){return t.length%2==0},fr.rt=function(t){return new fr(new tr(t.slice()))},fr.EMPTY=new fr(new tr([])),fr),rr=(lr.prototype.st=function(t,e){return new lr(this.F,this.root.st(t,e,this.F).copy(null,null,sr.ut,null,null))},lr.prototype.remove=function(t){return new lr(this.F,this.root.remove(t,this.F).copy(null,null,sr.ut,null,null))},lr.prototype.get=function(t){for(var e=this.root;!e.M();){var n=this.F(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},lr.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.M();){var i=this.F(t,n.key);if(0===i)return e+n.left.size;n=i<0?n.left:(e+=n.left.size+1,n.right)}return-1},lr.prototype.M=function(){return this.root.M()},Object.defineProperty(lr.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),lr.prototype.ot=function(){return this.root.ot()},lr.prototype.ht=function(){return this.root.ht()},lr.prototype.at=function(t){return this.root.at(t)},lr.prototype.forEach=function(n){this.at(function(t,e){return n(t,e),!1})},lr.prototype.toString=function(){var n=[];return this.at(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},lr.prototype.ct=function(t){return this.root.ct(t)},lr.prototype.ft=function(){return new or(this.root,null,this.F,!1)},lr.prototype.lt=function(t){return new or(this.root,t,this.F,!1)},lr.prototype.dt=function(){return new or(this.root,null,this.F,!0)},lr.prototype.vt=function(t){return new or(this.root,t,this.F,!0)},lr),or=(cr.prototype.gt=function(){Na(0<this.pt.length,"getNext() called on iterator when hasNext() is false.");var t=this.pt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.M();)this.pt.push(t),t=t.right;else for(t=t.right;!t.M();)this.pt.push(t),t=t.left;return e},cr.prototype.bt=function(){return 0<this.pt.length},cr.prototype.yt=function(){if(0===this.pt.length)return null;var t=this.pt[this.pt.length-1];return{key:t.key,value:t.value}},cr),sr=(hr.prototype.copy=function(t,e,n,i,r){return new hr(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)},hr.prototype.M=function(){return!1},hr.prototype.at=function(t){return this.left.at(t)||t(this.key,this.value)||this.right.at(t)},hr.prototype.ct=function(t){return this.right.ct(t)||t(this.key,this.value)||this.left.ct(t)},hr.prototype.min=function(){return this.left.M()?this:this.left.min()},hr.prototype.ot=function(){return this.min().key},hr.prototype.ht=function(){return this.right.M()?this.key:this.right.ht()},hr.prototype.st=function(t,e,n){var i=this,r=n(t,i.key);return(i=r<0?i.copy(null,null,null,i.left.st(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.st(t,e,n)))._t()},hr.prototype.Tt=function(){if(this.left.M())return hr.EMPTY;var t=this;return t.left.Et()||t.left.left.Et()||(t=t.St()),(t=t.copy(null,null,null,t.left.Tt(),null))._t()},hr.prototype.remove=function(t,e){var n,i=this;if(e(t,i.key)<0)i.left.M()||i.left.Et()||i.left.left.Et()||(i=i.St()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.Et()&&(i=i.At()),i.right.M()||i.right.Et()||i.right.left.Et()||(i=i.It()),0===e(t,i.key)){if(i.right.M())return hr.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.Tt())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i._t()},hr.prototype.Et=function(){return this.color},hr.prototype._t=function(){var t=this;return t.right.Et()&&!t.left.Et()&&(t=t.Ct()),t.left.Et()&&t.left.left.Et()&&(t=t.At()),t.left.Et()&&t.right.Et()&&(t=t.Rt()),t},hr.prototype.St=function(){var t=this.Rt();return t.right.left.Et()&&(t=(t=(t=t.copy(null,null,null,null,t.right.At())).Ct()).Rt()),t},hr.prototype.It=function(){var t=this.Rt();return t.left.left.Et()&&(t=(t=t.At()).Rt()),t},hr.prototype.Ct=function(){var t=this.copy(null,null,hr.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},hr.prototype.At=function(){var t=this.copy(null,null,hr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},hr.prototype.Rt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},hr.prototype.Nt=function(){var t=this.Ot();return Math.pow(2,t)<=this.size+1},hr.prototype.Ot=function(){if(this.Et()&&this.left.Et())throw Ta("Red node has red child("+this.key+","+this.value+")");if(this.right.Et())throw Ta("Right child of ("+this.key+","+this.value+") is red");var t=this.left.Ot();if(t!==this.right.Ot())throw Ta("Black depths differ");return t+(this.Et()?0:1)},hr.EMPTY=null,hr.RED=!0,hr.ut=!1,hr),ar=(Object.defineProperty(ur.prototype,"key",{get:function(){throw Ta("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(ur.prototype,"value",{get:function(){throw Ta("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(ur.prototype,"color",{get:function(){throw Ta("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(ur.prototype,"left",{get:function(){throw Ta("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(ur.prototype,"right",{get:function(){throw Ta("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),ur.prototype.copy=function(t,e,n,i,r){return this},ur.prototype.st=function(t,e,n){return new sr(t,e)},ur.prototype.remove=function(t,e){return this},ur.prototype.M=function(){return!0},ur.prototype.at=function(t){return!1},ur.prototype.ct=function(t){return!1},ur.prototype.ot=function(){return null},ur.prototype.ht=function(){return null},ur.prototype.Et=function(){return!1},ur.prototype.Nt=function(){return!0},ur.prototype.Ot=function(){return 0},ur);function ur(){this.size=0}function hr(t,e,n,i,r){this.key=t,this.value=e,this.color=null!=n?n:hr.RED,this.left=null!=i?i:hr.EMPTY,this.right=null!=r?r:hr.EMPTY,this.size=this.left.size+1+this.right.size}function cr(t,e,n,i){this.wt=i,this.pt=[];for(var r=1;!t.M();)if(r=e?n(t.key,e):1,i&&(r*=-1),r<0)t=this.wt?t.left:t.right;else{if(0===r){this.pt.push(t);break}this.pt.push(t),t=this.wt?t.right:t.left}}function lr(t,e){this.F=t,this.root=e||sr.EMPTY}function fr(t){this.path=t,Na(fr.nt(t),"Invalid DocumentKey with an odd number of segments: "+t.J().join("/"))}function pr(){return null!==Ki&&Ki.apply(this,arguments)||this}function dr(){return null!==Xi&&Xi.apply(this,arguments)||this}function yr(t,e,n){void 0===e?e=0:e>t.length&&Ta("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Ta("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}function vr(t){this.timestamp=t}function mr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Fi(Mi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Fi(Mi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Fi(Mi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Fi(Mi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}sr.EMPTY=new ar;var gr=(Er.Dt=function(t){var e=new Er(t.F);return t.forEach(function(t){e=e.add(t)}),e},Er.prototype.has=function(t){return null!==this.data.get(t)},Er.prototype.first=function(){return this.data.ot()},Er.prototype.last=function(){return this.data.ht()},Object.defineProperty(Er.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),Er.prototype.indexOf=function(t){return this.data.indexOf(t)},Er.prototype.forEach=function(n){this.data.at(function(t,e){return n(t),!1})},Er.prototype.Vt=function(t,e){for(var n=this.data.lt(t[0]);n.bt();){var i=n.gt();if(0<=this.F(i.key,t[1]))return;e(i.key)}},Er.prototype.Pt=function(t,e){var n;for(n=void 0!==e?this.data.lt(e):this.data.ft();n.bt();)if(!t(n.gt().key))return},Er.prototype.kt=function(t){var e=this.data.lt(t);return e.bt()?e.gt().key:null},Er.prototype.ft=function(){return new wr(this.data.ft())},Er.prototype.lt=function(t){return new wr(this.data.lt(t))},Er.prototype.add=function(t){return this.copy(this.data.remove(t).st(t,!0))},Er.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Er.prototype.M=function(){return this.data.M()},Er.prototype.Ft=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Er.prototype.isEqual=function(t){if(!(t instanceof Er))return!1;if(this.size!==t.size)return!1;for(var e=this.data.ft(),n=t.data.ft();e.bt();){var i=e.gt().key,r=n.gt().key;if(0!==this.F(i,r))return!1}return!0},Er.prototype.J=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Er.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Er.prototype.copy=function(t){var e=new Er(this.F);return e.data=t,e},Er),wr=(br.prototype.gt=function(){return this.jt.gt().key},br.prototype.bt=function(){return this.jt.bt()},br);function br(t){this.jt=t}function Er(t){this.F=t,this.data=new rr(this.F)}function Ir(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Tr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Nr(t){for(var e in Na(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ar=(Sr.fromBase64String=function(t){return new Sr(ya.Lt().atob(t))},Sr.fromUint8Array=function(t){return new Sr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Sr.prototype.toBase64=function(){return ya.Lt().btoa(this.Ut)},Sr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.Ut)},Sr.prototype.Mt=function(){return 2*this.Ut.length},Sr.prototype.V=function(t){return ka(this.Ut,t.Ut)},Sr.prototype.isEqual=function(t){return this.Ut===t.Ut},Sr.qt=new Sr(""),Sr);function Sr(t){this.Ut=t}function kr(t){return null==t}function Rr(t){return-0===t&&1/t==-1/0}function _r(t){return"number"==typeof t&&Number.isInteger(t)&&!Rr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function Dr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Or(t){var e=xr(t.mapValue.fields.__local_write_time__.timestampValue);return new Ji(e.seconds,e.nanos)}var Cr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Dr(t)?4:10:Ta("Invalid value type: "+JSON.stringify(t))}function Vr(o,t){var e,n,i,r=Lr(o);if(r!==Lr(t))return!1;switch(r){case 0:return!0;case 1:return o.booleanValue===t.booleanValue;case 4:return Or(o).isEqual(Or(t));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=xr(t.timestampValue),i=xr(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(o,t);case 5:return o.stringValue===t.stringValue;case 6:return i=t,jr(o.bytesValue).isEqual(jr(i.bytesValue));case 7:return o.referenceValue===t.referenceValue;case 8:return n=t,qr((e=o).geoPointValue.latitude)===qr(n.geoPointValue.latitude)&&qr(e.geoPointValue.longitude)===qr(n.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return qr(t.integerValue)===qr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=qr(t.doubleValue),i=qr(e.doubleValue);return n===i?Rr(n)===Rr(i):isNaN(n)&&isNaN(i)}return!1}(o,t);case 9:return Ra(o.arrayValue.values||[],t.arrayValue.values||[],Vr);case 10:return function(t,e){var n=o.mapValue.fields||{},i=e.mapValue.fields||{};if(Ir(n)!==Ir(i))return!1;for(var r in n)if(n.hasOwnProperty(r)&&(void 0===i[r]||!Vr(n[r],i[r])))return!1;return!0}(0,t);default:return Ta("Unexpected value type: "+JSON.stringify(o))}}function Pr(t,e){return void 0!==(t.values||[]).find(function(t){return Vr(t,e)})}function Ur(t,e){var n,i,r,o,s,a,u,h,c,l,f,p=Lr(t),d=Lr(e);if(p!==d)return ka(p,d);switch(p){case 0:return 0;case 1:return ka(t.booleanValue,e.booleanValue);case 2:return c=e,l=qr((h=t).integerValue||h.doubleValue),f=qr(c.integerValue||c.doubleValue),l<f?-1:f<l?1:l===f?0:isNaN(l)?isNaN(f)?0:-1:1;case 3:return Mr(t.timestampValue,e.timestampValue);case 4:return Mr(Or(t),Or(e));case 5:return ka(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,a=jr(o),u=jr(s),a.V(u);case 7:return function(t,e){for(var n=t.split("/"),i=e.split("/"),r=0;r<n.length&&r<i.length;r++){var o=ka(n[r],i[r]);if(0!==o)return o}return ka(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=ka(qr(n.latitude),qr(i.latitude)))?r:ka(qr(n.longitude),qr(i.longitude));case 9:return function(t,e){for(var n=t.values||[],i=e.values||[],r=0;r<n.length&&r<i.length;++r){var o=Ur(n[r],i[r]);if(o)return o}return ka(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},i=Object.keys(n),r=e.fields||{},o=Object.keys(r);i.sort(),o.sort();for(var s=0;s<i.length&&s<o.length;++s){var a=ka(i[s],o[s]);if(0!==a)return a;var u=Ur(n[i[s]],r[o[s]]);if(0!==u)return u}return ka(i.length,o.length)}(t.mapValue,e.mapValue);default:throw Ta("Invalid value type: "+p)}}function Mr(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ka(t,e);var n=xr(t),i=xr(e),r=ka(n.seconds,i.seconds);return 0!==r?r:ka(n.nanos,i.nanos)}function Fr(t){return function a(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(i=t.timestampValue,"time("+(r=xr(i)).seconds+","+r.nanos+")"):"stringValue"in t?t.stringValue:"bytesValue"in t?jr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ir.it(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,i=0,r=t.values||[];i<r.length;i++){var o=r[i];n?n=!1:e+=",",e+=a(o)}return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e=Object.keys(t.fields||{}).sort(),n="{",i=!0,r=0,o=e;r<o.length;r++){var s=o[r];i?i=!1:n+=",",n+=s+":"+a(t.fields[s])}return n+"}"}(t.mapValue):Ta("Invalid value type: "+JSON.stringify(t));var e,n,i,r}(t)}function xr(t){if(Na(!!t,"Cannot normalize null or undefined timestamp."),"string"!=typeof t)return{seconds:qr(t.seconds),nanos:e=qr(t.nanos)};var e=0,n=Cr.exec(t);if(Na(!!n,"invalid timestamp: "+t),n[1]){var i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}var r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}function qr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function jr(t){return"string"==typeof t?Ar.fromBase64String(t):Ar.fromUint8Array(t)}function Gr(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.H()}}function Br(t){return!!t&&"integerValue"in t}function Hr(t){return Br(t)||!!t&&"doubleValue"in t}function zr(t){return!!t&&"arrayValue"in t}function Qr(t){return!!t&&"referenceValue"in t}function Yr(t){return!!t&&"nullValue"in t}function Wr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Kr(t){return!!t&&"mapValue"in t}var Xr=(io.prototype.xt=function(t,e){return n=e,i=t,o={fields:(r={},r.__type__={stringValue:"server_timestamp"},r.__local_write_time__={timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}},r)},i&&(o.fields.__previous_value__=i),{mapValue:o};var n,i,r,o},io.prototype.Bt=function(t,e){return e},io.prototype.Qt=function(t){return null},io.prototype.isEqual=function(t){return t instanceof io},io.instance=new io,io),Jr=(no.prototype.xt=function(t,e){return this.apply(t)},no.prototype.Bt=function(t,e){return this.apply(t)},no.prototype.apply=function(t){for(var n=ro(t),e=function(e){n.some(function(t){return Vr(t,e)})||n.push(e)},i=0,r=this.elements;i<r.length;i++)e(r[i]);return{arrayValue:{values:n}}},no.prototype.Qt=function(t){return null},no.prototype.isEqual=function(t){return t instanceof no&&Ra(this.elements,t.elements,Vr)},no),$r=(eo.prototype.xt=function(t,e){return this.apply(t)},eo.prototype.Bt=function(t,e){return this.apply(t)},eo.prototype.apply=function(t){for(var n=ro(t),e=function(e){n=n.filter(function(t){return!Vr(t,e)})},i=0,r=this.elements;i<r.length;i++)e(r[i]);return{arrayValue:{values:n}}},eo.prototype.Qt=function(t){return null},eo.prototype.isEqual=function(t){return t instanceof eo&&Ra(this.elements,t.elements,Vr)},eo),Zr=(to.prototype.xt=function(t,e){var n=this.Qt(t),i=this.asNumber(n)+this.asNumber(this.Wt);return Br(n)&&Br(this.Wt)?this.serializer.Gt(i):this.serializer.zt(i)},to.prototype.Bt=function(t,e){return Na(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},to.prototype.Qt=function(t){return Hr(t)?t:{integerValue:0}},to.prototype.isEqual=function(t){return t instanceof to&&Vr(this.Wt,t.Wt)},to.prototype.asNumber=function(t){return qr(t.integerValue||t.doubleValue)},to);function to(t,e){this.serializer=t,Na(Hr(this.Wt=e),"NumericIncrementTransform transform requires a NumberValue")}function eo(t){this.elements=t}function no(t){this.elements=t}function io(){}function ro(t){return zr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function oo(t,e){this.version=t,this.transformResults=e}var so,ao,uo,ho,co,lo,fo,po,yo,vo,mo,go,wo,bo,Eo,Io,To=(Rs.Jt=function(t){return new Rs(t)},Rs.Ht=function(t){var e=new gr(nr.F);return t.forEach(function(t){return e=e.add(t)}),new Rs(e)},Rs.prototype.Yt=function(e){var n=!1;return this.fields.forEach(function(t){t.W(e)&&(n=!0)}),n},Rs.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Rs),No=(ks.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},ks),Ao=(Ss.exists=function(t){return new Ss(void 0,t)},Ss.updateTime=function(t){return new Ss(t)},Object.defineProperty(Ss.prototype,"Kt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Ss.prototype.Xt=function(t){return void 0!==this.updateTime?t instanceof Po&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Po:(Na(this.Kt,"Precondition should be empty"),!0)},Ss.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,!((null!=e?!n||!e.isEqual(n):e!==n)||this.exists!==t.exists);var e,n},Ss.NONE=new Ss,Ss),So=(As.prototype.$t=function(t){null!=t&&Na(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},As.Zt=function(t){return t instanceof Po?t.version:$i.MIN},As),ko=(t(Ns,Io=So),Ns.prototype.Bt=function(t,e){this.$t(t),Na(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Po(this.key,n,this.value,{hasCommittedMutations:!0})},Ns.prototype.xt=function(t,e,n){if(this.$t(t),!this.tn.Xt(t))return t;var i=So.Zt(t);return new Po(this.key,i,this.value,{nn:!0})},Ns.prototype.in=function(t){return null},Ns.prototype.isEqual=function(t){return t instanceof Ns&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.tn.isEqual(t.tn)},Ns),Ro=(t(Ts,Eo=So),Ts.prototype.Bt=function(t,e){if(this.$t(t),Na(null==e.transformResults,"Transform results received by PatchMutation."),!this.tn.Xt(t))return new Mo(this.key,e.version);var n=this.rn(t);return new Po(this.key,e.version,n,{hasCommittedMutations:!0})},Ts.prototype.xt=function(t,e,n){if(this.$t(t),!this.tn.Xt(t))return t;var i=So.Zt(t),r=this.rn(t);return new Po(this.key,i,r,{nn:!0})},Ts.prototype.in=function(t){return null},Ts.prototype.isEqual=function(t){return t instanceof Ts&&this.key.isEqual(t.key)&&this.en.isEqual(t.en)&&this.tn.isEqual(t.tn)},Ts.prototype.rn=function(t){var e;return e=t instanceof Po?t.data():Co.EMPTY,this.sn(e)},Ts.prototype.sn=function(t){var n=this,i=t.un();return this.en.fields.forEach(function(t){if(!t.M()){var e=n.data.field(t);null!==e?i.set(t,e):i.delete(t)}}),i.on()},Ts),_o=(t(Is,bo=So),Is.prototype.Bt=function(t,e){if(this.$t(t),Na(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.tn.Xt(t))return new Mo(this.key,e.version);var n=this.hn(t),i=this.an(t,e.transformResults),r=e.version,o=this.cn(n.data(),i);return new Po(this.key,r,o,{hasCommittedMutations:!0})},Is.prototype.xt=function(t,e,n){if(this.$t(t),!this.tn.Xt(t))return t;var i=this.hn(t),r=this.fn(n,t,e),o=this.cn(i.data(),r);return new Po(this.key,i.version,o,{nn:!0})},Is.prototype.in=function(t){for(var e=null,n=0,i=this.fieldTransforms;n<i.length;n++){var r=i[n],o=t instanceof Po?t.field(r.field):void 0,s=r.transform.Qt(o||null);null!=s&&(e=null==e?Co.ln().set(r.field,s):e.set(r.field,s))}return e?e.on():null},Is.prototype.isEqual=function(t){return t instanceof Is&&this.key.isEqual(t.key)&&Ra(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.tn.isEqual(t.tn)},Is.prototype.hn=function(t){return Na(t instanceof Po,"Unknown MaybeDocument type "+t),Na(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},Is.prototype.an=function(t,e){var n=[];Na(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var i=0;i<e.length;i++){var r=this.fieldTransforms[i],o=r.transform,s=null;t instanceof Po&&(s=t.field(r.field)),n.push(o.Bt(s,e[i]))}return n},Is.prototype.fn=function(t,e,n){for(var i=[],r=0,o=this.fieldTransforms;r<o.length;r++){var s=o[r],a=s.transform,u=null;e instanceof Po&&(u=e.field(s.field)),null===u&&n instanceof Po&&(u=n.field(s.field)),i.push(a.xt(u,t))}return i},Is.prototype.cn=function(t,e){Na(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=t.un(),i=0;i<this.fieldTransforms.length;i++){var r=this.fieldTransforms[i].field;n.set(r,e[i])}return n.on()},Is),Do=(t(Es,wo=So),Es.prototype.Bt=function(t,e){return this.$t(t),Na(null==e.transformResults,"Transform results received by DeleteMutation."),new Uo(this.key,e.version,{hasCommittedMutations:!0})},Es.prototype.xt=function(t,e,n){return this.$t(t),this.tn.Xt(t)?(t&&Na(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Uo(this.key,$i.D())):t},Es.prototype.in=function(t){return null},Es.prototype.isEqual=function(t){return t instanceof Es&&this.key.isEqual(t.key)&&this.tn.isEqual(t.tn)},Es),Oo=(t(bs,go=So),bs.prototype.Bt=function(t,e){Ta("VerifyMutation should only be used in Transactions.")},bs.prototype.xt=function(t,e,n){Ta("VerifyMutation should only be used in Transactions.")},bs.prototype.in=function(t){Ta("VerifyMutation should only be used in Transactions.")},bs.prototype.isEqual=function(t){return t instanceof bs&&this.key.isEqual(t.key)&&this.tn.isEqual(t.tn)},bs),Co=(ws.ln=function(){return ws.EMPTY.un()},ws.prototype.field=function(t){if(t.M())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Kr(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.B()])||null},ws.prototype.en=function(){return this.dn(this.proto.mapValue)},ws.prototype.dn=function(t){var r=this,o=new gr(nr.F);return Tr(t.fields||{},function(t,e){var n=new nr([t]);if(10===Lr(e)){var i=r.dn(e.mapValue).fields;i.M()?o=o.add(n):i.forEach(function(t){o=o.add(n.child(t))})}else o=o.add(n)}),To.Jt(o)},ws.prototype.isEqual=function(t){return Vr(this.proto,t.proto)},ws.prototype.un=function(){return new Lo(this)},ws.EMPTY=new ws({mapValue:{}}),ws),Lo=(gs.prototype.set=function(t,e){return Na(!t.M(),"Cannot set field for empty path on ObjectValue"),this.mn(t,e),this},gs.prototype.delete=function(t){return Na(!t.M(),"Cannot delete field for empty path on ObjectValue"),this.mn(t,null),this},gs.prototype.mn=function(t,e){for(var n=this.wn,i=0;i<t.length-1;++i){var r=t.get(i),o=n.get(r);o instanceof Map||(o=o&&10===Lr(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(r,o)),n=o}n.set(t.B(),e)},gs.prototype.on=function(){var t=this.pn(nr.K,this.wn);return null!=t?new Co(t):this.vn},gs.prototype.pn=function(i,t){var r=this,o=!1,e=this.vn.field(i),s=Kr(e)?l({},e.mapValue.fields):{};return t.forEach(function(t,e){if(t instanceof Map){var n=r.pn(i.child(e),t);null!=n&&(s[e]=n,o=!0)}else null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},gs),Vo=(ms.gn=function(t,e){return ir.F(t.key,e.key)},ms),Po=(t(vs,mo=Vo),vs.prototype.field=function(t){return this.bn.field(t)},vs.prototype.data=function(){return this.bn},vs.prototype.yn=function(){return this.bn.proto},vs.prototype.isEqual=function(t){return t instanceof vs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.nn===t.nn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.bn.isEqual(t.bn)},vs.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.bn.toString()+", {hasLocalMutations: "+this.nn+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(vs.prototype,"hasPendingWrites",{get:function(){return this.nn||this.hasCommittedMutations},enumerable:!0,configurable:!0}),vs._n=function(t,e,n){var i=e.field(t),r=n.field(t);return null!==i&&null!==r?Ur(i,r):Ta("Trying to compare documents on fields that don't exist")},vs),Uo=(t(ys,vo=Vo),ys.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(ys.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),ys.prototype.isEqual=function(t){return t instanceof ys&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ys),Mo=(t(ds,yo=Vo),ds.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ds.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),ds.prototype.isEqual=function(t){return t instanceof ds&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ds),Fo=(ps.prototype.canonicalId=function(){if(null===this.Tn){var t=this.path.H();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),kr(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Tn=t}return this.Tn},ps.prototype.toString=function(){var t=this.path.H();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),kr(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},ps.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},ps.prototype.En=function(){return ir.nt(this.path)&&null===this.collectionGroup&&0===this.filters.length},ps),xo=(fs.Nn=function(t){return new fs(t)},Object.defineProperty(fs.prototype,"orderBy",{get:function(){if(null===this.In){var t=this.On(),e=this.Dn();if(null!==t&&null===e)t.$()?this.In=[Xo]:this.In=[new Ko(t),Xo];else{Na(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.In=[]),i=0,r=this.Sn;i<r.length;i++){var o=r[i];this.In.push(o),o.field.$()&&(n=!0)}if(!n){var s=0<this.Sn.length?this.Sn[this.Sn.length-1].dir:Yo.ASCENDING;this.In.push(s===Yo.ASCENDING?Xo:Jo)}}}return this.In},enumerable:!0,configurable:!0}),fs.prototype.Vn=function(t){Na(null==this.On()||!(t instanceof jo)||!t.Pn()||t.field.isEqual(this.On()),"Query must only have one inequality field."),Na(!this.En(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new fs(this.path,this.collectionGroup,this.Sn.slice(),e,this.limit,this.An,this.startAt,this.endAt)},fs.prototype.kn=function(t){Na(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.Sn.concat([t]);return new fs(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.An,this.startAt,this.endAt)},fs.prototype.Fn=function(t){return new fs(this.path,this.collectionGroup,this.Sn.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},fs.prototype.jn=function(t){return new fs(this.path,this.collectionGroup,this.Sn.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},fs.prototype.Un=function(t){return new fs(this.path,this.collectionGroup,this.Sn.slice(),this.filters.slice(),this.limit,this.An,t,this.endAt)},fs.prototype.Ln=function(t){return new fs(this.path,this.collectionGroup,this.Sn.slice(),this.filters.slice(),this.limit,this.An,this.startAt,t)},fs.prototype.Mn=function(t){return new fs(t,null,this.Sn.slice(),this.filters.slice(),this.limit,this.An,this.startAt,this.endAt)},fs.prototype.qn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Sn.length||1===this.Sn.length&&this.Sn[0].field.$())},fs.prototype.canonicalId=function(){return this.xn().canonicalId()+"|lt:"+this.An},fs.prototype.toString=function(){return"Query(target="+this.xn().toString()+"; limitType="+this.An+")"},fs.prototype.isEqual=function(t){return this.xn().isEqual(t.xn())&&this.An===t.An},fs.prototype.Bn=function(t,e){for(var n=!1,i=0,r=this.orderBy;i<r.length;i++){var o=r[i],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.$()}return Na(n,"orderBy used that doesn't compare on key field"),0},fs.prototype.matches=function(t){return this.Qn(t)&&this.Wn(t)&&this.Gn(t)&&this.zn(t)},fs.prototype.Jn=function(){return!kr(this.limit)&&"F"===this.An},fs.prototype.Hn=function(){return!kr(this.limit)&&"L"===this.An},fs.prototype.Dn=function(){return 0<this.Sn.length?this.Sn[0].field:null},fs.prototype.On=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof jo&&n.Pn())return n.field}return null},fs.prototype.Yn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var i=n[e];if(i instanceof jo&&0<=t.indexOf(i.op))return i.op}return null},fs.prototype.En=function(){return this.xn().En()},fs.prototype.Kn=function(){return null!==this.collectionGroup},fs.prototype.xn=function(){if(!this.Cn)if("F"===this.An)this.Cn=new Fo(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var i=n[e],r=i.dir===Yo.DESCENDING?Yo.ASCENDING:Yo.DESCENDING;t.push(new Ko(i.field,r))}var o=this.endAt?new Wo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Wo(this.startAt.position,!this.startAt.before):null;this.Cn=new Fo(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Cn},fs.prototype.Qn=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.et(this.collectionGroup)&&this.path.W(e):ir.nt(this.path)?this.path.isEqual(e):this.path.G(e)},fs.prototype.Wn=function(t){for(var e=0,n=this.Sn;e<n.length;e++){var i=n[e];if(!i.field.$()&&null===t.field(i.field))return!1}return!0},fs.prototype.Gn=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},fs.prototype.zn=function(t){return!(this.startAt&&!this.startAt.Xn(this.orderBy,t)||this.endAt&&this.endAt.Xn(this.orderBy,t))},fs.prototype.Rn=function(t){Na(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},fs),qo=(ls.Y=function(t){switch(t){case"<":return ls.LESS_THAN;case"<=":return ls.LESS_THAN_OR_EQUAL;case"==":return ls.EQUAL;case">=":return ls.GREATER_THAN_OR_EQUAL;case">":return ls.GREATER_THAN;case"array-contains":return ls.ARRAY_CONTAINS;case"in":return ls.IN;case"array-contains-any":return ls.ARRAY_CONTAINS_ANY;default:return Ta("Unknown FieldFilter operator: "+t)}},ls.prototype.toString=function(){return this.name},ls.prototype.isEqual=function(t){return this.name===t.name},ls.LESS_THAN=new ls("<"),ls.LESS_THAN_OR_EQUAL=new ls("<="),ls.EQUAL=new ls("=="),ls.GREATER_THAN=new ls(">"),ls.GREATER_THAN_OR_EQUAL=new ls(">="),ls.ARRAY_CONTAINS=new ls("array-contains"),ls.IN=new ls("in"),ls.ARRAY_CONTAINS_ANY=new ls("array-contains-any"),ls),jo=(t(cs,po=function(){}),cs.create=function(t,e,n){if(t.$())return e===qo.IN?(Na(zr(n),"Comparing on key with IN, but filter value not an ArrayValue"),Na((n.arrayValue.values||[]).every(function(t){return Qr(t)}),"Comparing on key with IN, but an array value was not a RefValue"),new Bo(t,n)):(Na(Qr(n),"Comparing on key, but filter value not a RefValue"),Na(e!==qo.ARRAY_CONTAINS&&e!==qo.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Go(t,e,n));if(Yr(n)){if(e!==qo.EQUAL)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new cs(t,e,n)}if(Wr(n)){if(e!==qo.EQUAL)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new cs(t,e,n)}return e===qo.ARRAY_CONTAINS?new Ho(t,n):e===qo.IN?(Na(zr(n),"IN filter has invalid value: "+n.toString()),new zo(t,n)):e===qo.ARRAY_CONTAINS_ANY?(Na(zr(n),"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Qo(t,n)):new cs(t,e,n)},cs.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Lr(this.value)===Lr(e)&&this.$n(Ur(e,this.value))},cs.prototype.$n=function(t){switch(this.op){case qo.LESS_THAN:return t<0;case qo.LESS_THAN_OR_EQUAL:return t<=0;case qo.EQUAL:return 0===t;case qo.GREATER_THAN:return 0<t;case qo.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Ta("Unknown FieldFilter operator: "+this.op)}},cs.prototype.Pn=function(){return 0<=[qo.LESS_THAN,qo.LESS_THAN_OR_EQUAL,qo.GREATER_THAN,qo.GREATER_THAN_OR_EQUAL].indexOf(this.op)},cs.prototype.canonicalId=function(){return this.field.H()+this.op.toString()+Fr(this.value)},cs.prototype.isEqual=function(t){return t instanceof cs&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&Vr(this.value,t.value)},cs.prototype.toString=function(){return this.field.H()+" "+this.op+" "+Fr(this.value)},cs),Go=(t(hs,fo=jo),hs.prototype.matches=function(t){var e=ir.F(t.key,this.key);return this.$n(e)},hs),Bo=(t(us,lo=jo),us.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},us),Ho=(t(as,co=jo),as.prototype.matches=function(t){var e=t.field(this.field);return zr(e)&&Pr(e.arrayValue,this.value)},as),zo=(t(ss,ho=jo),ss.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Pr(this.value.arrayValue,e)},ss),Qo=(t(os,uo=jo),os.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!zr(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Pr(e.value.arrayValue,t)})},os),Yo=(rs.prototype.toString=function(){return this.name},rs.ASCENDING=new rs("asc"),rs.DESCENDING=new rs("desc"),rs),Wo=(is.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(function(t){return Fr(t)}).join(",")},is.prototype.Xn=function(t,e){Na(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,i=0;i<this.position.length;i++){var r=t[i],o=this.position[i];if(r.field.$())Na(Qr(o),"Bound has a non-key value where the key path is being used."),n=ir.F(ir.it(o.referenceValue),e.key);else{var s=e.field(r.field);Na(null!==s,"Field should exist since document matched the orderBy already."),n=Ur(o,s)}if(r.dir===Yo.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},is.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!Vr(this.position[e],t.position[e]))return!1;return!0},is),Ko=(ns.prototype.compare=function(t,e){var n=this.Zn?Po.gn(t,e):Po._n(this.field,t,e);switch(this.dir){case Yo.ASCENDING:return n;case Yo.DESCENDING:return-1*n;default:return Ta("Unknown direction: "+this.dir)}},ns.prototype.canonicalId=function(){return this.field.H()+this.dir.toString()},ns.prototype.toString=function(){return this.field.H()+" ("+this.dir+")"},ns.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},ns),Xo=new Ko(nr.Z(),Yo.ASCENDING),Jo=new Ko(nr.Z(),Yo.DESCENDING),$o=(es.prototype.ii=function(t){return new es(this.target,this.targetId,this.ti,t,this.ni,this.lastLimboFreeSnapshotVersion,this.resumeToken)},es.prototype.ei=function(t,e){return new es(this.target,this.targetId,this.ti,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},es.prototype.ri=function(t){return new es(this.target,this.targetId,this.ti,this.sequenceNumber,this.ni,t,this.resumeToken)},es.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.ti===t.ti&&this.sequenceNumber===t.sequenceNumber&&this.ni.isEqual(t.ni)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},es),Zo=(ts.prototype.isEqual=function(t){return t&&t.count===this.count},ts);function ts(t){this.count=t}function es(t,e,n,i,r,o,s){void 0===r&&(r=$i.MIN),void 0===o&&(o=$i.MIN),void 0===s&&(s=Ar.qt),this.target=t,this.targetId=e,this.ti=n,this.sequenceNumber=i,this.ni=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function ns(t,e){this.field=t,void 0===e&&(e=Yo.ASCENDING),this.dir=e,this.Zn=t.$()}function is(t,e){this.position=t,this.before=e}function rs(t){this.name=t}function os(t,e){var n=uo.call(this,t,qo.ARRAY_CONTAINS_ANY,e)||this;return Na(zr(e),"ArrayContainsAnyFilter expects an ArrayValue"),n}function ss(t,e){var n=ho.call(this,t,qo.IN,e)||this;return Na(zr(e),"InFilter expects an ArrayValue"),n}function as(t,e){return co.call(this,t,qo.ARRAY_CONTAINS,e)||this}function us(t,e){var n=lo.call(this,t,qo.IN,e)||this;return Na(zr(e),"KeyFieldInFilter expects an ArrayValue"),n.keys=(e.arrayValue.values||[]).map(function(t){return Na(Qr(t),"Comparing on key with IN, but an array value was not a ReferenceValue"),ir.it(t.referenceValue)}),n}function hs(t,e,n){var i=fo.call(this,t,e,n)||this;return Na(Qr(n),"KeyFieldFilter expects a ReferenceValue"),i.key=ir.it(n.referenceValue),i}function cs(t,e,n){var i=po.call(this)||this;return i.field=t,i.op=e,i.value=n,i}function ls(t){this.name=t}function fs(t,e,n,i,r,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.Sn=n,this.filters=i,this.limit=r,this.An=o,this.startAt=s,this.endAt=a,this.In=null,this.Cn=null,this.startAt&&this.Rn(this.startAt),this.endAt&&this.Rn(this.endAt)}function ps(t,e,n,i,r,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=o,this.endAt=s,this.Tn=null}function ds(){return null!==yo&&yo.apply(this,arguments)||this}function ys(t,e,n){var i=vo.call(this,t,e)||this;return i.hasCommittedMutations=!(!n||!n.hasCommittedMutations),i}function vs(t,e,n,i){var r=mo.call(this,t,e)||this;return r.bn=n,r.nn=!!i.nn,r.hasCommittedMutations=!!i.hasCommittedMutations,r}function ms(t,e){this.key=t,this.version=e}function gs(t){this.vn=t,this.wn=new Map}function ws(t){Na(!Dr(this.proto=t),"ServerTimestamps should be converted to ServerTimestampValue")}function bs(t,e){var n=go.call(this)||this;return n.key=t,n.tn=e,n.type=4,n}function Es(t,e){var n=wo.call(this)||this;return n.key=t,n.tn=e,n.type=3,n}function Is(t,e){var n=bo.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=2,n.tn=Ao.exists(!0),n}function Ts(t,e,n,i){var r=Eo.call(this)||this;return r.key=t,r.data=e,r.en=n,r.tn=i,r.type=1,r}function Ns(t,e,n){var i=Io.call(this)||this;return i.key=t,i.value=e,i.tn=n,i.type=0,i}function As(){}function Ss(t,e){this.updateTime=t,this.exists=e,Na(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}function ks(t,e){this.field=t,this.transform=e}function Rs(t){this.fields=t}function _s(t){switch(t){case Mi.OK:return Ta("Treated status OK as error");case Mi.CANCELLED:case Mi.UNKNOWN:case Mi.DEADLINE_EXCEEDED:case Mi.RESOURCE_EXHAUSTED:case Mi.INTERNAL:case Mi.UNAVAILABLE:case Mi.UNAUTHENTICATED:return!1;case Mi.INVALID_ARGUMENT:case Mi.NOT_FOUND:case Mi.ALREADY_EXISTS:case Mi.PERMISSION_DENIED:case Mi.FAILED_PRECONDITION:case Mi.ABORTED:case Mi.OUT_OF_RANGE:case Mi.UNIMPLEMENTED:case Mi.DATA_LOSS:return!0;default:return Ta("Unknown status code: "+t)}}function Ds(t){if(void 0===t)return Ea("GRPC error has no .code"),Mi.UNKNOWN;switch(t){case so.OK:return Mi.OK;case so.CANCELLED:return Mi.CANCELLED;case so.UNKNOWN:return Mi.UNKNOWN;case so.DEADLINE_EXCEEDED:return Mi.DEADLINE_EXCEEDED;case so.RESOURCE_EXHAUSTED:return Mi.RESOURCE_EXHAUSTED;case so.INTERNAL:return Mi.INTERNAL;case so.UNAVAILABLE:return Mi.UNAVAILABLE;case so.UNAUTHENTICATED:return Mi.UNAUTHENTICATED;case so.INVALID_ARGUMENT:return Mi.INVALID_ARGUMENT;case so.NOT_FOUND:return Mi.NOT_FOUND;case so.ALREADY_EXISTS:return Mi.ALREADY_EXISTS;case so.PERMISSION_DENIED:return Mi.PERMISSION_DENIED;case so.FAILED_PRECONDITION:return Mi.FAILED_PRECONDITION;case so.ABORTED:return Mi.ABORTED;case so.OUT_OF_RANGE:return Mi.OUT_OF_RANGE;case so.UNIMPLEMENTED:return Mi.UNIMPLEMENTED;case so.DATA_LOSS:return Mi.DATA_LOSS;default:return Ta("Unknown status code: "+t)}}(ao=so=so||{})[ao.OK=0]="OK",ao[ao.CANCELLED=1]="CANCELLED",ao[ao.UNKNOWN=2]="UNKNOWN",ao[ao.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ao[ao.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ao[ao.NOT_FOUND=5]="NOT_FOUND",ao[ao.ALREADY_EXISTS=6]="ALREADY_EXISTS",ao[ao.PERMISSION_DENIED=7]="PERMISSION_DENIED",ao[ao.UNAUTHENTICATED=16]="UNAUTHENTICATED",ao[ao.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ao[ao.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ao[ao.ABORTED=10]="ABORTED",ao[ao.OUT_OF_RANGE=11]="OUT_OF_RANGE",ao[ao.UNIMPLEMENTED=12]="UNIMPLEMENTED",ao[ao.INTERNAL=13]="INTERNAL",ao[ao.UNAVAILABLE=14]="UNAVAILABLE",ao[ao.DATA_LOSS=15]="DATA_LOSS";var Os=new rr(ir.F);function Cs(){return Os}function Ls(){return Cs()}var Vs=new rr(ir.F);function Ps(){return Vs}var Us=new rr(ir.F);function Ms(){return Us}var Fs=new gr(ir.F);function xs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Fs,i=0,r=t;i<r.length;i++){var o=r[i];n=n.add(o)}return n}var qs=new gr(ka);function js(){return qs}function Gs(t,e,n,i){this.Ai=t,this.removedTargetIds=e,this.key=n,this.Ii=i}function Bs(t,e){this.targetId=t,this.Ci=e}function Hs(t,e,n,i){void 0===n&&(n=Ar.qt),void 0===i&&(i=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}var zs=(ra.oi=function(t){return new ra(t.F)},ra.prototype.has=function(t){return null!=this.si.get(t)},ra.prototype.get=function(t){return this.si.get(t)},ra.prototype.first=function(){return this.ui.ot()},ra.prototype.last=function(){return this.ui.ht()},ra.prototype.M=function(){return this.ui.M()},ra.prototype.indexOf=function(t){var e=this.si.get(t);return e?this.ui.indexOf(e):-1},Object.defineProperty(ra.prototype,"size",{get:function(){return this.ui.size},enumerable:!0,configurable:!0}),ra.prototype.forEach=function(n){this.ui.at(function(t,e){return n(t),!1})},ra.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.si.st(t.key,t),e.ui.st(t,null))},ra.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.si.remove(t),this.ui.remove(e)):this},ra.prototype.isEqual=function(t){if(!(t instanceof ra))return!1;if(this.size!==t.size)return!1;for(var e=this.ui.ft(),n=t.ui.ft();e.bt();){var i=e.gt().key,r=n.gt().key;if(!i.isEqual(r))return!1}return!0},ra.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ra.prototype.copy=function(t,e){var n=new ra;return n.F=this.F,n.si=t,n.ui=e,n},ra),Qs=(ia.prototype.track=function(t){var e=t.doc.key,n=this.hi.get(e);n?0!==t.type&&3===n.type?this.hi=this.hi.st(e,t):3===t.type&&1!==n.type?this.hi=this.hi.st(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.hi=this.hi.st(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.hi=this.hi.st(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.hi=this.hi.remove(e):1===t.type&&2===n.type?this.hi=this.hi.st(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.hi=this.hi.st(e,{type:2,doc:t.doc}):Ta("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.hi=this.hi.st(e,t)},ia.prototype.ai=function(){var n=[];return this.hi.at(function(t,e){n.push(e)}),n},ia),Ys=(na.vi=function(t,e,n,i){var r=[];return e.forEach(function(t){r.push({type:0,doc:t})}),new na(t,e,zs.oi(e),r,n,i,!0,!1)},Object.defineProperty(na.prototype,"hasPendingWrites",{get:function(){return!this.fi.M()},enumerable:!0,configurable:!0}),na.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.li===t.li&&this.fi.isEqual(t.fi)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ci.isEqual(t.ci)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0},na),Ws=(ea.bi=function(t,e){var n=new Map;return n.set(t,Ks.yi(t,e)),new ea($i.MIN,n,js(),Cs(),xs())},ea),Ks=(ta.yi=function(t,e){return new ta(Ar.qt,e,xs(),xs(),xs())},ta),Xs=(Object.defineProperty(Zs.prototype,"_i",{get:function(){return this.Di},enumerable:!0,configurable:!0}),Object.defineProperty(Zs.prototype,"resumeToken",{get:function(){return this.Oi},enumerable:!0,configurable:!0}),Object.defineProperty(Zs.prototype,"Pi",{get:function(){return 0!==this.Ri},enumerable:!0,configurable:!0}),Object.defineProperty(Zs.prototype,"ki",{get:function(){return this.Vi},enumerable:!0,configurable:!0}),Zs.prototype.Fi=function(t){0<t.Mt()&&(this.Vi=!0,this.Oi=t)},Zs.prototype.ji=function(){var n=xs(),i=xs(),r=xs();return this.Ni.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:i=i.add(t);break;case 1:r=r.add(t);break;default:Ta("Encountered invalid change type: "+e)}}),new Ks(this.Oi,this.Di,n,i,r)},Zs.prototype.Ui=function(){this.Vi=!1,this.Ni=sa()},Zs.prototype.Li=function(t,e){this.Vi=!0,this.Ni=this.Ni.st(t,e)},Zs.prototype.Mi=function(t){this.Vi=!0,this.Ni=this.Ni.remove(t)},Zs.prototype.qi=function(){this.Ri+=1},Zs.prototype.xi=function(){this.Ri-=1},Zs.prototype.Bi=function(){this.Vi=!0,this.Di=!0},Zs),Js=($s.prototype.Hi=function(t){for(var e=0,n=t.Ai;e<n.length;e++){var i=n[e];t.Ii instanceof Po?this.Yi(i,t.Ii):t.Ii instanceof Uo&&this.Ki(i,t.key,t.Ii)}for(var r=0,o=t.removedTargetIds;r<o.length;r++)i=o[r],this.Ki(i,t.key,t.Ii)},$s.prototype.Xi=function(n){var i=this;this.$i(n,function(t){var e=i.Zi(t);switch(n.state){case 0:i.te(t)&&e.Fi(n.resumeToken);break;case 1:e.xi(),e.Pi||e.Ui(),e.Fi(n.resumeToken);break;case 2:e.xi(),e.Pi||i.removeTarget(t),Na(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:i.te(t)&&(e.Bi(),e.Fi(n.resumeToken));break;case 4:i.te(t)&&(i.ne(t),e.Fi(n.resumeToken));break;default:Ta("Unknown target watch change state: "+n.state)}})},$s.prototype.$i=function(t,n){0<t.targetIds.length?t.targetIds.forEach(n):this.Wi.forEach(function(t,e){return n(e)})},$s.prototype.ie=function(t){var e=t.targetId,n=t.Ci.count,i=this.ee(e);if(i){var r=i.target;if(r.En())if(0===n){var o=new ir(r.path);this.Ki(e,o,new Uo(o,$i.D()))}else Na(1===n,"Single document existence filter with count: "+n);else this.re(e)!==n&&(this.ne(e),this.Ji=this.Ji.add(e))}},$s.prototype.se=function(r){var o=this,s=new Map;this.Wi.forEach(function(t,e){var n=o.ee(e);if(n){if(t._i&&n.target.En()){var i=new ir(n.target.path);null!==o.Gi.get(i)||o.ue(e,i)||o.Ki(e,i,new Uo(i,r))}t.ki&&(s.set(e,t.ji()),t.Ui())}});var i=xs();this.zi.forEach(function(t,e){var n=!0;e.Pt(function(t){var e=o.ee(t);return!e||2===e.ti||(n=!1)}),n&&(i=i.add(t))});var t=new Ws(r,s,this.Ji,this.Gi,i);return this.Gi=Cs(),this.zi=oa(),this.Ji=new gr(ka),t},$s.prototype.Yi=function(t,e){if(this.te(t)){var n=this.ue(t,e.key)?2:0;this.Zi(t).Li(e.key,n),this.Gi=this.Gi.st(e.key,e),this.zi=this.zi.st(e.key,this.oe(e.key).add(t))}},$s.prototype.Ki=function(t,e,n){if(this.te(t)){var i=this.Zi(t);this.ue(t,e)?i.Li(e,1):i.Mi(e),this.zi=this.zi.st(e,this.oe(e).delete(t)),n&&(this.Gi=this.Gi.st(e,n))}},$s.prototype.removeTarget=function(t){this.Wi.delete(t)},$s.prototype.re=function(t){var e=this.Zi(t).ji();return this.Qi.he(t).size+e.Ti.size-e.Si.size},$s.prototype.qi=function(t){this.Zi(t).qi()},$s.prototype.Zi=function(t){var e=this.Wi.get(t);return e||(e=new Xs,this.Wi.set(t,e)),e},$s.prototype.oe=function(t){var e=this.zi.get(t);return e||(e=new gr(ka),this.zi=this.zi.st(t,e)),e},$s.prototype.te=function(t){var e=null!==this.ee(t);return e||ba("WatchChangeAggregator","Detected inactive target",t),e},$s.prototype.ee=function(t){var e=this.Wi.get(t);return e&&e.Pi?null:this.Qi.ae(t)},$s.prototype.ne=function(e){var n=this;Na(!this.Wi.get(e).Pi,"Should only reset active targets"),this.Wi.set(e,new Xs),this.Qi.he(e).forEach(function(t){n.Ki(e,t,null)})},$s.prototype.ue=function(t,e){return this.Qi.he(t).has(e)},$s);function $s(t){this.Qi=t,this.Wi=new Map,this.Gi=Cs(),this.zi=oa(),this.Ji=new gr(ka)}function Zs(){this.Ri=0,this.Ni=sa(),this.Oi=Ar.qt,this.Di=!1,this.Vi=!0}function ta(t,e,n,i,r){this.resumeToken=t,this._i=e,this.Ti=n,this.Ei=i,this.Si=r}function ea(t,e,n,i,r){this.ni=t,this.wi=e,this.mi=n,this.pi=i,this.gi=r}function na(t,e,n,i,r,o,s,a){this.query=t,this.docs=e,this.ci=n,this.docChanges=i,this.fi=r,this.fromCache=o,this.li=s,this.di=a}function ia(){this.hi=new rr(ir.F)}function ra(n){this.F=n?function(t,e){return n(t,e)||ir.F(t.key,e.key)}:function(t,e){return ir.F(t.key,e.key)},this.si=Ps(),this.ui=new rr(this.F)}function oa(){return new rr(ir.F)}function sa(){return new rr(ir.F)}var aa,ua,ha=((aa={})[Yo.ASCENDING.name]="ASCENDING",aa[Yo.DESCENDING.name]="DESCENDING",aa),ca=((ua={})[qo.LESS_THAN.name]="LESS_THAN",ua[qo.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",ua[qo.GREATER_THAN.name]="GREATER_THAN",ua[qo.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",ua[qo.EQUAL.name]="EQUAL",ua[qo.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",ua[qo.IN.name]="IN",ua[qo.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",ua);function la(t,e){Na(!kr(t),e+" is missing")}var fa=(pa.prototype.fe=function(t){var e=void 0===t.code?Mi.UNKNOWN:Ds(t.code);return new Fi(e,t.message||"")},pa.prototype.le=function(t){return this.options.de||kr(t)?t:{value:t}},pa.prototype.ve=function(t){var e;return kr(e="object"==typeof t?t.value:t)?null:e},pa.prototype.Gt=function(t){return{integerValue:""+t}},pa.prototype.zt=function(t){if(this.options.de){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Rr(t)?"-0":t}},pa.prototype.we=function(t){return _r(t)?this.Gt(t):this.zt(t)},pa.prototype.k=function(t){return this.options.de?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},pa.prototype.O=function(t){var e=xr(t);return new Ji(e.seconds,e.nanos)},pa.prototype.me=function(t){return this.options.de?t.toBase64():t.toUint8Array()},pa.prototype.pe=function(t){return this.options.de?(Na(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),Ar.fromBase64String(t||"")):(Na(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),Ar.fromUint8Array(t||new Uint8Array))},pa.prototype.toVersion=function(t){return this.k(t.k())},pa.prototype.fromVersion=function(t){return Na(!!t,"Trying to deserialize version that isn't set"),$i.O(this.O(t))},pa.prototype.ge=function(t,e){return this.be(e||this.ce).child("documents").child(t).H()},pa.prototype.ye=function(t){var e=tr.Y(t);return Na(da(e),"Tried to deserialize invalid key "+e.toString()),e},pa.prototype._e=function(t){return this.ge(t.path)},pa.prototype.it=function(t){var e=this.ye(t);return Na(e.get(1)===this.ce.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.ce.projectId),Na(!e.get(3)&&!this.ce.database||e.get(3)===this.ce.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.ce.database),new ir(this.Te(e))},pa.prototype.Ee=function(t){return this.ge(t)},pa.prototype.Se=function(t){var e=this.ye(t);return 4===e.length?tr.K:this.Te(e)},Object.defineProperty(pa.prototype,"Ae",{get:function(){return new tr(["projects",this.ce.projectId,"databases",this.ce.database]).H()},enumerable:!0,configurable:!0}),pa.prototype.be=function(t){return new tr(["projects",t.projectId,"databases",t.database])},pa.prototype.Te=function(t){return Na(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.U(5)},pa.prototype.Ie=function(t,e){return{name:this._e(t),fields:e.proto.mapValue.fields}},pa.prototype.Ce=function(t){return Na(!t.nn,"Can't serialize documents with mutations."),{name:this._e(t.key),fields:t.yn().mapValue.fields,updateTime:this.k(t.version.k())}},pa.prototype.Re=function(t,e){var n=this.it(t.name),i=this.fromVersion(t.updateTime),r=new Co({mapValue:{fields:t.fields}});return new Po(n,i,r,{hasCommittedMutations:!!e})},pa.prototype.Ne=function(t){Na(!!t.found,"Tried to deserialize a found document from a missing document."),la(t.found.name,"doc.found.name"),la(t.found.updateTime,"doc.found.updateTime");var e=this.it(t.found.name),n=this.fromVersion(t.found.updateTime),i=new Co({mapValue:{fields:t.found.fields}});return new Po(e,n,i,{})},pa.prototype.Oe=function(t){Na(!!t.missing,"Tried to deserialize a missing document from a found document."),Na(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.it(t.missing),n=this.fromVersion(t.readTime);return new Uo(e,n)},pa.prototype.De=function(t){return"found"in t?this.Ne(t):"missing"in t?this.Oe(t):Ta("invalid batch get response: "+JSON.stringify(t))},pa.prototype.Ve=function(t){var e;if("targetChange"in t){la(t.targetChange,"targetChange");var n=this.Pe(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],r=this.pe(t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&this.fe(o);e=new Hs(n,i,r,s||null)}else if("documentChange"in t){la(t.documentChange,"documentChange");var a=t.documentChange;la(a.document,"documentChange.name"),la(a.document.name,"documentChange.document.name"),la(a.document.updateTime,"documentChange.document.updateTime");var u=this.it(a.document.name),h=this.fromVersion(a.document.updateTime),c=new Co({mapValue:{fields:a.document.fields}}),l=new Po(u,h,c,{}),f=a.targetIds||[],p=a.removedTargetIds||[];e=new Gs(f,p,l.key,l)}else if("documentDelete"in t){la(t.documentDelete,"documentDelete");var d=t.documentDelete;la(d.document,"documentDelete.document"),u=this.it(d.document),h=d.readTime?this.fromVersion(d.readTime):$i.D(),l=new Uo(u,h),p=d.removedTargetIds||[],e=new Gs([],p,l.key,l)}else if("documentRemove"in t){la(t.documentRemove,"documentRemove");var y=t.documentRemove;la(y.document,"documentRemove"),u=this.it(y.document),p=y.removedTargetIds||[],e=new Gs([],p,u,null)}else{if(!("filter"in t))return Ta("Unknown change type "+JSON.stringify(t));la(t.filter,"filter");var v=t.filter;la(v.targetId,"filter.targetId");var m=v.count||0,g=new Zo(m),w=v.targetId;e=new Bs(w,g)}return e},pa.prototype.Pe=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ta("Got unexpected TargetChange.state: "+t)},pa.prototype.ke=function(t){if(!("targetChange"in t))return $i.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?$i.MIN:e.readTime?this.fromVersion(e.readTime):$i.MIN},pa.prototype.Fe=function(t){var e,n=this;if(t instanceof ko)e={update:this.Ie(t.key,t.value)};else if(t instanceof Do)e={delete:this._e(t.key)};else if(t instanceof Ro)e={update:this.Ie(t.key,t.data),updateMask:this.je(t.en)};else if(t instanceof _o)e={transform:{document:this._e(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Ue(t)})}};else{if(!(t instanceof Oo))return Ta("Unknown mutation type "+t.type);e={verify:this._e(t.key)}}return t.tn.Kt||(e.currentDocument=this.Le(t.tn)),e},pa.prototype.Me=function(t){var e=this,n=t.currentDocument?this.qe(t.currentDocument):Ao.NONE;if(t.update){la(t.update.name,"name");var i=this.it(t.update.name),r=new Co({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.xe(t.updateMask);return new Ro(i,r,o,n)}return new ko(i,r,n)}if(t.delete)return i=this.it(t.delete),new Do(i,n);if(t.transform){i=this.it(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.Be(t)});return Na(!0===n.exists,'Transforms only support precondition "exists == true"'),new _o(i,s)}return t.verify?(i=this.it(t.verify),new Oo(i,n)):Ta("unknown mutation proto: "+JSON.stringify(t))},pa.prototype.Le=function(t){return Na(!t.Kt,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ta("Unknown precondition")},pa.prototype.qe=function(t){return void 0!==t.updateTime?Ao.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Ao.exists(t.exists):Ao.NONE},pa.prototype.Qe=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual($i.MIN)&&(n=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults),new oo(n,i)},pa.prototype.We=function(t,e){var n=this;return t&&0<t.length?(Na(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.Qe(t,e)})):[]},pa.prototype.Ue=function(t){var e=t.transform;if(e instanceof Xr)return{fieldPath:t.field.H(),setToServerValue:"REQUEST_TIME"};if(e instanceof Jr)return{fieldPath:t.field.H(),appendMissingElements:{values:e.elements}};if(e instanceof $r)return{fieldPath:t.field.H(),removeAllFromArray:{values:e.elements}};if(e instanceof Zr)return{fieldPath:t.field.H(),increment:e.Wt};throw Ta("Unknown transform: "+t.transform)},pa.prototype.Be=function(t){var e=null;if("setToServerValue"in t)Na("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),e=Xr.instance;else if("appendMissingElements"in t){var n=t.appendMissingElements.values||[];e=new Jr(n)}else"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],e=new $r(n)):"increment"in t?e=new Zr(this,t.increment):Ta("Unknown transform proto: "+JSON.stringify(t));var i=nr.tt(t.fieldPath);return new No(i,e)},pa.prototype.Ge=function(t){return{documents:[this.Ee(t.path)]}},pa.prototype.ze=function(t){var e=t.documents.length;Na(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return xo.Nn(this.Se(n)).xn()},pa.prototype.Je=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Na(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.Ee(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Na(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.Ee(n.L()),e.structuredQuery.from=[{collectionId:n.B()}]);var i=this.He(t.filters);i&&(e.structuredQuery.where=i);var r=this.Ye(t.orderBy);r&&(e.structuredQuery.orderBy=r);var o=this.le(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Ke(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Ke(t.endAt)),e},pa.prototype.Xe=function(t){var e=this.Se(t.parent),n=t.structuredQuery,i=n.from?n.from.length:0,r=null;if(0<i){Na(1===i,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?r=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.$e(n.where));var a=[];n.orderBy&&(a=this.Ze(n.orderBy));var u=null;n.limit&&(u=this.ve(n.limit));var h=null;n.startAt&&(h=this.tr(n.startAt));var c=null;return n.endAt&&(c=this.tr(n.endAt)),new xo(e,r,a,s,u,"F",h,c).xn()},pa.prototype.nr=function(t){var e=this.ir(t.ti);return null==e?null:{"goog-listen-tags":e}},pa.prototype.ir=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ta("Unrecognized query purpose: "+t)}},pa.prototype.xn=function(t){var e,n=t.target;return(e=n.En()?{documents:this.Ge(n)}:{query:this.Je(n)}).targetId=t.targetId,0<t.resumeToken.Mt()&&(e.resumeToken=this.me(t.resumeToken)),e},pa.prototype.He=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof jo?e.er(t):Ta("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},pa.prototype.$e=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.rr(t)]:void 0!==t.fieldFilter?[this.sr(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.$e(t)}).reduce(function(t,e){return t.concat(e)}):Ta("Unknown filter: "+JSON.stringify(t)):[]},pa.prototype.Ye=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.ur(t)})},pa.prototype.Ze=function(t){var e=this;return t.map(function(t){return e.or(t)})},pa.prototype.Ke=function(t){return{before:t.before,values:t.position}},pa.prototype.tr=function(t){var e=!!t.before,n=t.values||[];return new Wo(n,e)},pa.prototype.hr=function(t){return ha[t.name]},pa.prototype.ar=function(t){switch(t){case"ASCENDING":return Yo.ASCENDING;case"DESCENDING":return Yo.DESCENDING;default:return}},pa.prototype.cr=function(t){return ca[t.name]},pa.prototype.lr=function(t){switch(t){case"EQUAL":return qo.EQUAL;case"GREATER_THAN":return qo.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return qo.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return qo.LESS_THAN;case"LESS_THAN_OR_EQUAL":return qo.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return qo.ARRAY_CONTAINS;case"IN":return qo.IN;case"ARRAY_CONTAINS_ANY":return qo.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Ta("Unspecified operator");default:return Ta("Unknown operator")}},pa.prototype.dr=function(t){return{fieldPath:t.H()}},pa.prototype.vr=function(t){return nr.tt(t.fieldPath)},pa.prototype.ur=function(t){return{field:this.dr(t.field),direction:this.hr(t.dir)}},pa.prototype.or=function(t){return new Ko(this.vr(t.field),this.ar(t.direction))},pa.prototype.sr=function(t){return jo.create(this.vr(t.fieldFilter.field),this.lr(t.fieldFilter.op),t.fieldFilter.value)},pa.prototype.er=function(t){if(t.op===qo.EQUAL){if(Wr(t.value))return{unaryFilter:{field:this.dr(t.field),op:"IS_NAN"}};if(Yr(t.value))return{unaryFilter:{field:this.dr(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.dr(t.field),op:this.cr(t.op),value:t.value}}},pa.prototype.rr=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.vr(t.unaryFilter.field);return jo.create(e,qo.EQUAL,{doubleValue:NaN});case"IS_NULL":var n=this.vr(t.unaryFilter.field);return jo.create(n,qo.EQUAL,{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ta("Unspecified filter");default:return Ta("Unknown filter")}},pa.prototype.je=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.H())}),{fieldPaths:e}},pa.prototype.xe=function(t){var e=(t.fieldPaths||[]).map(function(t){return nr.tt(t)});return To.Ht(e)},pa);function pa(t,e){this.ce=t,this.options=e}function da(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var ya=(ma.wr=function(t){ma.platform&&Ta("Platform already defined"),ma.platform=t},ma.Lt=function(){return ma.platform||Ta("Platform not set"),ma.platform},ma),va=new f("@firebase/firestore");function ma(){}function ga(){return va.logLevel}function wa(t){va.logLevel=t}function ba(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(va.logLevel<=a.DEBUG){var i=e.map(Ia);va.error.apply(va,r(["Firestore ("+Pi+"): "+t],i))}}function Ea(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(va.logLevel<=a.ERROR){var i=e.map(Ia);va.error.apply(va,r(["Firestore ("+Pi+"): "+t],i))}}function Ia(t){if("string"==typeof t)return t;var e=ya.Lt();try{return e.mr(t)}catch(e){return t}}function Ta(t){var e="FIRESTORE ("+Pi+") INTERNAL ASSERTION FAILED: "+t;throw Ea(e),new Error(e)}function Na(t,e){t||Ta(e)}var Aa=(Sa.pr=function(){for(var t="";t.length<20;)for(var e=ya.Lt().randomBytes(40),n=0,i=Array.from(e);n<i.length;n++){var r=i[n];t.length<20&&r<=247&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r%62))}return Na(20===t.length,"Invalid auto ID: "+t),t},Sa);function Sa(){}function ka(t,e){return t<e?-1:e<t?1:0}function Ra(t,n,i){return t.length===n.length&&t.every(function(t,e){return i(t,n[e])})}function _a(t,e,n,i,r){this.ce=t,this.persistenceKey=e,this.host=n,this.ssl=i,this.forceLongPolling=r}function Da(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Oa=(Object.defineProperty(Wa.prototype,"gr",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),Wa.prototype.isEqual=function(t){return t instanceof Wa&&t.projectId===this.projectId&&t.database===this.database},Wa.prototype.V=function(t){return ka(this.projectId,t.projectId)||ka(this.database,t.database)},Wa),Ca=(Ya.prototype.Bt=function(t,e,n){e&&Na(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var i=n.yr;Na(i.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+i.length+").");for(var r=0;r<this.mutations.length;r++){var o=this.mutations[r];if(o.key.isEqual(t)){var s=i[r];e=o.Bt(e,s)}}return e},Ya.prototype.xt=function(t,e){e&&Na(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,i=this.baseMutations;n<i.length;n++)(a=i[n]).key.isEqual(t)&&(e=a.xt(e,e,this.br));for(var r=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.xt(e,r,this.br))}return e},Ya.prototype._r=function(n){var i=this,r=n;return this.mutations.forEach(function(t){var e=i.xt(t.key,n.get(t.key));e&&(r=r.st(t.key,e))}),r},Ya.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},xs())},Ya.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ra(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&Ra(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},Ya),La=(Qa.from=function(t,e,n,i){Na(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var r=Ms(),o=t.mutations,s=0;s<o.length;s++)r=r.st(o[s].key,n[s].version);return new Qa(t,e,n,i,r)},Qa),Va=(za.prototype.get=function(t){var e=this.Sr(t),n=this.Ar[e];if(void 0!==n)for(var i=0,r=n;i<r.length;i++){var o=r[i],s=o[0],a=o[1];if(s.isEqual(t))return a}},za.prototype.has=function(t){return void 0!==this.get(t)},za.prototype.set=function(t,e){var n=this.Sr(t),i=this.Ar[n];if(void 0!==i){for(var r=0;r<i.length;r++)if(i[r][0].isEqual(t))return void(i[r]=[t,e]);i.push([t,e])}else this.Ar[n]=[[t,e]]},za.prototype.delete=function(t){var e=this.Sr(t),n=this.Ar[e];if(void 0===n)return!1;for(var i=0;i<n.length;i++)if(n[i][0].isEqual(t))return 1===n.length?delete this.Ar[e]:n.splice(i,1),!0;return!1},za.prototype.forEach=function(a){Tr(this.Ar,function(t,e){for(var n=0,i=e;n<i.length;n++){var r=i[n],o=r[0],s=r[1];a(o,s)}})},za.prototype.M=function(){return Nr(this.Ar)},za),Pa=(Ha.Rr=function(t,e){for(var n=xs(),i=xs(),r=0,o=e.docChanges;r<o.length;r++){var s=o[r];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new Ha(t,e.fromCache,n,i)},Ha),Ua=(Ba.prototype.Or=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ba.prototype.next=function(){var t=++this.previousValue;return this.Dr&&this.Dr(t),t},Ba.Pr=-1,Ba),Ma=(Ga.Mr=function(t,e,n,i,r){var o=new Ga(t,e,Date.now()+n,i,r);return o.start(n),o},Ga.prototype.start=function(t){var e=this;this.qr=setTimeout(function(){return e.xr()},t)},Ga.prototype.Br=function(){return this.xr()},Ga.prototype.cancel=function(t){null!==this.qr&&(this.clearTimeout(),this.Lr.reject(new Fi(Mi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ga.prototype.xr=function(){var e=this;this.kr.Qr(function(){return null!==e.qr?(e.clearTimeout(),e.op().then(function(t){return e.Lr.resolve(t)})):Promise.resolve()})},Ga.prototype.clearTimeout=function(){null!==this.qr&&(this.Ur(this),clearTimeout(this.qr),this.qr=null)},Ga),Fa=(Object.defineProperty(ja.prototype,"Kr",{get:function(){return this.Gr},enumerable:!0,configurable:!0}),ja.prototype.Qr=function(t){this.enqueue(t)},ja.prototype.Xr=function(t){this.$r(),this.Zr(t)},ja.prototype.ts=function(t){return this.$r(),this.Zr(t)},ja.prototype.ns=function(e){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.$r(),this.Gr?[3,2]:(this.Gr=!0,[4,this.ts(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},ja.prototype.enqueue=function(t){return this.$r(),this.Gr?new Promise(function(t){}):this.Zr(t)},ja.prototype.Zr=function(t){var n=this,e=this.Wr.then(function(){return n.Hr=!0,t().catch(function(t){n.Jr=t,n.Hr=!1;var e=t.stack||t.message||"";throw Ea("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.Hr=!1,t})});return this.Wr=e},ja.prototype.es=function(t,e,n){var i=this;this.$r(),Na(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.Yr.indexOf(t)&&(e=0);var r=Ma.Mr(this,t,e,n,function(t){return i.rs(t)});return this.zr.push(r),r},ja.prototype.$r=function(){this.Jr&&Ta("AsyncQueue is already failed: "+(this.Jr.stack||this.Jr.message))},ja.prototype.ss=function(){Na(this.Hr,"verifyOpInProgress() called when no op in progress on this queue.")},ja.prototype.us=function(){return c(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return[4,e=this.Wr];case 1:t.sent(),t.label=2;case 2:if(e!==this.Wr)return[3,0];t.label=3;case 3:return[2]}})})},ja.prototype.os=function(t){for(var e=0,n=this.zr;e<n.length;e++)if(n[e].Fr===t)return!0;return!1},ja.prototype.hs=function(i){var r=this;return this.us().then(function(){Na("all"===i||r.os(i),"Attempted to drain to missing operation "+i),r.zr.sort(function(t,e){return t.jr-e.jr});for(var t=0,e=r.zr;t<e.length;t++){var n=e[t];if(n.Br(),"all"!==i&&n.Fr===i)break}return r.us()})},ja.prototype.as=function(t){this.Yr.push(t)},ja.prototype.rs=function(t){var e=this.zr.indexOf(t);Na(0<=e,"Delayed operation not found."),this.zr.splice(e,1)},ja),xa=(qa.prototype.catch=function(t){return this.next(void 0,t)},qa.prototype.next=function(i,r){var o=this;return this.ds&&Ta("Called next() or catch() twice for PersistencePromise"),this.ds=!0,this.ls?this.error?this.vs(r,this.error):this.ws(i,this.result):new qa(function(e,n){o.cs=function(t){o.ws(i,t).next(e,n)},o.fs=function(t){o.vs(r,t).next(e,n)}})},qa.prototype.ms=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},qa.prototype.ps=function(t){try{var e=t();return e instanceof qa?e:qa.resolve(e)}catch(t){return qa.reject(t)}},qa.prototype.ws=function(t,e){return t?this.ps(function(){return t(e)}):qa.resolve(e)},qa.prototype.vs=function(t,e){return t?this.ps(function(){return t(e)}):qa.reject(e)},qa.resolve=function(n){return new qa(function(t,e){t(n)})},qa.reject=function(n){return new qa(function(t,e){e(n)})},qa.gs=function(t){return new qa(function(e,n){var i=0,r=0,o=!1;t.forEach(function(t){++i,t.next(function(){++r,o&&r===i&&e()},function(t){return n(t)})}),o=!0,r===i&&e()})},qa.bs=function(t){for(var n=qa.resolve(!1),e=function(e){n=n.next(function(t){return t?qa.resolve(t):e()})},i=0,r=t;i<r.length;i++)e(r[i]);return n},qa.forEach=function(t,n){var i=this,r=[];return t.forEach(function(t,e){r.push(n.call(i,t,e))}),this.gs(r)},qa);function qa(t){var e=this;this.cs=null,this.fs=null,this.result=void 0,this.error=void 0,this.ls=!1,this.ds=!1,t(function(t){e.ls=!0,e.result=t,e.cs&&e.cs(t)},function(t){e.ls=!0,e.error=t,e.fs&&e.fs(t)})}function ja(){this.Wr=Promise.resolve(),this.Gr=!1,this.zr=[],this.Jr=null,this.Hr=!1,this.Yr=[]}function Ga(t,e,n,i,r){this.kr=t,this.Fr=e,this.jr=n,this.op=i,this.Ur=r,this.Lr=new Da,this.then=this.Lr.promise.then.bind(this.Lr.promise),this.catch=this.Lr.promise.catch.bind(this.Lr.promise),this.Lr.promise.catch(function(t){})}function Ba(t,e){var n=this;this.previousValue=t,e&&(e.Nr=function(t){return n.Or(t)},this.Dr=function(t){return e.Vr(t)})}function Ha(t,e,n,i){this.targetId=t,this.fromCache=e,this.Ir=n,this.Cr=i}function za(t){this.Sr=t,this.Ar={}}function Qa(t,e,n,i,r){this.batch=t,this.Tr=e,this.yr=n,this.streamToken=i,this.Er=r}function Ya(t,e,n,i){this.batchId=t,this.br=e,this.baseMutations=n,Na(0<(this.mutations=i).length,"Cannot create an empty mutation batch")}function Wa(t,e){this.projectId=t,this.database=e||"(default)"}function Ka(t,e){var n=t[0],i=t[1],r=e[0],o=e[1],s=ka(n,r);return 0===s?ka(i,o):s}function Xa(t){this.ys=t,this.buffer=new gr(Ka),this._s=0}Xa.prototype.Ts=function(){return++this._s},Xa.prototype.Es=function(t){var e=[t,this.Ts()];if(this.buffer.size<this.ys)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ka(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Xa.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0});var Ja=(au.Cs=function(t){return new au(t,au.Rs,au.Ns)},au.Os=-1,au.Ds=1048576,au.Ps=new au(au.Vs=41943040,au.Rs=10,au.Ns=1e3),au.DISABLED=new au(au.Os,0,0),au),$a=(su.prototype.start=function(t){Na(null===this.js,"Cannot start an already started LruScheduler"),this.ks.params.Ss!==Ja.Os&&this.Us(t)},su.prototype.stop=function(){this.js&&(this.js.cancel(),this.js=null)},Object.defineProperty(su.prototype,"Ls",{get:function(){return null!==this.js},enumerable:!0,configurable:!0}),su.prototype.Us=function(t){var e=this;Na(null===this.js,"Cannot schedule GC while a task is pending");var n=this.Fs?3e5:6e4;ba("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.js=this.kr.es("lru_garbage_collection",n,function(){return e.js=null,e.Fs=!0,t.Ms(e.ks).then(function(){return e.Us(t)}).catch(uu)})},ou.prototype.M=function(){return this.qs.M()},ou.prototype.Qs=function(t,e){var n=new Za(t,e);this.qs=this.qs.add(n),this.xs=this.xs.add(n)},ou.prototype.Ws=function(t,e){var n=this;t.forEach(function(t){return n.Qs(t,e)})},ou.prototype.Gs=function(t,e){this.zs(new Za(t,e))},ou.prototype.Js=function(t,e){var n=this;t.forEach(function(t){return n.Gs(t,e)})},ou.prototype.Hs=function(t){var e=this,n=ir.EMPTY,i=new Za(n,t),r=new Za(n,t+1),o=[];return this.xs.Vt([i,r],function(t){e.zs(t),o.push(t.key)}),o},ou.prototype.Ys=function(){var e=this;this.qs.forEach(function(t){return e.zs(t)})},ou.prototype.zs=function(t){this.qs=this.qs.delete(t),this.xs=this.xs.delete(t)},ou.prototype.Ks=function(t){var e=ir.EMPTY,n=new Za(e,t),i=new Za(e,t+1),r=xs();return this.xs.Vt([n,i],function(t){r=r.add(t.key)}),r},ou.prototype.Xs=function(t){var e=new Za(t,0),n=this.qs.kt(e);return null!==n&&t.isEqual(n.key)},ou),Za=(ru.gn=function(t,e){return ir.F(t.key,e.key)||ka(t.$s,e.$s)},ru.Bs=function(t,e){return ka(t.$s,e.$s)||ir.F(t.key,e.key)},ru),tu=(Object.defineProperty(iu.prototype,"readTime",{get:function(){return Na(void 0!==this.nu,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.nu},set:function(t){Na(void 0===this.nu||this.nu.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.nu=t},enumerable:!0,configurable:!0}),iu.prototype.iu=function(t,e){this.eu(),this.readTime=e,this.Zs.set(t.key,t)},iu.prototype.ru=function(t,e){this.eu(),e&&(this.readTime=e),this.Zs.set(t,null)},iu.prototype.su=function(t,e){this.eu();var n=this.Zs.get(e);return void 0!==n?xa.resolve(n):this.uu(t,e)},iu.prototype.getEntries=function(t,e){return this.ou(t,e)},iu.prototype.apply=function(t){return this.eu(),this.tu=!0,this.hu(t)},iu.prototype.eu=function(){Na(!this.tu,"Changes have already been applied.")},iu),eu=(nu.prototype.start=function(){return this.Au()},nu.prototype.Iu=function(r){return c(this,void 0,void 0,function(){var e,v,n,i=this;return y(this,function(t){switch(t.label){case 0:return e=this.mu,v=this.Tu,[4,this.persistence.runTransaction("Handle user change","readonly",function(d){var y;return i.mu.Cu(d).next(function(t){return y=t,e=i.persistence.pu(r),v=new Su(i.gu,e,i.persistence.Eu()),e.Cu(d)}).next(function(t){for(var e=[],n=[],i=xs(),r=0,o=y;r<o.length;r++){var s=o[r];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++){var h=u[a];i=i.add(h.key)}}for(var c=0,l=t;c<l.length;c++){s=l[c],n.push(s.batchId);for(var f=0,p=s.mutations;f<p.length;f++)h=p[f],i=i.add(h.key)}return v.Ru(d,i).next(function(t){return{Nu:t,Ou:e,Du:n}})})})];case 1:return n=t.sent(),this.mu=e,this.Tu=v,this.au.Su(this.Tu),[2,n]}})})},nu.prototype.Vu=function(a){var u,h=this,c=Ji.now(),t=a.reduce(function(t,e){return t.add(e.key)},xs());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.Tu.Ru(s,t).next(function(t){u=t;for(var e=[],n=0,i=a;n<i.length;n++){var r=i[n],o=r.in(u.get(r.key));null!=o&&e.push(new Ro(r.key,o,o.en(),Ao.exists(!0)))}return h.mu.Pu(s,c,e,a)})}).then(function(t){var e=t._r(u);return{batchId:t.batchId,Zs:e}})},nu.prototype.ku=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mu.Fu(e,t).next(function(t){return t?n.Tu.Ru(e,t):xa.resolve(null)})})},nu.prototype.ju=function(i){var r=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=i.batch.keys(),n=r.gu.Uu({Lu:!0});return r.mu.ju(t,i.batch,i.streamToken).next(function(){return r.Mu(t,i,n)}).next(function(){return n.apply(t)}).next(function(){return r.mu.qu(t)}).next(function(){return r.Tu.Ru(t,e)})})},nu.prototype.xu=function(t){var i=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.mu.Bu(e,t).next(function(t){return Na(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),i.mu.Qu(e,t)}).next(function(){return i.mu.qu(e)}).next(function(){return i.Tu.Ru(e,n)})})},nu.prototype.Wu=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.mu.Wu(t)})},nu.prototype.Gu=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mu.Gu(t)})},nu.prototype.zu=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mu.zu(t,e)})},nu.prototype.Ju=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.yu.Ju(t)})},nu.prototype.Hu=function(u){var h=this,c=u.ni,l=this.fu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var r=h.gu.Uu({Lu:!0});l=h.fu;var s=[];u.wi.forEach(function(t,e){var n=l.get(e);if(n){s.push(h.yu.Yu(o,t.Si,e).next(function(){return h.yu.Ku(o,t.Ti,e)}));var i=t.resumeToken;if(0<i.Mt()){var r=n.ei(i,c).ii(o.Xu);l=l.st(e,r),nu.$u(n,r,t)&&s.push(h.yu.Zu(o,r))}}});var a=Cs(),n=xs();if(u.pi.forEach(function(t,e){n=n.add(t)}),s.push(r.getEntries(o,n).next(function(i){u.pi.forEach(function(t,e){var n=i.get(t);e instanceof Uo&&e.version.isEqual($i.MIN)?(r.ru(t,c),a=a.st(t,e)):null==n||0<e.version.V(n.version)||0===e.version.V(n.version)&&n.hasPendingWrites?(Na(!$i.MIN.isEqual(c),"Cannot add a document when the remote version is zero"),r.iu(e,c),a=a.st(t,e)):ba("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.gi.has(t)&&s.push(h.persistence.wu.to(o,t))})})),!c.isEqual($i.MIN)){var t=h.yu.Ju(o).next(function(t){return Na(0<=c.V(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),h.yu.no(o,o.Xu,c)});s.push(t)}return xa.gs(s).next(function(){return r.apply(o)}).next(function(){return h.Tu.io(o,a)})}).then(function(t){return h.fu=l,t})},nu.$u=function(t,e,n){return Na(0<e.resumeToken.Mt(),"Attempted to persist target data with no resume token"),0===t.resumeToken.Mt()||e.ni.P()-t.ni.P()>=this.eo||0<n.Ti.size+n.Ei.size+n.Si.size},nu.prototype.ro=function(t){for(var n=this,e=0,i=t;e<i.length;e++){var r=i[e],o=r.targetId;if(this.cu.Ws(r.Ir,o),this.cu.Js(r.Cr,o),!r.fromCache){var s=this.fu.get(o);Na(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.ni,u=s.ri(a);this.fu=this.fu.st(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return xa.forEach(t,function(t){return xa.forEach(t.Cr,function(t){return n.persistence.wu.Gs(e,t)})})})},nu.prototype.so=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mu.uo(t,e)})},nu.prototype.oo=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.Tu.ho(t,e)})},nu.prototype.ao=function(i){var r=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return r.yu.co(e,i).next(function(t){return t?(n=t,xa.resolve(n)):r.yu.fo(e).next(function(t){return n=new $o(i,t,0,e.Xu),r.yu.lo(e,n).next(function(){return n})})})}).then(function(t){return null===r.fu.get(t.targetId)&&(r.fu=r.fu.st(t.targetId,t),r.lu.set(i,t.targetId)),t})},nu.prototype.co=function(t,e){var n=this.lu.get(e);return void 0!==n?xa.resolve(this.fu.get(n)):this.yu.co(t,e)},nu.prototype.do=function(n,i){var r=this,o=this.fu.get(n);Na(null!==o,"Tried to release nonexistent target: "+n);var t=i?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",t,function(e){var t=r.cu.Hs(n);return i?xa.resolve():xa.forEach(t,function(t){return r.persistence.wu.Gs(e,t)}).next(function(){r.persistence.wu.removeTarget(e,o)})}).then(function(){r.fu=r.fu.remove(n),r.lu.delete(o.target)})},nu.prototype.vo=function(t,n){var i=this,r=$i.MIN,o=xs();return this.persistence.runTransaction("Execute query","readonly",function(e){return i.co(e,t.xn()).next(function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,i.yu.wo(e,t.targetId).next(function(t){o=t})}).next(function(){return i.au.mo(e,t,n?r:$i.MIN,n?o:xs())}).next(function(t){return{documents:t,po:o}})})},nu.prototype.bo=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.yu.wo(t,e)})},nu.prototype.yo=function(){return this.persistence.yo()},nu.prototype._o=function(t){this.mu.To(t)},nu.prototype.Eo=function(t){this.persistence.Eo(t)},nu.prototype.Mu=function(t,r,o){var e=this,s=r.batch,n=s.keys(),a=xa.resolve();return n.forEach(function(i){a=a.next(function(){return o.su(t,i)}).next(function(t){var e=t,n=r.Er.get(i);Na(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.V(n)<0)&&((e=s.Bt(i,e,r))?o.iu(e,r.Tr):Na(!t,"Mutation batch "+s+" applied to document "+t+" resulted in null"))})}),a.next(function(){return e.mu.Qu(t,s)})},nu.prototype.Ms=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.So(t,n.fu)})},nu.prototype.Ao=function(e){var n=this,t=this.fu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.yu.ae(t,e).next(function(t){return t?t.target:null})})},nu.prototype.Io=function(){var i=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return i.gu.Io(t,i.du)}).then(function(t){var e=t.Co,n=t.readTime;return i.du=n,e})},nu.prototype.Au=function(){return c(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.gu.Ro(t)})];case 1:return e.du=t.sent(),[2]}})})},nu.eo=3e8,nu);function nu(t,e,n){this.persistence=t,this.au=e,this.cu=new $a,this.fu=new rr(ka),this.lu=new Va(function(t){return t.canonicalId()}),this.du=$i.MIN,Na(t.Ls,"LocalStore was passed an unstarted persistence implementation"),this.persistence.wu.vu(this.cu),this.mu=t.pu(n),this.gu=t.bu(),this.yu=t._u(),this.Tu=new Su(this.gu,this.mu,this.persistence.Eu()),this.au.Su(this.Tu)}function iu(){this.Zs=new Va(function(t){return t.toString()}),this.tu=!1}function ru(t,e){this.key=t,this.$s=e}function ou(){this.qs=new gr(Za.gn),this.xs=new gr(Za.Bs)}function su(t,e){this.ks=t,this.kr=e,this.Fs=!1,this.js=null}function au(t,e,n){this.Ss=t,this.As=e,this.Is=n}function uu(e){return c(this,void 0,void 0,function(){return y(this,function(t){if(e.code!==Mi.FAILED_PRECONDITION||e.message!==Nu)throw e;return ba("LocalStore","Unexpectedly lost primary lease"),[2]})})}function hu(t,e){return Na(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),"firestore_clients_"+t+"_"+e}function cu(t,e,n){var i="firestore_mutations_"+t+"_"+n;return e.t()&&(i+="_"+e.uid),i}function lu(t,e){return"firestore_targets_"+t+"_"+e}var fu=(Eu.No=function(t,e,n){var i=JSON.parse(n),r="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),o=void 0;return r&&i.error&&(r="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(o=new Fi(i.error.code,i.error.message)),r?new Eu(t,e,i.state,o):(Ea("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Eu.prototype.Oo=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Eu),pu=(bu.No=function(t,e){var n=JSON.parse(e),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),r=void 0;return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new Fi(n.error.code,n.error.message)),i?new bu(t,n.state,r):(Ea("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},bu.prototype.Oo=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},bu),du=(wu.No=function(t,e){for(var n=JSON.parse(e),i="object"==typeof n&&n.activeTargetIds instanceof Array,r=js(),o=0;i&&o<n.activeTargetIds.length;++o)i=_r(n.activeTargetIds[o]),r=r.add(n.activeTargetIds[o]);return i?new wu(t,r):(Ea("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},wu),yu=(gu.No=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new gu(e.clientId,e.onlineState):(Ea("SharedClientState","Failed to parse online state: "+t),null)},gu),vu=(mu.prototype.Do=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},mu.prototype.Vo=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},mu.prototype.Oo=function(){var t={activeTargetIds:this.activeTargetIds.J(),updateTimeMs:Date.now()};return JSON.stringify(t)},mu);function mu(){this.activeTargetIds=js()}function gu(t,e){this.clientId=t,this.onlineState=e}function wu(t,e){this.clientId=t,this.activeTargetIds=e}function bu(t,e,n){this.targetId=t,this.state=e,Na(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function Eu(t,e,n,i){this.user=t,this.batchId=e,this.state=n,Na(void 0!==(this.error=i)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}function Iu(t,e,n,i,r){if(this.Po=t,this.platform=e,this.persistenceKey=n,this.ko=i,this.Fo=null,this.jo=null,this.Nr=null,this.Uo={},this.Lo=this.Mo.bind(this),this.Ls=!1,this.qo=[],!Iu.xo(this.platform))throw new Fi(Mi.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=r,this.Bo=hu(this.persistenceKey,this.ko),this.Qo="firestore_sequence_number_"+this.persistenceKey,this.Uo[this.ko]=new vu,this.Wo=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Go=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.zo=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Jo="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Lo)}Iu.xo=function(t){return!(!t.window||null==t.window.localStorage)},Iu.prototype.start=function(){return c(this,void 0,void 0,function(){var e,n,i,r,o,s,a,u,h,c,l,f=this;return y(this,function(t){switch(t.label){case 0:return Na(!this.Ls,"WebStorageSharedClientState already started"),Na(null!==this.Fo,"syncEngine property must be set before calling start()"),Na(null!==this.jo,"onlineStateHandler property must be set before calling start()"),[4,this.Fo.yo()];case 1:for(e=t.sent(),n=0,i=e;n<i.length;n++)(r=i[n])!==this.ko&&(o=this.getItem(hu(this.persistenceKey,r)))&&(s=du.No(r,o))&&(this.Uo[s.clientId]=s);for(this.Ho(),(a=this.storage.getItem(this.Jo))&&(u=this.Yo(a))&&this.Ko(u),h=0,c=this.qo;h<c.length;h++)l=c[h],this.Mo(l);return this.qo=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.Ls=!0,[2]}})})},Iu.prototype.Vr=function(t){this.setItem(this.Qo,JSON.stringify(t))},Iu.prototype.Xo=function(){var n=js();return Tr(this.Uo,function(t,e){n=n.Ft(e.activeTargetIds)}),n},Iu.prototype.$o=function(t){for(var e in this.Uo)if(this.Uo.hasOwnProperty(e)&&this.Uo[e].activeTargetIds.has(t))return!0;return!1},Iu.prototype.Zo=function(t){this.th(t,"pending")},Iu.prototype.nh=function(t,e,n){this.th(t,e,n),this.ih(t)},Iu.prototype.eh=function(t){var e="not-current";if(this.$o(t)){var n=this.storage.getItem(lu(this.persistenceKey,t));if(n){var i=pu.No(t,n);i&&(e=i.state)}}return this.rh.Do(t),this.Ho(),e},Iu.prototype.sh=function(t){this.rh.Vo(t),this.Ho()},Iu.prototype.uh=function(t){return this.rh.activeTargetIds.has(t)},Iu.prototype.oh=function(t){this.removeItem(lu(this.persistenceKey,t))},Iu.prototype.hh=function(t,e,n){this.ah(t,e,n)},Iu.prototype.Iu=function(t,e,n){var i=this;e.forEach(function(t){i.ih(t)}),this.currentUser=t,n.forEach(function(t){i.Zo(t)})},Iu.prototype.fh=function(t){this.lh(t)},Iu.prototype.shutdown=function(){this.Ls&&(this.platform.window.removeEventListener("storage",this.Lo),this.removeItem(this.Bo),this.Ls=!1)},Iu.prototype.getItem=function(t){var e=this.storage.getItem(t);return ba("SharedClientState","READ",t,e),e},Iu.prototype.setItem=function(t,e){ba("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Iu.prototype.removeItem=function(t){ba("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Iu.prototype.Mo=function(a){var t=this;if(a.storageArea===this.storage){if(ba("SharedClientState","EVENT",a.key,a.newValue),a.key===this.Bo)return void Ea("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Po.Qr(function(){return c(t,void 0,void 0,function(){var e,n,i,r,o,s;return y(this,function(t){if(!this.Ls)return this.qo.push(a),[2];if(null===a.key)return[2];if(this.Wo.test(a.key)){if(null==a.newValue)return n=this.dh(a.key),[2,this.vh(n,null)];if(e=this.wh(a.key,a.newValue))return[2,this.vh(e.clientId,e)]}else if(this.Go.test(a.key)){if(null!==a.newValue&&(i=this.mh(a.key,a.newValue)))return[2,this.ph(i)]}else if(this.zo.test(a.key)){if(null!==a.newValue&&(r=this.gh(a.key,a.newValue)))return[2,this.bh(r)]}else if(a.key===this.Jo){if(null!==a.newValue&&(o=this.Yo(a.newValue)))return[2,this.Ko(o)]}else a.key===this.Qo&&(Na(!!this.Nr,"Missing sequenceNumberHandler"),(s=function(t){var e=Ua.Pr;if(null!=t)try{var n=JSON.parse(t);Na("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Ea("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(a.newValue))!==Ua.Pr&&this.Nr(s));return[2]})})})}},Object.defineProperty(Iu.prototype,"rh",{get:function(){return this.Uo[this.ko]},enumerable:!0,configurable:!0}),Iu.prototype.Ho=function(){this.setItem(this.Bo,this.rh.Oo())},Iu.prototype.th=function(t,e,n){var i=new fu(this.currentUser,t,e,n),r=cu(this.persistenceKey,this.currentUser,t);this.setItem(r,i.Oo())},Iu.prototype.ih=function(t){var e=cu(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Iu.prototype.lh=function(t){var e={clientId:this.ko,onlineState:t};this.storage.setItem(this.Jo,JSON.stringify(e))},Iu.prototype.ah=function(t,e,n){var i=lu(this.persistenceKey,t),r=new pu(t,e,n);this.setItem(i,r.Oo())},Iu.prototype.dh=function(t){var e=this.Wo.exec(t);return e?e[1]:null},Iu.prototype.wh=function(t,e){var n=this.dh(t);return Na(null!==n,"Cannot parse client state key '"+t+"'"),du.No(n,e)},Iu.prototype.mh=function(t,e){var n=this.Go.exec(t);Na(null!==n,"Cannot parse mutation batch key '"+t+"'");var i=Number(n[1]),r=void 0!==n[2]?n[2]:null;return fu.No(new Ui(r),i,e)},Iu.prototype.gh=function(t,e){var n=this.zo.exec(t);Na(null!==n,"Cannot parse query target key '"+t+"'");var i=Number(n[1]);return pu.No(i,e)},Iu.prototype.Yo=function(t){return yu.No(t)},Iu.prototype.ph=function(e){return c(this,void 0,void 0,function(){return y(this,function(t){return e.user.uid!==this.currentUser.uid?(ba("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.Fo.yh(e.batchId,e.state,e.error)]})})},Iu.prototype.bh=function(t){return this.Fo._h(t.targetId,t.state,t.error)},Iu.prototype.vh=function(t,e){var n=this,i=this.Xo();e?this.Uo[t]=e:delete this.Uo[t];var r=this.Xo(),o=[],s=[];return r.forEach(function(e){return c(n,void 0,void 0,function(){return y(this,function(t){return i.has(e)||o.push(e),[2]})})}),i.forEach(function(e){return c(n,void 0,void 0,function(){return y(this,function(t){return r.has(e)||s.push(e),[2]})})}),this.Fo.Th(o,s)},Iu.prototype.Ko=function(t){this.Uo[t.clientId]&&this.jo(t.onlineState)};var Tu=(Mu.prototype.Zo=function(t){},Mu.prototype.nh=function(t,e,n){},Mu.prototype.eh=function(t){return this.Eh.Do(t),this.Sh[t]||"not-current"},Mu.prototype.hh=function(t,e,n){this.Sh[t]=e},Mu.prototype.sh=function(t){this.Eh.Vo(t)},Mu.prototype.uh=function(t){return this.Eh.activeTargetIds.has(t)},Mu.prototype.oh=function(t){delete this.Sh[t]},Mu.prototype.Xo=function(){return this.Eh.activeTargetIds},Mu.prototype.$o=function(t){return this.Eh.activeTargetIds.has(t)},Mu.prototype.start=function(){return this.Eh=new vu,Promise.resolve()},Mu.prototype.Iu=function(t,e,n){},Mu.prototype.fh=function(t){},Mu.prototype.shutdown=function(){},Mu.prototype.Vr=function(t){},Mu),Nu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Au=(Uu.prototype.Ih=function(t){this.Ah.push(t)},Uu.prototype.Ch=function(){this.Ah.forEach(function(t){return t()})},Uu),Su=(Pu.prototype.ho=function(e,n){var i=this;return this.mu.Oh(e,n).next(function(t){return i.Dh(e,n,t)})},Pu.prototype.Dh=function(t,i,r){return this.Rh.su(t,i).next(function(t){for(var e=0,n=r;e<n.length;e++)t=n[e].xt(i,t);return t})},Pu.prototype.Vh=function(t,e,r){var o=Ls();return e.forEach(function(t,e){for(var n=0,i=r;n<i.length;n++)e=i[n].xt(t,e);o=o.st(t,e)}),o},Pu.prototype.Ru=function(e,t){var n=this;return this.Rh.getEntries(e,t).next(function(t){return n.io(e,t)})},Pu.prototype.io=function(i,r){var o=this;return this.mu.Ph(i,r).next(function(t){var e=o.Vh(i,r,t),n=Cs();return e.forEach(function(t,e){e=e||new Uo(t,$i.D()),n=n.st(t,e)}),n})},Pu.prototype.mo=function(t,e,n){return e.En()?this.kh(t,e.path):e.Kn()?this.Fh(t,e,n):this.jh(t,e,n)},Pu.prototype.kh=function(t,e){return this.ho(t,new ir(e)).next(function(t){var e=Ps();return t instanceof Po&&(e=e.st(t.key,t)),e})},Pu.prototype.Fh=function(n,i,r){var o=this;Na(i.path.M(),"Currently we only support collection group queries at the root.");var s=i.collectionGroup,a=Ps();return this.Nh.Uh(n,s).next(function(t){return xa.forEach(t,function(t){var e=i.Mn(t.child(s));return o.jh(n,e,r).next(function(t){t.forEach(function(t,e){a=a.st(t,e)})})}).next(function(){return a})})},Pu.prototype.jh=function(e,n,t){var c,l,i=this;return this.Rh.mo(e,n,t).next(function(t){return c=t,i.mu.Lh(e,n)}).next(function(t){return l=t,i.Mh(e,l,c).next(function(t){c=t;for(var e=0,n=l;e<n.length;e++)for(var i=n[e],r=0,o=i.mutations;r<o.length;r++){var s=o[r],a=s.key,u=c.get(a),h=s.xt(u,u,i.br);c=h instanceof Po?c.st(a,h):c.remove(a)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},Pu.prototype.Mh=function(t,e,n){for(var i=xs(),r=0,o=e;r<o.length;r++)for(var s=0,a=o[r].mutations;s<a.length;s++){var u=a[s];u instanceof Ro&&null===n.get(u.key)&&(i=i.add(u.key))}var h=n;return this.Rh.getEntries(t,i).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Po&&(h=h.st(t,e))}),h})},Pu),ku=(Vu.prototype.Su=function(t){this.qh=t},Vu.prototype.mo=function(e,i,r,o){var s=this;return Na(void 0!==this.qh,"setLocalDocumentsView() not called"),i.qn()||r.isEqual($i.MIN)?this.xh(e,i):this.qh.Ru(e,o).next(function(t){var n=s.Bh(i,t);return(i.Jn()||i.Hn())&&s.Qh(i.An,n,o,r)?s.xh(e,i):(ga()<=a.DEBUG&&ba("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),i.toString()),s.qh.mo(e,i,r).next(function(e){return n.forEach(function(t){e=e.st(t.key,t)}),e}))})},Vu.prototype.Bh=function(n,t){var i=new gr(function(t,e){return n.Bn(t,e)});return t.forEach(function(t,e){e instanceof Po&&n.matches(e)&&(i=i.add(e))}),i},Vu.prototype.Qh=function(t,e,n,i){if(n.size!==e.size)return!0;var r="F"===t?e.last():e.first();return!!r&&(r.hasPendingWrites||0<r.version.V(i))},Vu.prototype.xh=function(t,e){return ga()<=a.DEBUG&&ba("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.qh.mo(t,e,$i.MIN)},Vu),Ru=(Lu.prototype.Gh=function(t,e){return this.Wh.add(e),xa.resolve()},Lu.prototype.Uh=function(t,e){return xa.resolve(this.Wh.getEntries(e))},Lu),_u=(Cu.prototype.add=function(t){Na(t.length%2==1,"Expected a collection path.");var e=t.B(),n=t.L(),i=this.index[e]||new gr(tr.F),r=!i.has(n);return this.index[e]=i.add(n),r},Cu.prototype.has=function(t){var e=t.B(),n=t.L(),i=this.index[e];return i&&i.has(n)},Cu.prototype.getEntries=function(t){return(this.index[t]||new gr(tr.F)).J()},Cu),Du=(Ou.prototype.Hh=function(t){return xa.resolve(0===this.mu.length)},Ou.prototype.ju=function(t,e,n){var i=e.batchId,r=this.Yh(i,"acknowledged");Na(0===r,"Can only acknowledge the first batch in the mutation queue");var o=this.mu[r];return Na(i===o.batchId,"Queue ordering failure: expected batch "+i+", got batch "+o.batchId),this.lastStreamToken=n,xa.resolve()},Ou.prototype.Gu=function(t){return xa.resolve(this.lastStreamToken)},Ou.prototype.zu=function(t,e){return this.lastStreamToken=e,xa.resolve()},Ou.prototype.Pu=function(t,e,n,i){Na(0!==i.length,"Mutation batches should not be empty");var r=this.zh;this.zh++,0<this.mu.length&&Na(this.mu[this.mu.length-1].batchId<r,"Mutation batchIDs must be monotonically increasing order");var o=new Ca(r,e,n,i);this.mu.push(o);for(var s=0,a=i;s<a.length;s++){var u=a[s];this.Jh=this.Jh.add(new Za(u.key,r)),this.Nh.Gh(t,u.key.path.L())}return xa.resolve(o)},Ou.prototype.Bu=function(t,e){return xa.resolve(this.Kh(e))},Ou.prototype.Fu=function(t,e){var n=this.Kh(e);return Na(null!=n,"Failed to find local mutation batch."),xa.resolve(n.keys())},Ou.prototype.uo=function(t,e){var n=e+1,i=this.Xh(n),r=i<0?0:i;return xa.resolve(this.mu.length>r?this.mu[r]:null)},Ou.prototype.Wu=function(){return xa.resolve(0===this.mu.length?-1:this.zh-1)},Ou.prototype.Cu=function(t){return xa.resolve(this.mu.slice())},Ou.prototype.Oh=function(t,n){var i=this,e=new Za(n,0),r=new Za(n,Number.POSITIVE_INFINITY),o=[];return this.Jh.Vt([e,r],function(t){Na(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=i.Kh(t.$s);Na(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),xa.resolve(o)},Ou.prototype.Ph=function(t,e){var i=this,r=new gr(ka);return e.forEach(function(e){var t=new Za(e,0),n=new Za(e,Number.POSITIVE_INFINITY);i.Jh.Vt([t,n],function(t){Na(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),r=r.add(t.$s)})}),xa.resolve(this.$h(r))},Ou.prototype.Lh=function(t,e){Na(!e.Kn(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,i=n.length+1,r=n;ir.nt(r)||(r=r.child(""));var o=new Za(new ir(r),0),s=new gr(ka);return this.Jh.Pt(function(t){var e=t.key.path;return!!n.W(e)&&(e.length===i&&(s=s.add(t.$s)),!0)},o),xa.resolve(this.$h(s))},Ou.prototype.$h=function(t){var n=this,i=[];return t.forEach(function(t){var e=n.Kh(t);null!==e&&i.push(e)}),i},Ou.prototype.Qu=function(n,i){var r=this;Na(0===this.Yh(i.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mu.shift();var o=this.Jh;return xa.forEach(i.mutations,function(t){var e=new Za(t.key,i.batchId);return o=o.delete(e),r.wu.Zh(n,t.key)}).next(function(){r.Jh=o})},Ou.prototype.To=function(t){},Ou.prototype.Xs=function(t,e){var n=new Za(e,0),i=this.Jh.kt(n);return xa.resolve(e.isEqual(i&&i.key))},Ou.prototype.qu=function(t){return 0===this.mu.length&&Na(this.Jh.M(),"Document leak -- detected dangling mutation references when queue is empty."),xa.resolve()},Ou.prototype.Yh=function(t,e){var n=this.Xh(t);return Na(0<=n&&n<this.mu.length,"Batches must exist to be "+e),n},Ou.prototype.Xh=function(t){return 0===this.mu.length?0:t-this.mu[0].batchId},Ou.prototype.Kh=function(t){var e=this.Xh(t);if(e<0||e>=this.mu.length)return null;var n=this.mu[e];return Na(n.batchId===t,"If found batch must match"),n},Ou);function Ou(t,e){this.Nh=t,this.wu=e,this.mu=[],this.zh=1,this.lastStreamToken=Ar.qt,this.Jh=new gr(Za.gn)}function Cu(){this.index={}}function Lu(){this.Wh=new _u}function Vu(){}function Pu(t,e,n){this.Rh=t,this.mu=e,this.Nh=n}function Uu(){this.Ah=[]}function Mu(){this.Eh=new vu,this.Sh={},this.Fo=null,this.jo=null,this.Nr=null}var Fu,xu,qu,ju,Gu=(fh.prototype.iu=function(t,e,n){Na(!n.isEqual($i.MIN),"Cannot add a document with a read time of zero");var i=e.key,r=this.docs.get(i),o=r?r.size:0,s=this.ta(e);return this.docs=this.docs.st(i,{na:e,size:s,readTime:n}),this.size+=s-o,this.Nh.Gh(t,i.path.L())},fh.prototype.ru=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},fh.prototype.su=function(t,e){var n=this.docs.get(e);return xa.resolve(n?n.na:null)},fh.prototype.getEntries=function(t,e){var n=this,i=Ls();return e.forEach(function(t){var e=n.docs.get(t);i=i.st(t,e?e.na:null)}),xa.resolve(i)},fh.prototype.mo=function(t,e,n){Na(!e.Kn(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var i=Ps(),r=new ir(e.path.child("")),o=this.docs.lt(r);o.bt();){var s=o.gt(),a=s.key,u=s.value,h=u.na,c=u.readTime;if(!e.path.W(a.path))break;c.V(n)<=0||h instanceof Po&&e.matches(h)&&(i=i.st(h.key,h))}return xa.resolve(i)},fh.prototype.ia=function(t,e){return xa.forEach(this.docs,function(t){return e(t)})},fh.prototype.Io=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},fh.prototype.Ro=function(t){return xa.resolve($i.MIN)},fh.prototype.Uu=function(t){return new fh.ea(this)},fh.prototype.ra=function(t){return xa.resolve(this.size)},fh.ea=(t(ph,ju=tu),ph.prototype.hu=function(n){var i=this,r=[];return this.Zs.forEach(function(t,e){e?r.push(i.sa.iu(n,e,i.readTime)):i.sa.ru(t)}),xa.gs(r)},ph.prototype.uu=function(t,e){return this.sa.su(t,e)},ph.prototype.ou=function(t,e){return this.sa.getEntries(t,e)},ph),fh),Bu=(lh.prototype.next=function(){var t=this.ha;return this.ha+=2,t},lh.prototype.after=function(t){return this.oa(t+2),this.next()},lh.prototype.oa=function(t){Na((1&t)===this.ua,"Cannot supply target ID from different generator ID"),this.ha=t},lh.aa=function(){return new lh(0,2)},lh.ca=function(){return new lh(1)},lh),Hu=(ch.prototype.$i=function(t,n){return this.fa.forEach(function(t,e){return n(e)}),xa.resolve()},ch.prototype.Ju=function(t){return xa.resolve(this.lastRemoteSnapshotVersion)},ch.prototype.wa=function(t){return xa.resolve(this.la)},ch.prototype.fo=function(t){var e=this.va.after(this.highestTargetId);return this.highestTargetId=e,xa.resolve(e)},ch.prototype.no=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.la&&(this.la=e),xa.resolve()},ch.prototype.ma=function(t){this.fa.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.la&&(this.la=t.sequenceNumber)},ch.prototype.lo=function(t,e){return Na(!this.fa.has(e.target),"Adding a target that already exists"),this.ma(e),this.targetCount+=1,xa.resolve()},ch.prototype.Zu=function(t,e){return Na(this.fa.has(e.target),"Updating a non-existent target"),this.ma(e),xa.resolve()},ch.prototype.pa=function(t,e){return Na(0<this.targetCount,"Removing a target from an empty cache"),Na(this.fa.has(e.target),"Removing a non-existent target from the cache"),this.fa.delete(e.target),this.da.Hs(e.targetId),this.targetCount-=1,xa.resolve()},ch.prototype.ga=function(n,i,r){var o=this,s=0,a=[];return this.fa.forEach(function(t,e){e.sequenceNumber<=i&&null===r.get(e.targetId)&&(o.fa.delete(t),a.push(o.ba(n,e.targetId)),s++)}),xa.gs(a).next(function(){return s})},ch.prototype.ya=function(t){return xa.resolve(this.targetCount)},ch.prototype.co=function(t,e){var n=this.fa.get(e)||null;return xa.resolve(n)},ch.prototype.ae=function(t,e){return Ta("Not yet implemented.")},ch.prototype.Ku=function(e,t,n){this.da.Ws(t,n);var i=this.persistence.wu,r=[];return i&&t.forEach(function(t){r.push(i.Qs(e,t))}),xa.gs(r)},ch.prototype.Yu=function(e,t,n){this.da.Js(t,n);var i=this.persistence.wu,r=[];return i&&t.forEach(function(t){r.push(i.Gs(e,t))}),xa.gs(r)},ch.prototype.ba=function(t,e){return this.da.Hs(e),xa.resolve()},ch.prototype.wo=function(t,e){var n=this.da.Ks(e);return xa.resolve(n)},ch.prototype.Xs=function(t,e){return xa.resolve(this.da.Xs(e))},ch),zu="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Qu=(hh.prototype.shutdown=function(){return this.Ea=!1,Promise.resolve()},Object.defineProperty(hh.prototype,"Ls",{get:function(){return this.Ea},enumerable:!0,configurable:!0}),hh.prototype.yo=function(){return c(this,void 0,void 0,function(){return y(this,function(t){return[2,[this.clientId]]})})},hh.prototype.Aa=function(t){return t(!0)},hh.prototype.Ia=function(){},hh.prototype.Eo=function(t){},hh.prototype.Eu=function(){return this.Nh},hh.prototype.pu=function(t){var e=this._a[t.i()];return e||(e=new Du(this.Nh,this.wu),this._a[t.i()]=e),e},hh.prototype._u=function(){return this.yu},hh.prototype.bu=function(){return this.Rh},hh.prototype.runTransaction=function(t,e,n){var i=this;ba("MemoryPersistence","Starting transaction:",t);var r=new Yu(this.Ta.next());return this.wu.Ca(),n(r).next(function(t){return i.wu.Ra(r).next(function(){return t})}).ms().then(function(t){return r.Ch(),t})},hh.prototype.Na=function(e,n){return xa.bs(Object.values(this._a).map(function(t){return function(){return t.Xs(e,n)}}))},hh),Yu=(t(uh,qu=Au),uh),Wu=(Object.defineProperty(ah.prototype,"Va",{get:function(){if(this.Da)return this.Da;throw Ta("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),ah.prototype.vu=function(t){this.Oa=t},ah.prototype.Qs=function(t,e){return this.Va.delete(e),xa.resolve()},ah.prototype.Gs=function(t,e){return this.Va.add(e),xa.resolve()},ah.prototype.Zh=function(t,e){return this.Va.add(e),xa.resolve()},ah.prototype.removeTarget=function(t,e){var n=this,i=this.persistence._u();return i.wo(t,e.targetId).next(function(t){t.forEach(function(t){return n.Va.add(t)})}).next(function(){return i.pa(t,e)})},ah.prototype.Ca=function(){this.Da=new Set},ah.prototype.Ra=function(t){var n=this,i=this.persistence.bu().Uu();return xa.forEach(this.Va,function(e){return n.Pa(t,e).next(function(t){t||i.ru(e)})}).next(function(){return n.Da=null,i.apply(t)})},ah.prototype.to=function(t,e){var n=this;return this.Pa(t,e).next(function(t){t?n.Va.delete(e):n.Va.add(e)})},ah.prototype.Sa=function(t){return 0},ah.prototype.Pa=function(t,e){var n=this;return xa.bs([function(){return n.persistence._u().Xs(t,e)},function(){return n.persistence.Na(t,e)},function(){return xa.resolve(n.Oa.Xs(e))}])},ah),Ku=(sh.prototype.initialize=function(t,e,n,i,r,o){if(o.ka)throw new Fi(Mi.FAILED_PRECONDITION,zu);return this.clientId=i,Promise.resolve()},sh.prototype.Fa=function(){var t=!1;return{Ls:t,start:function(){return t=!0},stop:function(){return t=!1}}},sh.prototype.ja=function(){return Na(!!this.clientId,"initialize() not called"),new Qu(this.clientId,function(t){return new Wu(t)})},sh.prototype.Ua=function(){return new Tu},sh.prototype.clearPersistence=function(){throw new Fi(Mi.FAILED_PRECONDITION,zu)},sh),Xu=(oh.prototype.reset=function(){this.xa=0},oh.prototype.Wa=function(){this.xa=this.qa},oh.prototype.Ga=function(t){var e=this;this.cancel();var n=Math.floor(this.xa+this.za()),i=Math.max(0,Date.now()-this.Qa),r=Math.max(0,n-i);0<this.xa&&ba("ExponentialBackoff","Backing off for "+r+" ms (base delay: "+this.xa+" ms, delay with jitter: "+n+" ms, last attempt: "+i+" ms ago)"),this.Ba=this.Po.es(this.Fr,r,function(){return e.Qa=Date.now(),t()}),this.xa*=this.Ma,this.xa<this.La&&(this.xa=this.La),this.xa>this.qa&&(this.xa=this.qa)},oh.prototype.cancel=function(){null!==this.Ba&&(this.Ba.cancel(),this.Ba=null)},oh.prototype.za=function(){return(Math.random()-.5)*this.xa},oh),Ju=(rh.prototype.$a=function(){return 1===this.state||2===this.state||4===this.state},rh.prototype.Za=function(){return 2===this.state},rh.prototype.start=function(){3!==this.state?(Na(0===this.state,"Already started"),this.auth()):this.tc()},rh.prototype.stop=function(){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.$a()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},rh.prototype.nc=function(){Na(!this.$a(),"Can only inhibit backoff in a stopped state"),this.state=0,this.Xa.reset()},rh.prototype.ic=function(){var t=this;this.Za()&&null===this.Ka&&(this.Ka=this.Po.es(this.Ja,6e4,function(){return t.ec()}))},rh.prototype.rc=function(t){this.sc(),this.stream.send(t)},rh.prototype.ec=function(){return c(this,void 0,void 0,function(){return y(this,function(t){return this.Za()?[2,this.close(0)]:[2]})})},rh.prototype.sc=function(){this.Ka&&(this.Ka.cancel(),this.Ka=null)},rh.prototype.close=function(e,n){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return Na(this.$a(),"Only started streams should be closed."),Na(3===e||kr(n),"Can't provide an error when not in an error state."),this.sc(),this.Xa.cancel(),this.Ya++,3!==e?this.Xa.reset():n&&n.code===Mi.RESOURCE_EXHAUSTED?(Ea(n.toString()),Ea("Using maximum backoff delay to prevent overloading the backend."),this.Xa.Wa()):n&&n.code===Mi.UNAUTHENTICATED&&this.Ha.l(),null!==this.stream&&(this.uc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.oc(n)];case 1:return t.sent(),[2]}})})},rh.prototype.uc=function(){},rh.prototype.auth=function(){var n=this;Na(0===this.state,"Must be in initial state to auth"),this.state=1;var t=this.hc(this.Ya),e=this.Ya;this.Ha.getToken().then(function(t){n.Ya===e&&n.ac(t)},function(e){t(function(){var t=new Fi(Mi.UNKNOWN,"Fetching auth token failed: "+e.message);return n.cc(t)})})},rh.prototype.ac=function(t){var e=this;Na(1===this.state,"Trying to start stream in a non-starting state");var n=this.hc(this.Ya);this.stream=this.fc(t),this.stream.lc(function(){n(function(){return Na(1===e.state,"Expected stream to be in state Starting, but was "+e.state),e.state=2,e.listener.lc()})}),this.stream.oc(function(t){n(function(){return e.cc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},rh.prototype.tc=function(){var t=this;Na(3===this.state,"Should only perform backoff when in Error state"),this.state=4,this.Xa.Ga(function(){return c(t,void 0,void 0,function(){return y(this,function(t){return Na(4===this.state,"Backoff elapsed but state is now: "+this.state),this.state=0,this.start(),Na(this.$a(),"PersistentStream should have started"),[2]})})})},rh.prototype.cc=function(t){return Na(this.$a(),"Can't handle server close on non-started stream"),ba("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},rh.prototype.hc=function(e){var n=this;return function(t){n.Po.Qr(function(){return n.Ya===e?t():(ba("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},rh),$u=(t(ih,xu=Ju),ih.prototype.fc=function(t){return this.connection.dc("Listen",t)},ih.prototype.onMessage=function(t){this.Xa.reset();var e=this.serializer.Ve(t),n=this.serializer.ke(t);return this.listener.vc(e,n)},ih.prototype.watch=function(t){var e={};e.database=this.serializer.Ae,e.addTarget=this.serializer.xn(t);var n=this.serializer.nr(t);n&&(e.labels=n),this.rc(e)},ih.prototype.wc=function(t){var e={};e.database=this.serializer.Ae,e.removeTarget=t,this.rc(e)},ih),Zu=(t(nh,Fu=Ju),Object.defineProperty(nh.prototype,"pc",{get:function(){return this.mc},enumerable:!0,configurable:!0}),nh.prototype.start=function(){this.mc=!1,Fu.prototype.start.call(this)},nh.prototype.uc=function(){this.mc&&this.gc([])},nh.prototype.fc=function(t){return this.connection.dc("Write",t)},nh.prototype.onMessage=function(t){if(Na(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.pe(t.streamToken),this.mc){this.Xa.reset();var e=this.serializer.We(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.bc(n,e)}return Na(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.mc=!0,this.listener.yc()},nh.prototype._c=function(){Na(this.Za(),"Writing handshake requires an opened stream"),Na(!this.mc,"Handshake already completed");var t={};t.database=this.serializer.Ae,this.rc(t)},nh.prototype.gc=function(t){var e=this;Na(this.Za(),"Writing mutations requires an opened stream"),Na(this.mc,"Handshake must be complete before writing mutations"),Na(0<this.lastStreamToken.Mt(),"Trying to write mutation without a token");var n={streamToken:this.serializer.me(this.lastStreamToken),writes:t.map(function(t){return e.serializer.Fe(t)})};this.rc(n)},nh),th=(eh.prototype.Tc=function(t){return new Zu(this.Po,this.connection,this.credentials,this.serializer,t)},eh.prototype.Ec=function(t){return new $u(this.Po,this.connection,this.credentials,this.serializer,t)},eh.prototype.commit=function(t){var e=this,n={database:this.serializer.Ae,writes:t.map(function(t){return e.serializer.Fe(t)})};return this.Sc("Commit",n).then(function(t){return e.serializer.We(t.writeResults,t.commitTime)})},eh.prototype.lookup=function(e){var r=this,t={database:this.serializer.Ae,documents:e.map(function(t){return r.serializer._e(t)})};return this.Ac("BatchGetDocuments",t).then(function(t){var n=Cs();t.forEach(function(t){var e=r.serializer.De(t);n=n.st(e.key,e)});var i=[];return e.forEach(function(t){var e=n.get(t);Na(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},eh.prototype.Sc=function(e,n){var i=this;return this.credentials.getToken().then(function(t){return i.connection.Sc(e,n,t)}).catch(function(t){throw t.code===Mi.UNAUTHENTICATED&&i.credentials.l(),t})},eh.prototype.Ac=function(e,n){var i=this;return this.credentials.getToken().then(function(t){return i.connection.Ac(e,n,t)}).catch(function(t){throw t.code===Mi.UNAUTHENTICATED&&i.credentials.l(),t})},eh);function eh(t,e,n,i){this.Po=t,this.connection=e,this.credentials=n,this.serializer=i}function nh(t,e,n,i,r){var o=Fu.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,r)||this;return o.serializer=i,o.mc=!1,o.lastStreamToken=Ar.qt,o}function ih(t,e,n,i,r){var o=xu.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,r)||this;return o.serializer=i,o}function rh(t,e,n,i,r,o){this.Po=t,this.Ja=n,this.connection=i,this.Ha=r,this.listener=o,this.state=0,this.Ya=0,this.Ka=null,this.stream=null,this.Xa=new Xu(t,e)}function oh(t,e,n,i,r){void 0===n&&(n=1e3),void 0===i&&(i=1.5),void 0===r&&(r=6e4),this.Po=t,this.Fr=e,this.La=n,this.Ma=i,this.qa=r,this.xa=0,this.Ba=null,this.Qa=Date.now(),this.reset()}function sh(){}function ah(t){this.persistence=t,this.Oa=null,this.Da=null}function uh(t){var e=qu.call(this)||this;return e.Xu=t,e}function hh(t,e){var n=this;this.clientId=t,this._a={},this.Ta=new Ua(0),this.Ea=!1,this.Ea=!0,this.wu=e(this),this.yu=new Hu(this),this.Nh=new Ru,this.Rh=new Gu(this.Nh,function(t){return n.wu.Sa(t)})}function ch(t){this.persistence=t,this.fa=new Va(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=$i.MIN,this.highestTargetId=0,this.la=0,this.da=new $a,this.targetCount=0,this.va=Bu.aa()}function lh(t,e){Na((1&(this.ua=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.oa(void 0!==e?e:this.ua)}function fh(t,e){this.Nh=t,this.ta=e,this.docs=new rr(ir.F),this.size=0}function ph(t){var e=ju.call(this)||this;return e.sa=t,e}function dh(t,e){if(0!==e.length)throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Oh(e.length,"argument")+".")}function yh(t,e,n){if(e.length!==n)throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires "+Oh(n,"argument")+", but was called with "+Oh(e.length,"argument")+".")}function vh(t,e,n){if(e.length<n)throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Oh(n,"argument")+", but was called with "+Oh(e.length,"argument")+".")}function mh(t,e,n,i){if(e.length<n||e.length>i)throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+i+" arguments, but was called with "+Oh(e.length,"argument")+".")}function gh(t,e,n,i){Th(t,e,Dh(n)+" argument",i)}function wh(t,e,n,i){void 0!==i&&gh(t,e,n,i)}function bh(t,e,n,i){Th(t,e,n+" option",i)}function Eh(t,e,n,i){void 0!==i&&bh(t,e,n,i)}function Ih(t,e,n,i,h){void 0!==i&&function(t,e,n,i){for(var r=[],o=0,s=h;o<s.length;o++){var a=s[o];if(a===i)return;r.push(Ah(a))}var u=Ah(i);throw new Fi(Mi.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+r.join(", "))}(t,0,n,i)}function Th(t,e,n,i){if(!("object"===e?Nh(i):"non-empty string"===e?"string"==typeof i&&""!==i:typeof i===e)){var r=Ah(i);throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+r)}}function Nh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ah(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Ta("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Sh(t,e,n){if(void 0===n)throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Dh(e)+" argument, but it was undefined.")}function kh(n,t,i){Tr(t,function(t,e){if(i.indexOf(t)<0)throw new Fi(Mi.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+i.join(", "))})}function Rh(t,e,n,i){var r=Ah(i);return new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires its "+Dh(n)+" argument to be a "+e+", but it was: "+r)}function _h(t,e,n){if(n<=0)throw new Fi(Mi.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Dh(e)+" argument to be a positive number, but it was: "+n+".")}function Dh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Oh(t,e){return t+" "+e+(1===t?"":"s")}function Ch(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Fi(Mi.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}function Lh(){if("undefined"==typeof Uint8Array)throw new Fi(Mi.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Vh(){if(!ya.Lt().Ic)throw new Fi(Mi.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ph=(qh.fromBase64String=function(t){yh("Blob.fromBase64String",arguments,1),gh("Blob.fromBase64String","string",1,t),Vh();try{return new qh(Ar.fromBase64String(t))}catch(t){throw new Fi(Mi.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},qh.fromUint8Array=function(t){if(yh("Blob.fromUint8Array",arguments,1),Lh(),!(t instanceof Uint8Array))throw Rh("Blob.fromUint8Array","Uint8Array",1,t);return new qh(Ar.fromUint8Array(t))},qh.prototype.toBase64=function(){return yh("Blob.toBase64",arguments,0),Vh(),this.Cc.toBase64()},qh.prototype.toUint8Array=function(){return yh("Blob.toUint8Array",arguments,0),Lh(),this.Cc.toUint8Array()},qh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},qh.prototype.isEqual=function(t){return this.Cc.isEqual(t.Cc)},qh),Uh=Ch(Ph,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Mh=(xh.documentId=function(){return xh.Nc},xh.prototype.isEqual=function(t){if(!(t instanceof xh))throw Rh("isEqual","FieldPath",1,t);return this.Rc.isEqual(t.Rc)},xh.Nc=new xh(nr.Z().H()),xh),Fh=new RegExp("[~\\*/\\[\\]]");function xh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,i){if(!(e instanceof Array)||e.length<i)throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Oh(i,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(gh("FieldPath","string",n,t[n]),0===t[n].length)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Rc=new nr(t)}function qh(t){Vh(),this.Cc=t}var jh,Gh,Bh,Hh,zh,Qh=(lc.delete=function(){return dh("FieldValue.delete",arguments),Yh.instance},lc.serverTimestamp=function(){return dh("FieldValue.serverTimestamp",arguments),Wh.instance},lc.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vh("FieldValue.arrayUnion",arguments,1),new Kh(t)},lc.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vh("FieldValue.arrayRemove",arguments,1),new Xh(t)},lc.increment=function(t){return gh("FieldValue.increment","number",1,t),yh("FieldValue.increment",arguments,1),new Jh(t)},lc.prototype.isEqual=function(t){return this===t},lc),Yh=(t(cc,zh=Qh),cc.instance=new cc,cc),Wh=(t(hc,Hh=Qh),hc.instance=new hc,hc),Kh=(t(uc,Bh=Qh),uc),Xh=(t(ac,Gh=Qh),ac),Jh=(t(sc,jh=Qh),sc),$h=Ch(Qh,"Use FieldValue.<field>() instead."),Zh=(Object.defineProperty(oc.prototype,"latitude",{get:function(){return this.Pc},enumerable:!0,configurable:!0}),Object.defineProperty(oc.prototype,"longitude",{get:function(){return this.kc},enumerable:!0,configurable:!0}),oc.prototype.isEqual=function(t){return this.Pc===t.Pc&&this.kc===t.kc},oc.prototype.R=function(t){return ka(this.Pc,t.Pc)||ka(this.kc,t.kc)},oc),tc=/^__.*__$/,ec=(rc.prototype.Fc=function(t,e){var n=[];return null!==this.en?n.push(new Ro(t,this.data,this.en,e)):n.push(new ko(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new _o(t,this.fieldTransforms)),n},rc),nc=(ic.prototype.Fc=function(t,e){var n=[new Ro(t,this.data,this.en,e)];return 0<this.fieldTransforms.length&&n.push(new _o(t,this.fieldTransforms)),n},ic);function ic(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}function rc(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}function oc(t,e){if(yh("GeoPoint",arguments,2),gh("GeoPoint","number",1,t),gh("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Fi(Mi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Fi(Mi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Pc=t,this.kc=e}function sc(t){var e=jh.call(this,"FieldValue.increment")||this;return e.Vc=t,e}function ac(t){var e=Gh.call(this,"FieldValue.arrayRemove")||this;return e.Dc=t,e}function uc(t){var e=Bh.call(this,"FieldValue.arrayUnion")||this;return e.Dc=t,e}function hc(){return Hh.call(this,"FieldValue.serverTimestamp")||this}function cc(){return zh.call(this,"FieldValue.delete")||this}function lc(t){this.Oc=t}function fc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ta("Unexpected case for UserDataSource: "+t)}}var pc=(mc.prototype.Mc=function(t){var e=null==this.path?null:this.path.child(t),n=new mc(this.jc,this.methodName,e,!1,this.fieldTransforms,this.en);return n.qc(t),n},mc.prototype.xc=function(t){var e=null==this.path?null:this.path.child(t),n=new mc(this.jc,this.methodName,e,!1,this.fieldTransforms,this.en);return n.Lc(),n},mc.prototype.Bc=function(t){return new mc(this.jc,this.methodName,null,!0,this.fieldTransforms,this.en)},mc.prototype.Qc=function(t){var e=null===this.path||this.path.M()?"":" (found in field "+this.path.toString()+")";return new Fi(Mi.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},mc.prototype.contains=function(e){return void 0!==this.en.find(function(t){return e.W(t)})||void 0!==this.fieldTransforms.find(function(t){return e.W(t.field)})},mc.prototype.Lc=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.qc(this.path.get(t))},mc.prototype.qc=function(t){if(0===t.length)throw this.Qc("Document fields must not be empty");if(fc(this.jc)&&tc.test(t))throw this.Qc('Document fields cannot begin and end with "__"')},mc),dc=function(t,e){this.ce=t,this.key=e},yc=(vc.prototype.Gc=function(t,e){var n=new pc(0,t,nr.K);wc("Data must be an object, but it was:",n,e);var i=this.zc(e,n);return new ec(new Co(i),null,n.fieldTransforms)},vc.prototype.Jc=function(t,e,n){var i=new pc(2,t,nr.K);wc("Data must be an object, but it was:",i,e);var r,o,s=this.zc(e,i);if(n){for(var a=new gr(nr.F),u=0,h=n;u<h.length;u++){var c=h[u],l=void 0;if(c instanceof Mh)l=c.Rc;else{if("string"!=typeof c)throw Ta("Expected stringOrFieldPath to be a string or a FieldPath");l=Ec(t,c)}if(!i.contains(l))throw new Fi(Mi.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");a=a.add(l)}r=To.Jt(a),o=i.fieldTransforms.filter(function(t){return r.Yt(t.field)})}else r=To.Ht(i.en),o=i.fieldTransforms;return new ec(new Co(s),r,o)},vc.prototype.Hc=function(o,t){var s=this,a=new pc(1,o,nr.K);wc("Data must be an object, but it was:",a,t);var u=new gr(nr.F),h=Co.ln();Tr(t,function(t,e){var n=Ec(o,t),i=a.xc(n);if((e=s.Yc(e,i))instanceof Yh)u=u.add(n);else{var r=s.Kc(e,i);null!=r&&(u=u.add(n),h.set(n,r))}});var e=To.Jt(u);return new nc(h.on(),e,a.fieldTransforms)},vc.prototype.Xc=function(t,e,n,i){var r=new pc(1,t,nr.K),o=[bc(t,e)],s=[n];if(i.length%2!=0)throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<i.length;a+=2)o.push(bc(t,i[a])),s.push(i[a+1]);var u=new gr(nr.F),h=Co.ln();for(a=0;a<o.length;++a){var c=o[a],l=r.xc(c),f=this.Yc(s[a],l);if(f instanceof Yh)u=u.add(c);else{var p=this.Kc(f,l);null!=p&&(u=u.add(c),h.set(c,p))}}var d=To.Jt(u);return new nc(h.on(),d,r.fieldTransforms)},vc.prototype.$c=function(t,e,n){void 0===n&&(n=!1);var i=new pc(n?4:3,t,nr.K),r=this.Kc(e,i);return Na(null!=r,"Parsed data should not be null."),Na(0===i.fieldTransforms.length,"Field transforms should have been disallowed."),r},vc.prototype.Yc=function(t,e){try{return this.Wc(t)}catch(t){var n=Ic(t);throw e.Qc(n)}},vc.prototype.Kc=function(t,e){if(gc(t=this.Yc(t,e)))return wc("Unsupported field value:",e,t),this.zc(t,e);if(t instanceof Qh)return this.Zc(t,e),null;if(e.path&&e.en.push(e.path),t instanceof Array){if(e.Uc&&4!==e.jc)throw e.Qc("Nested arrays are not supported");return this.tf(t,e)}return this.nf(t,e)},vc.prototype.zc=function(t,i){var r=this,o={};return Nr(t)?i.path&&0<i.path.length&&i.en.push(i.path):Tr(t,function(t,e){var n=r.Kc(e,i.Mc(t));null!=n&&(o[t]=n)}),{mapValue:{fields:o}}},vc.prototype.tf=function(t,e){for(var n=[],i=0,r=0,o=t;r<o.length;r++){var s=o[r],a=this.Kc(s,e.Bc(i));null==a&&(a={nullValue:"NULL_VALUE"}),n.push(a),i++}return{arrayValue:{values:n}}},vc.prototype.Zc=function(t,e){if(!fc(e.jc))throw e.Qc(t.Oc+"() can only be used with update() and set()");if(null===e.path)throw e.Qc(t.Oc+"() is not currently supported inside arrays");if(t instanceof Yh){if(2!==e.jc)throw 1===e.jc?(Na(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.Qc("FieldValue.delete() can only appear at the top level of your update data")):e.Qc("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.en.push(e.path)}else if(t instanceof Wh)e.fieldTransforms.push(new No(e.path,Xr.instance));else if(t instanceof Kh){var n=this.if(t.Oc,t.Dc),i=new Jr(n);e.fieldTransforms.push(new No(e.path,i))}else if(t instanceof Xh){n=this.if(t.Oc,t.Dc);var r=new $r(n);e.fieldTransforms.push(new No(e.path,r))}else if(t instanceof Jh){var o=this.$c("FieldValue.increment",t.Vc),s=new Zr(this.serializer,o);e.fieldTransforms.push(new No(e.path,s))}else Ta("Unknown FieldValue type: "+t)},vc.prototype.nf=function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return this.serializer.we(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ji.fromDate(t);return{timestampValue:this.serializer.k(n)}}if(t instanceof Ji)return n=new Ji(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:this.serializer.k(n)};if(t instanceof Zh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ph)return{bytesValue:this.serializer.me(t)};if(t instanceof dc)return{referenceValue:this.serializer.ge(t.key.path,t.ce)};throw e.Qc("Unsupported field value: "+Ah(t))},vc.prototype.if=function(i,t){var r=this;return t.map(function(t,e){var n=new pc(3,i,nr.K);return r.Kc(t,n.Bc(e))})},vc);function vc(t,e){this.serializer=t,this.Wc=e}function mc(t,e,n,i,r,o){this.jc=t,this.methodName=e,this.path=n,this.Uc=i,void 0===r&&this.Lc(),this.Uc=void 0!==i&&i,this.fieldTransforms=r||[],this.en=o||[]}function gc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ji||t instanceof Zh||t instanceof Ph||t instanceof dc||t instanceof Qh)}function wc(t,e,n){if(!gc(n)||!Nh(n)){var i=Ah(n);throw"an object"===i?e.Qc(t+" a custom object"):e.Qc(t+" "+i)}}function bc(t,e){if(e instanceof Mh)return e.Rc;if("string"==typeof e)return Ec(t,e);throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Ec(t,e){try{return function(e){if(0<=e.search(Fh))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Mh.bind.apply(Mh,r([void 0],e.split("."))))}catch(t){throw new Fi(Mi.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Rc}catch(e){var n=Ic(e);throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Ic(t){return t instanceof Error?t.message:t.toString()}function Tc(t){this.key=t}function Nc(t){this.key=t}var Ac=(Cc.prototype.lookup=function(i){return c(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.af(),0<this.mutations.length)throw new Fi(Mi.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.ef.lookup(i)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Uo||t instanceof Po?n.cf(t):Ta("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},Cc.prototype.set=function(t,e){this.write(e.Fc(t,this.tn(t))),this.hf.add(t)},Cc.prototype.update=function(t,e){try{this.write(e.Fc(t,this.ff(t)))}catch(t){this.uf=t}this.hf.add(t)},Cc.prototype.delete=function(t){this.write([new Do(t,this.tn(t))]),this.hf.add(t)},Cc.prototype.commit=function(){return c(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.af(),this.uf)throw this.uf;return e=this.rf,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new Oo(t,n.tn(t)))}),[4,this.ef.commit(this.mutations)];case 1:return t.sent(),this.sf=!0,[2]}})})},Cc.prototype.cf=function(t){var e;if(t instanceof Po)e=t.version;else{if(!(t instanceof Uo))throw Ta("Document in a transaction was a "+t.constructor.name);e=$i.D()}var n=this.rf.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Fi(Mi.ABORTED,"Document version changed between two reads.")}else this.rf=this.rf.st(t.key,e)},Cc.prototype.tn=function(t){var e=this.rf.get(t);return!this.hf.has(t)&&e?Ao.updateTime(e):Ao.NONE},Cc.prototype.ff=function(t){var e=this.rf.get(t);if(this.hf.has(t)||!e)return Ao.exists(!0);if(e.isEqual($i.D()))throw new Fi(Mi.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ao.updateTime(e)},Cc.prototype.write=function(t){this.af(),this.mutations=this.mutations.concat(t)},Cc.prototype.af=function(){Na(!this.sf,"A transaction object cannot be used after its update callback has been invoked.")},Cc),Sc=(Oc.prototype.wf=function(){var t=this;0===this.lf&&(this.mf("Unknown"),Na(null===this.df,"onlineStateTimer shouldn't be started yet"),this.df=this.kr.es("online_state_timeout",1e4,function(){return t.df=null,Na("Unknown"===t.state,"Timer should be canceled if we transitioned to a different state."),t.pf("Backend didn't respond within 10 seconds."),t.mf("Offline"),Promise.resolve()}))},Oc.prototype.gf=function(t){"Online"===this.state?(this.mf("Unknown"),Na(0===this.lf,"watchStreamFailures must be 0"),Na(null===this.df,"onlineStateTimer must be null")):(this.lf++,1<=this.lf&&(this.bf(),this.pf("Connection failed 1 times. Most recent error: "+t.toString()),this.mf("Offline")))},Oc.prototype.set=function(t){this.bf(),this.lf=0,"Online"===t&&(this.vf=!1),this.mf(t)},Oc.prototype.mf=function(t){t!==this.state&&(this.state=t,this.jo(t))},Oc.prototype.pf=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.vf?(Ea(e),this.vf=!1):ba("OnlineStateTracker",e)},Oc.prototype.bf=function(){null!==this.df&&(this.df.cancel(),this.df=null)},Oc),kc=(Dc.prototype.start=function(){return this.enableNetwork()},Dc.prototype.enableNetwork=function(){return c(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.If()?(e=this.Pf,[4,this.yf.Gu()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.Uf()?this.Lf():this.Rf.set("Unknown"),[4,this.Mf()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Dc.prototype.disableNetwork=function(){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.qf()];case 1:return t.sent(),this.Rf.set("Offline"),[2]}})})},Dc.prototype.qf=function(){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.Pf.stop()];case 1:return t.sent(),[4,this.Nf.stop()];case 2:return t.sent(),0<this._f.length&&(ba("RemoteStore","Stopping write stream with "+this._f.length+" pending writes"),this._f=[]),this.xf(),[2]}})})},Dc.prototype.shutdown=function(){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return ba("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.qf()];case 1:return t.sent(),this.Sf.shutdown(),this.Rf.set("Unknown"),[2]}})})},Dc.prototype.listen=function(t){this.Tf.has(t.targetId)||(this.Tf.set(t.targetId,t),this.Uf()?this.Lf():this.Nf.Za()&&this.Bf(t))},Dc.prototype.Qf=function(t){Na(this.Tf.has(t),"unlisten called on target no currently watched: "+t),this.Tf.delete(t),this.Nf.Za()&&this.Wf(t),0===this.Tf.size&&(this.Nf.Za()?this.Nf.ic():this.If()&&this.Rf.set("Unknown"))},Dc.prototype.ae=function(t){return this.Tf.get(t)||null},Dc.prototype.he=function(t){return this.Fo.he(t)},Dc.prototype.Bf=function(t){this.Ef.qi(t.targetId),this.Nf.watch(t)},Dc.prototype.Wf=function(t){this.Ef.qi(t),this.Nf.wc(t)},Dc.prototype.Lf=function(){Na(this.Uf(),"startWatchStream() called when shouldStartWatchStream() is false."),this.Ef=new Js(this),this.Nf.start(),this.Rf.wf()},Dc.prototype.Uf=function(){return this.If()&&!this.Nf.$a()&&0<this.Tf.size},Dc.prototype.If=function(){return this.isPrimary&&this.networkEnabled},Dc.prototype.xf=function(){this.Ef=null},Dc.prototype.Of=function(){return c(this,void 0,void 0,function(){var n=this;return y(this,function(t){return this.Tf.forEach(function(t,e){n.Bf(t)}),[2]})})},Dc.prototype.Df=function(e){return c(this,void 0,void 0,function(){return y(this,function(t){return void 0===e&&Na(!this.Uf(),"Watch stream was stopped gracefully while still needed."),this.xf(),this.Uf()?(this.Rf.gf(e),this.Lf()):this.Rf.set("Unknown"),[2]})})},Dc.prototype.Vf=function(n,i){return c(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Rf.set("Online"),n instanceof Hs&&2===n.state&&n.cause?[2,this.Gf(n)]:(n instanceof Gs?this.Ef.Hi(n):n instanceof Bs?this.Ef.ie(n):(Na(n instanceof Hs,"Expected watchChange to be an instance of WatchTargetChange"),this.Ef.Xi(n)),i.isEqual($i.MIN)?[3,3]:[4,this.yf.Ju()]);case 1:return e=t.sent(),0<=i.V(e)?[4,this.zf(i)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Dc.prototype.zf=function(i){var r=this;Na(!i.isEqual($i.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.Ef.se(i);return t.wi.forEach(function(t,e){if(0<t.resumeToken.Mt()){var n=r.Tf.get(e);n&&r.Tf.set(e,n.ei(t.resumeToken,i))}}),t.mi.forEach(function(t){var e=r.Tf.get(t);if(e){r.Tf.set(t,e.ei(Ar.qt,e.ni)),r.Wf(t);var n=new $o(e.target,t,1,e.sequenceNumber);r.Bf(n)}}),this.Fo.Hu(t)},Dc.prototype.Gf=function(t){var n=this;Na(!!t.cause,"Handling target error without a cause");var i=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(e){r=r.then(function(){return c(n,void 0,void 0,function(){return y(this,function(t){return this.Tf.has(e)?(this.Tf.delete(e),this.Ef.removeTarget(e),[2,this.Fo.Jf(e,i)]):[2]})})})}),r},Dc.prototype.Mf=function(){return c(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.Hf()?(e=0<this._f.length?this._f[this._f.length-1].batchId:-1,[4,this.yf.so(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this._f.length&&this.Pf.ic(),[3,4]);case 2:return this.Yf(n),[4,this.Mf()];case 3:t.sent(),t.label=4;case 4:return this.Kf()&&this.Xf(),[2]}})})},Dc.prototype.Hf=function(){return this.If()&&this._f.length<10},Dc.prototype.$f=function(){return this._f.length},Dc.prototype.Yf=function(t){Na(this.Hf(),"addToWritePipeline called when pipeline is full"),this._f.push(t),this.Pf.Za()&&this.Pf.pc&&this.Pf.gc(t.mutations)},Dc.prototype.Kf=function(){return this.If()&&!this.Pf.$a()&&0<this._f.length},Dc.prototype.Xf=function(){Na(this.Kf(),"startWriteStream() called when shouldStartWriteStream() is false."),this.Pf.start()},Dc.prototype.kf=function(){return c(this,void 0,void 0,function(){return y(this,function(t){return this.Pf._c(),[2]})})},Dc.prototype.jf=function(){var i=this;return this.yf.zu(this.Pf.lastStreamToken).then(function(){for(var t=0,e=i._f;t<e.length;t++){var n=e[t];i.Pf.gc(n.mutations)}}).catch(uu)},Dc.prototype.bc=function(t,e){var n=this;Na(0<this._f.length,"Got result for empty write pipeline");var i=this._f.shift(),r=La.from(i,t,e,this.Pf.lastStreamToken);return this.Fo.Zf(r).then(function(){return n.Mf()})},Dc.prototype.Ff=function(n){return c(this,void 0,void 0,function(){var e=this;return y(this,function(t){return void 0===n&&Na(!this.Kf(),"Write stream was stopped gracefully while still needed."),n&&0<this._f.length?[2,(this.Pf.pc?this.tl(n):this.nl(n)).then(function(){e.Kf()&&e.Xf()})]:[2]})})},Dc.prototype.nl=function(e){return c(this,void 0,void 0,function(){return y(this,function(t){return _s(e.code)?(ba("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.Pf.lastStreamToken),this.Pf.lastStreamToken=Ar.qt,[2,this.yf.zu(Ar.qt).catch(uu)]):[2]})})},Dc.prototype.tl=function(r){return c(this,void 0,void 0,function(){var n,i=this;return y(this,function(t){return _s(e=r.code)&&e!==Mi.ABORTED?(n=this._f.shift(),this.Pf.nc(),[2,this.Fo.il(n.batchId,r).then(function(){return i.Mf()})]):[2];var e})})},Dc.prototype.el=function(){return new Ac(this.ef)},Dc.prototype.Cf=function(){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.qf()];case 1:return t.sent(),this.Rf.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Dc.prototype.rl=function(){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.If()?(ba("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.Cf()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Dc.prototype.sl=function(e){return c(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.qf()];case 3:t.sent(),this.Rf.set("Unknown"),t.label=4;case 4:return[2]}})})},Dc),Rc=(Object.defineProperty(_c.prototype,"cl",{get:function(){return this.ul},enumerable:!0,configurable:!0}),_c.prototype.fl=function(t,e){var a=this,u=e?e.ll:new Qs,h=e?e.al:this.al,c=e?e.fi:this.fi,l=h,f=!1,p=this.query.Jn()&&h.size===this.query.limit?h.last():null,d=this.query.Hn()&&h.size===this.query.limit?h.first():null;if(t.at(function(t,e){var n=h.get(t),i=e instanceof Po?e:null;i&&(Na(t.isEqual(i.key),"Mismatching keys found in document changes: "+t+" != "+i.key),i=a.query.matches(i)?i:null);var r=!!n&&a.fi.has(n.key),o=!!i&&(i.nn||a.fi.has(i.key)&&i.hasCommittedMutations),s=!1;n&&i?n.data().isEqual(i.data())?r!==o&&(u.track({type:3,doc:i}),s=!0):a.dl(n,i)||(u.track({type:2,doc:i}),s=!0,(p&&0<a.query.Bn(i,p)||d&&a.query.Bn(i,d)<0)&&(f=!0)):!n&&i?(u.track({type:0,doc:i}),s=!0):n&&!i&&(u.track({type:1,doc:n}),s=!0,(p||d)&&(f=!0)),s&&(c=i?(l=l.add(i),o?c.add(t):c.delete(t)):(l=l.delete(t),c.delete(t)))}),this.query.Jn()||this.query.Hn())for(;l.size>this.query.limit;){var n=this.query.Jn()?l.last():l.first();l=l.delete(n.key),c=c.delete(n.key),u.track({type:1,doc:n})}return Na(!f||!e,"View was refilled using docs that themselves needed refilling."),{al:l,ll:u,Qh:f,fi:c}},_c.prototype.dl=function(t,e){return t.nn&&e.hasCommittedMutations&&!e.nn},_c.prototype.hu=function(t,e,n){var o=this;Na(!t.Qh,"Cannot apply changes that need a refill");var i=this.al;this.al=t.al,this.fi=t.fi;var r=t.ll.ai();r.sort(function(t,e){return i=t.type,r=e.type,n(i)-n(r)||o.query.Bn(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ta("Unknown ChangeType: "+t)}}var i,r}),this.vl(n);var s=e?this.wl():[],a=0===this.hl.size&&this._i?1:0,u=a!==this.ol;return this.ol=a,0!==r.length||u?{snapshot:new Ys(this.query,t.al,i,r,t.fi,0==a,u,!1),ml:s}:{ml:s}},_c.prototype.pl=function(t){return this._i&&"Offline"===t?(this._i=!1,this.hu({al:this.al,ll:new Qs,fi:this.fi,Qh:!1},!1)):{ml:[]}},_c.prototype.gl=function(t){return!this.ul.has(t)&&!!this.al.has(t)&&!this.al.get(t).nn},_c.prototype.vl=function(t){var e=this;t&&(t.Ti.forEach(function(t){return e.ul=e.ul.add(t)}),t.Ei.forEach(function(t){return Na(e.ul.has(t),"Modified document "+t+" not found in view.")}),t.Si.forEach(function(t){return e.ul=e.ul.delete(t)}),this._i=t._i)},_c.prototype.wl=function(){var e=this;if(!this._i)return[];var n=this.hl;this.hl=xs(),this.al.forEach(function(t){e.gl(t.key)&&(e.hl=e.hl.add(t.key))});var i=[];return n.forEach(function(t){e.hl.has(t)||i.push(new Nc(t))}),this.hl.forEach(function(t){n.has(t)||i.push(new Tc(t))}),i},_c.prototype.bl=function(t){this.ul=t.po,this.hl=xs();var e=this.fl(t.documents);return this.hu(e,!0)},_c.prototype.yl=function(){return Ys.vi(this.query,this.al,this.fi,0===this.ol)},_c);function _c(t,e){this.query=t,this.ul=e,this.ol=null,this._i=!1,this.hl=xs(),this.fi=xs(),this.al=new zs(t.Bn.bind(t))}function Dc(t,e,n,i,r){var o=this;this.yf=t,this.ef=e,this._f=[],this.Tf=new Map,this.Ef=null,this.networkEnabled=!1,this.isPrimary=!1,this.Sf=r,this.Sf.Af(function(t){n.Qr(function(){return c(o,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.If()?(ba("RemoteStore","Restarting streams for network reachability change."),[4,this.Cf()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Rf=new Sc(n,i),this.Nf=this.ef.Ec({lc:this.Of.bind(this),oc:this.Df.bind(this),vc:this.Vf.bind(this)}),this.Pf=this.ef.Tc({lc:this.kf.bind(this),oc:this.Ff.bind(this),yc:this.jf.bind(this),bc:this.bc.bind(this)})}function Oc(t,e){this.kr=t,this.jo=e,this.state="Unknown",this.lf=0,this.df=null,this.vf=!0}function Cc(t){this.ef=t,this.rf=Ms(),this.mutations=[],this.sf=!1,this.uf=null,this.hf=new Set}function Lc(t,e,n){this.query=t,this.targetId=e,this.view=n}function Vc(t){this.key=t,this.Cl=!1}function Pc(){this.ad=null,this.targetId=0,this.listeners=[]}var Uc=(Yc.prototype.run=function(){this.El()},Yc.prototype.El=function(){var t=this;this.Xa.Ga(function(){return c(t,void 0,void 0,function(){var e,n,i=this;return y(this,function(t){return e=this._l.el(),(n=this.Sl(e))&&n.then(function(t){i.kr.Qr(function(){return e.commit().then(function(){i.Lr.resolve(t)}).catch(function(t){i.Al(t)})})}).catch(function(t){i.Al(t)}),[2]})})})},Yc.prototype.Sl=function(t){try{var e=this.updateFunction(t);return!kr(e)&&e.catch&&e.then?e:(this.Lr.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Lr.reject(t),null}},Yc.prototype.Al=function(t){var e=this;0<this.Tl&&this.Il(t)?(this.Tl-=1,this.kr.Qr(function(){return e.El(),Promise.resolve()})):this.Lr.reject(t)},Yc.prototype.Il=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!_s(e)},Yc),Mc=(Object.defineProperty(Qc.prototype,"ql",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),Qc.prototype.subscribe=function(t){Na(null!==t,"SyncEngine listener cannot be null"),Na(null===this.Ol,"SyncEngine already has a subscriber."),this.Ol=t},Qc.prototype.listen=function(s){return c(this,void 0,void 0,function(){var e,n,i,r,o;return y(this,function(t){switch(t.label){case 0:return this.xl("listen()"),(i=this.Dl.get(s))?(e=i.targetId,this.Rl.eh(e),n=i.view.yl(),[3,4]):[3,1];case 1:return[4,this.yf.ao(s.xn())];case 2:return r=t.sent(),o=this.Rl.eh(r.targetId),e=r.targetId,[4,this.Bl(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this._l.listen(r),t.label=4;case 4:return this.Ol.vc([n]),[2,e]}})})},Qc.prototype.Bl=function(a,u,h){return c(this,void 0,void 0,function(){var e,n,i,r,o,s;return y(this,function(t){switch(t.label){case 0:return[4,this.yf.vo(a,!0)];case 1:return e=t.sent(),n=new Rc(a,e.po),i=n.fl(e.documents),r=Ks.yi(u,h&&"Offline"!==this.onlineState),Na(0===(o=n.hu(i,!0===this.isPrimary,r)).ml.length,"View returned limbo docs before target ack from the server."),Na(!!o.snapshot,"applyChanges for new view should always return a snapshot"),s=new Lc(a,u,n),this.Dl.set(a,s),this.Vl.has(u)?this.Vl.get(u).push(a):this.Vl.set(u,[a]),[2,o.snapshot]}})})},Qc.prototype.Ql=function(i){return c(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return[4,this.yf.vo(i.query,!0)];case 1:return e=t.sent(),n=i.view.bl(e),this.isPrimary&&this.Wl(i.targetId,n.ml),[2,n]}})})},Qc.prototype.Qf=function(r){return c(this,void 0,void 0,function(){var e,n,i=this;return y(this,function(t){switch(t.label){case 0:return this.xl("unlisten()"),Na(!!(e=this.Dl.get(r)),"Trying to unlisten on query not found:"+r),1<(n=this.Vl.get(e.targetId)).length?(this.Vl.set(e.targetId,n.filter(function(t){return!t.isEqual(r)})),this.Dl.delete(r),[2]):this.isPrimary?(this.Rl.sh(e.targetId),this.Rl.$o(e.targetId)?[3,2]:[4,this.yf.do(e.targetId,!1).then(function(){i.Rl.oh(e.targetId),i._l.Qf(e.targetId),i.Gl(e.targetId)}).catch(uu)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Gl(e.targetId),[4,this.yf.do(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Qc.prototype.write=function(n,i){return c(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.xl("write()"),[4,this.yf.Vu(n)];case 1:return e=t.sent(),this.Rl.Zo(e.batchId),this.zl(e.batchId,i),[4,this.Jl(e.Zs)];case 2:return t.sent(),[4,this._l.Mf()];case 3:return t.sent(),[2]}})})},Qc.prototype.runTransaction=function(t,e,n){new Uc(t,this._l,e,n).run()},Qc.prototype.Hu=function(n){return c(this,void 0,void 0,function(){var e,i=this;return y(this,function(t){switch(t.label){case 0:this.xl("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.yf.Hu(n)];case 2:return e=t.sent(),n.wi.forEach(function(t,e){var n=i.Fl.get(e);n&&(Na(t.Ti.size+t.Ei.size+t.Si.size<=1,"Limbo resolution for single document contains multiple changes."),0<t.Ti.size?n.Cl=!0:0<t.Ei.size?Na(n.Cl,"Received change for limbo target document without add."):0<t.Si.size&&(Na(n.Cl,"Received remove for limbo target document without add."),n.Cl=!1))}),[4,this.Jl(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,uu(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Qc.prototype.pl=function(i,t){if(this.isPrimary&&0===t||!this.isPrimary&&1===t){this.xl("applyOnlineStateChange()");var r=[];this.Dl.forEach(function(t,e){var n=e.view.pl(i);Na(0===n.ml.length,"OnlineState should not affect limbo documents."),n.snapshot&&r.push(n.snapshot)}),this.Ol.Hl(i),this.Ol.vc(r),this.onlineState=i,this.isPrimary&&this.Rl.fh(i)}},Qc.prototype.Jf=function(a,u){return c(this,void 0,void 0,function(){var e,n,i,r,o,s=this;return y(this,function(t){switch(t.label){case 0:return this.xl("rejectListens()"),this.Rl.hh(a,"rejected",u),e=this.Fl.get(a),(n=e&&e.key)?(this.kl=this.kl.remove(n),this.Fl.delete(a),this.Yl(),i=(i=new rr(ir.F)).st(n,new Uo(n,$i.D())),r=xs().add(n),o=new Ws($i.MIN,new Map,new gr(ka),i,r),[2,this.Hu(o)]):[3,1];case 1:return[4,this.yf.do(a,!1).then(function(){return s.Gl(a,u)}).catch(uu)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Qc.prototype.yh=function(n,i,r){return c(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.xl("applyBatchState()"),[4,this.yf.ku(n)];case 1:return null===(e=t.sent())?(ba("SyncEngine","Cannot apply mutation batch with id: "+n),[2]):"pending"!==i?[3,3]:[4,this._l.Mf()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(this.Kl(n,r||null),this.yf._o(n)):Ta("Unknown batchState: "+i),t.label=4;case 4:return[4,this.Jl(e)];case 5:return t.sent(),[2]}})})},Qc.prototype.Zf=function(i){return c(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:this.xl("applySuccessfulWrite()"),e=i.batch.batchId,this.Kl(e,null),this.Xl(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.yf.ju(i)];case 2:return n=t.sent(),this.Rl.nh(e,"acknowledged"),[4,this.Jl(n)];case 3:return t.sent(),[3,6];case 4:return[4,uu(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Qc.prototype.il=function(n,i){return c(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:this.xl("rejectFailedWrite()"),this.Kl(n,i),this.Xl(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.yf.xu(n)];case 2:return e=t.sent(),this.Rl.nh(n,"rejected",i),[4,this.Jl(e)];case 3:return t.sent(),[3,6];case 4:return[4,uu(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Qc.prototype.$l=function(i){return c(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this._l.If()||ba("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.yf.Wu()];case 1:return-1===(e=t.sent())?i.resolve():((n=this.Ll.get(e)||[]).push(i),this.Ll.set(e,n)),[2]}})})},Qc.prototype.Xl=function(t){(this.Ll.get(t)||[]).forEach(function(t){t.resolve()}),this.Ll.delete(t)},Qc.prototype.Zl=function(e){this.Ll.forEach(function(t){t.forEach(function(t){t.reject(new Fi(Mi.CANCELLED,e))})}),this.Ll.clear()},Qc.prototype.zl=function(t,e){var n=this.Ul[this.currentUser.i()];n=(n=n||new rr(ka)).st(t,e),this.Ul[this.currentUser.i()]=n},Qc.prototype.Kl=function(t,e){var n=this.Ul[this.currentUser.i()];if(n){var i=n.get(t);i&&(Na(t===n.ot(),"Mutation callbacks processed out-of-order?"),e?i.reject(e):i.resolve(),n=n.remove(t)),this.Ul[this.currentUser.i()]=n}},Qc.prototype.Gl=function(t,e){var n=this;void 0===e&&(e=null),this.Rl.sh(t),Na(this.Vl.has(t)&&0!==this.Vl.get(t).length,"There are no queries mapped to target id "+t);for(var i=0,r=this.Vl.get(t);i<r.length;i++){var o=r[i];this.Dl.delete(o),e&&this.Ol.td(o,e)}if(this.Vl.delete(t),this.isPrimary){var s=this.jl.Ks(t);this.jl.Hs(t),s.forEach(function(t){n.jl.Xs(t)||n.nd(t)})}},Qc.prototype.nd=function(t){var e=this.kl.get(t);null!==e&&(this._l.Qf(e),this.kl=this.kl.remove(t),this.Fl.delete(e),this.Yl())},Qc.prototype.Wl=function(t,e){for(var n=0,i=e;n<i.length;n++){var r=i[n];r instanceof Tc?(this.jl.Qs(r.key,t),this.ed(r)):r instanceof Nc?(ba("SyncEngine","Document no longer in limbo: "+r.key),this.jl.Gs(r.key,t),this.jl.Xs(r.key)||this.nd(r.key)):Ta("Unknown limbo change: "+JSON.stringify(r))}},Qc.prototype.ed=function(t){var e=t.key;this.kl.get(e)||(ba("SyncEngine","New document in limbo: "+e),this.Pl.push(e),this.Yl())},Qc.prototype.Yl=function(){for(;0<this.Pl.length&&this.kl.size<this.Nl;){var t=this.Pl.shift(),e=this.Ml.next();this.Fl.set(e,new Vc(t)),this.kl=this.kl.st(t,e),this._l.listen(new $o(xo.Nn(t.path).xn(),e,2,Ua.Pr))}},Qc.prototype.rd=function(){return this.kl},Qc.prototype.sd=function(){return this.Pl},Qc.prototype.Jl=function(i,u){return c(this,void 0,void 0,function(){var o,s,e,a=this;return y(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Dl.forEach(function(t,r){e.push(Promise.resolve().then(function(){var n=r.view.fl(i);return n.Qh?a.yf.vo(r.query,!1).then(function(t){var e=t.documents;return r.view.fl(e,n)}):n}).then(function(t){var e=u&&u.wi.get(r.targetId),n=r.view.hu(t,!0===a.isPrimary,e);if(a.Wl(r.targetId,n.ml),n.snapshot){a.isPrimary&&a.Rl.hh(r.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var i=Pa.Rr(r.targetId,n.snapshot);s.push(i)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Ol.vc(o),[4,this.yf.ro(s)];case 2:return t.sent(),[2]}})})},Qc.prototype.xl=function(t){Na(null!==this.Ol,"Trying to call "+t+" before calling subscribe().")},Qc.prototype.rl=function(i){return c(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(i),this.currentUser=i,e?(this.Zl("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.yf.Iu(i)]):[3,3];case 1:return n=t.sent(),this.Rl.Iu(i,n.Ou,n.Du),[4,this.Jl(n.Nu)];case 2:t.sent(),t.label=3;case 3:return[4,this._l.rl()];case 4:return t.sent(),[2]}})})},Qc.prototype.sl=function(u){return c(this,void 0,void 0,function(){var e,n,i,r,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return!0!==u||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this._l.sl(!0)]);case 1:return t.sent(),o=this.Rl.Xo(),[4,this.ud(o.J())];case 2:for(e=t.sent(),n=0,i=e;n<i.length;n++)r=i[n],this._l.listen(r);return[3,7];case 3:return!1!==u||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),this.Vl.forEach(function(t,e){a.Rl.uh(e)?o.push(e):s=s.then(function(){return a.Gl(e),a.yf.do(e,!0)}),a._l.Qf(e)}),[4,s]);case 4:return t.sent(),[4,this.ud(o)];case 5:return t.sent(),this.od(),[4,this._l.sl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Qc.prototype.od=function(){var n=this;this.Fl.forEach(function(t,e){n._l.Qf(e)}),this.jl.Ys(),this.Fl=new Map,this.kl=new rr(ir.F)},Qc.prototype.ud=function(d){return c(this,void 0,void 0,function(){var e,n,i,r,o,s,a,u,h,c,l,f,p;return y(this,function(t){switch(t.label){case 0:e=[],n=[],i=0,r=d,t.label=1;case 1:return i<r.length?(o=r[i],s=void 0,(a=this.Vl.get(o))&&0!==a.length?[4,this.yf.do(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.yf.ao(a[0].xn())];case 3:s=t.sent(),u=0,h=a,t.label=4;case 4:return u<h.length?(c=h[u],Na(!!(l=this.Dl.get(c)),"No query view found for "+c),[4,this.Ql(l)]):[3,7];case 5:(f=t.sent()).snapshot&&n.push(f.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Na(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.yf.Ao(o)];case 9:return Na(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.yf.ao(p)];case 10:return s=t.sent(),[4,this.Bl(this.hd(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return i++,[3,1];case 14:return this.Ol.vc(n),[2,e]}})})},Qc.prototype.hd=function(t){return new xo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},Qc.prototype.yo=function(){return this.yf.yo()},Qc.prototype._h=function(i,r,o){return c(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(this.isPrimary)return ba("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.Vl.has(i))return[3,7];switch(r){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.yf.Io()];case 2:return e=t.sent(),n=Ws.bi(i,"current"===r),[4,this.Jl(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.yf.do(i,!0)];case 5:return t.sent(),this.Gl(i,o),[3,7];case 6:Ta("Unexpected target state: "+r),t.label=7;case 7:return[2]}})})},Qc.prototype.Th=function(l,f){return c(this,void 0,void 0,function(){var e,n,i,r,o,s,a,u,h,c=this;return y(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(h=n[e],Na(!this.Vl.has(h),"Trying to add an already active target"),[4,this.yf.Ao(h)]):[3,6];case 2:return Na(!!(i=t.sent()),"Query data for active target "+h+" not found"),[4,this.yf.ao(i)];case 3:return r=t.sent(),[4,this.Bl(this.hd(i),r.targetId,!1)];case 4:t.sent(),this._l.listen(r),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return y(this,function(t){switch(t.label){case 0:return s.Vl.has(e)?[4,s.yf.do(e,!1).then(function(){c._l.Qf(e),c.Gl(e)}).catch(uu)]:[2,"continue"];case 1:return t.sent(),[2]}})},s=this,a=0,u=f,t.label=7;case 7:return a<u.length?(h=u[a],[5,o(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Qc.prototype.enableNetwork=function(){return this.yf.Eo(!0),this._l.enableNetwork()},Qc.prototype.disableNetwork=function(){return this.yf.Eo(!1),this._l.disableNetwork()},Qc.prototype.he=function(t){var e=this.Fl.get(t);if(e&&e.Cl)return xs().add(e.key);var n=xs(),i=this.Vl.get(t);if(!i)return n;for(var r=0,o=i;r<o.length;r++){var s=o[r],a=this.Dl.get(s);Na(!!a,"No query view found for "+s),n=n.Ft(a.view.cl)}return n},Qc),Fc=(zc.prototype.listen=function(t){var e=t.query,n=!1,i=this.fd.get(e);return i||(n=!0,i=new Pc,this.fd.set(e,i)),i.listeners.push(t),Na(!t.pl(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),i.ad&&t.dd(i.ad)&&this.vd(),n?this.Fo.listen(e).then(function(t){return i.targetId=t}):Promise.resolve(i.targetId)},zc.prototype.Qf=function(o){return c(this,void 0,void 0,function(){var e,n,i,r;return y(this,function(t){return e=o.query,n=!1,(i=this.fd.get(e))&&0<=(r=i.listeners.indexOf(o))&&(i.listeners.splice(r,1),n=0===i.listeners.length),n?(this.fd.delete(e),[2,this.Fo.Qf(e)]):[2]})})},zc.prototype.vc=function(t){for(var e=!1,n=0,i=t;n<i.length;n++){var r=i[n],o=r.query,s=this.fd.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].dd(r)&&(e=!0);s.ad=r}}e&&this.vd()},zc.prototype.td=function(t,e){var n=this.fd.get(t);if(n)for(var i=0,r=n.listeners;i<r.length;i++)r[i].onError(e);this.fd.delete(t)},zc.prototype.Hl=function(r){this.onlineState=r;var o=!1;this.fd.forEach(function(t,e){for(var n=0,i=e.listeners;n<i.length;n++)i[n].pl(r)&&(o=!0)}),o&&this.vd()},zc.prototype.wd=function(t){this.ld.add(t),t.next()},zc.prototype.md=function(t){this.ld.delete(t)},zc.prototype.vd=function(){this.ld.forEach(function(t){t.next()})},zc),xc=(Hc.prototype.dd=function(t){if(Na(0<t.docChanges.length||t.li,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,i=t.docChanges;n<i.length;n++){var r=i[n];3!==r.type&&e.push(r)}t=new Ys(t.query,t.docs,t.ci,e,t.fi,t.fromCache,t.li,!0)}var o=!1;return this.gd?this.yd(t)&&(this.pd.next(t),o=!0):this._d(t,this.onlineState)&&(this.Td(t),o=!0),this.bd=t,o},Hc.prototype.onError=function(t){this.pd.error(t)},Hc.prototype.pl=function(t){this.onlineState=t;var e=!1;return this.bd&&!this.gd&&this._d(this.bd,t)&&(this.Td(this.bd),e=!0),e},Hc.prototype._d=function(t,e){if(Na(!this.gd,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n="Offline"!==e;return this.options.Ed&&n?(Na(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.M()||"Offline"===e},Hc.prototype.yd=function(t){if(0<t.docChanges.length)return!0;var e=this.bd&&this.bd.hasPendingWrites!==t.hasPendingWrites;return!(!t.li&&!e)&&!0===this.options.includeMetadataChanges},Hc.prototype.Td=function(t){Na(!this.gd,"Trying to raise initial events for second time"),t=Ys.vi(t.query,t.docs,t.fi,t.fromCache),this.gd=!0,this.pd.next(t)},Hc),qc=(Bc.prototype.start=function(e,n){var i=this;this.Ad();var r=new Da,o=new Da,s=!1;return this.credentials.v(function(t){s?i.kr.Qr(function(){return i.rl(t)}):(s=!0,i.Id(e,n,t,o).then(function(){return i.Cd(t)}).then(r.resolve,r.reject))}),this.kr.Qr(function(){return r.promise}),o.promise},Bc.prototype.enableNetwork=function(){var t=this;return this.Ad(),this.kr.enqueue(function(){return t.Fo.enableNetwork()})},Bc.prototype.Id=function(n,i,r,o){return c(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n.initialize(this.kr,this.Sd,this.platform,this.clientId,r,i)];case 1:return t.sent(),this.persistence=n.ja(),this.Rd=n.Fa(),this.Rl=n.Ua(),o.resolve(),[3,3];case 2:if(e=t.sent(),o.reject(e),!this.Nd(e))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),[2,this.Id(new Ku,{ka:!1},r,o)];case 3:return[2]}})})},Bc.prototype.Nd=function(t){return"FirebaseError"===t.name?t.code===Mi.FAILED_PRECONDITION||t.code===Mi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Bc.prototype.Ad=function(){if(this.kr.Kr)throw new Fi(Mi.FAILED_PRECONDITION,"The client has already been terminated.")},Bc.prototype.Cd=function(h){var t=this;return ba("FirestoreClient","Initializing. user=",h.uid),this.platform.Od(this.Sd).then(function(u){return c(t,void 0,void 0,function(){var e,n,i,r,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return e=new ku,this.yf=new eu(this.persistence,e,h),[4,this.yf.start()];case 1:return t.sent(),n=this.platform.Dd(),i=this.platform.Vd(this.Sd.ce),r=new th(this.kr,u,this.credentials,i),o=function(t){return a.Fo.pl(t,0)},s=function(t){return a.Fo.pl(t,1)},this._l=new kc(this.yf,r,this.kr,o,n),this.Fo=new Mc(this.yf,this._l,this.Rl,h,100),this.Rl.jo=s,this._l.Fo=this.Fo,this.Rl.Fo=this.Fo,this.Pd=new Fc(this.Fo),[4,this.Rl.start()];case 2:return t.sent(),[4,this._l.start()];case 3:return t.sent(),[4,this.persistence.Aa(function(e){return c(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.Fo.sl(e)];case 1:return t.sent(),e&&!this.Rd.Ls?this.Rd.start(this.yf):e||this.Rd.stop(),[2]}})})})];case 4:return t.sent(),[4,this.persistence.Ia(function(){return c(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},Bc.prototype.rl=function(t){return this.kr.ss(),ba("FirestoreClient","Credential Changed. Current user: "+t.uid),this.Fo.rl(t)},Bc.prototype.disableNetwork=function(){var t=this;return this.Ad(),this.kr.enqueue(function(){return t.Fo.disableNetwork()})},Bc.prototype.terminate=function(){var t=this;return this.kr.ns(function(){return c(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Rd.stop(),[4,this._l.shutdown()];case 1:return t.sent(),[4,this.Rl.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.m(),[2]}})})})},Bc.prototype.waitForPendingWrites=function(){var t=this;this.Ad();var e=new Da;return this.kr.Qr(function(){return t.Fo.$l(e)}),e.promise},Bc.prototype.listen=function(t,e,n){var i=this;this.Ad();var r=new xc(t,e,n);return this.kr.Qr(function(){return i.Pd.listen(r)}),r},Bc.prototype.Qf=function(t){var e=this;this.kd||this.kr.Qr(function(){return e.Pd.Qf(t)})},Bc.prototype.Fd=function(t){var e=this;return this.Ad(),this.kr.enqueue(function(){return e.yf.oo(t)}).then(function(t){if(t instanceof Po)return t;if(t instanceof Uo)return null;throw new Fi(Mi.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Bc.prototype.jd=function(r){var t=this;return this.Ad(),this.kr.enqueue(function(){return c(t,void 0,void 0,function(){var e,n,i;return y(this,function(t){switch(t.label){case 0:return[4,this.yf.vo(r,!0)];case 1:return e=t.sent(),n=new Rc(r,e.po),i=n.fl(e.documents),[2,n.hu(i,!1).snapshot]}})})})},Bc.prototype.write=function(t){var e=this;this.Ad();var n=new Da;return this.kr.Qr(function(){return e.Fo.write(t,n)}),n.promise},Bc.prototype.ce=function(){return this.Sd.ce},Bc.prototype.wd=function(t){var e=this;this.Ad(),this.kr.Qr(function(){return e.Pd.wd(t),Promise.resolve()})},Bc.prototype.md=function(t){this.kd||this.Pd.md(t)},Object.defineProperty(Bc.prototype,"kd",{get:function(){return this.kr.Kr},enumerable:!0,configurable:!0}),Bc.prototype.transaction=function(t){var e=this;this.Ad();var n=new Da;return this.kr.Qr(function(){return e.Fo.runTransaction(e.kr,t,n),Promise.resolve()}),n.promise},Bc),jc=(Gc.prototype.next=function(t){this.Ud(this.observer.next,t)},Gc.prototype.error=function(t){this.Ud(this.observer.error,t)},Gc.prototype.Ld=function(){this.muted=!0},Gc.prototype.Ud=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Gc);function Gc(t){this.observer=t,this.muted=!1}function Bc(t,e,n,i){this.platform=t,this.Sd=e,this.credentials=n,this.kr=i,this.clientId=Aa.pr()}function Hc(t,e,n){this.query=t,this.pd=e,this.gd=!1,this.bd=null,this.onlineState="Unknown",this.options=n||{}}function zc(t){this.Fo=t,this.fd=new Va(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.ld=new Set,this.Fo.subscribe(this)}function Qc(t,e,n,i,r){this.yf=t,this._l=e,this.Rl=n,this.currentUser=i,this.Nl=r,this.Ol=null,this.Dl=new Va(function(t){return t.canonicalId()}),this.Vl=new Map,this.Pl=[],this.kl=new rr(ir.F),this.Fl=new Map,this.jl=new $a,this.Ul={},this.Ll=new Map,this.Ml=Bu.ca(),this.isPrimary=void 0,this.onlineState="Unknown"}function Yc(t,e,n,i){this.kr=t,this._l=e,this.updateFunction=n,this.Lr=i,this.Tl=5,this.Xa=new Xu(this.kr,"retry_transaction")}function Wc(r){return function(){if("object"!=typeof r||null===r)return!1;for(var t=r,e=0,n=["next","error","complete"];e<n.length;e++){var i=n[e];if(i in t&&"function"==typeof t[i])return!0}return!1}()}var Kc,Xc=(gl.prototype.qd=function(t){switch(Lr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return qr(t.integerValue||t.doubleValue);case 3:return this.xd(t.timestampValue);case 4:return this.Bd(t);case 5:return t.stringValue;case 6:return new Ph(jr(t.bytesValue));case 7:return this.Qd(t.referenceValue);case 8:return new Zh(t.geoPointValue.latitude,t.geoPointValue.longitude);case 9:return this.Wd(t.arrayValue);case 10:return this.Gd(t.mapValue);default:throw Ta("Invalid value type: "+JSON.stringify(t))}},gl.prototype.Gd=function(t){var n=this,i={};return Tr(t.fields||{},function(t,e){i[t]=n.qd(e)}),i},gl.prototype.Wd=function(t){var e=this;return(t.values||[]).map(function(t){return e.qd(t)})},gl.prototype.Bd=function(t){switch(this.Md){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return Dr(n)?t(n):n}(t);return null==e?null:this.qd(e);case"estimate":return this.xd(Or(t));default:return null}},gl.prototype.xd=function(t){var e=xr(t),n=new Ji(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},gl.prototype.Qd=function(t){var e=tr.Y(t);Na(da(e),"ReferenceValue is not valid "+t);var n=new Oa(e.get(1),e.get(3)),i=new ir(e.U(5));return n.isEqual(this.firestore.zd)||Ea("Document "+i+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.zd.projectId+"/"+this.firestore.zd.database+") instead."),new nl(i,this.firestore,this.converter)},gl),Jc=Ja.Os,$c=(ml.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},ml),Zc=(vl.prototype.settings=function(t){if(yh("Firestore.settings",arguments,1),gh("Firestore.settings","object",1,t),kl(t,"persistence"))throw new Fi(Mi.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new $c(t);if(this.Kd&&!this.nv.isEqual(e))throw new Fi(Mi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.nv=e).credentials&&(this.Zd=function(t){if(!t)return new xi;switch(t.type){case"gapi":var e=t.C;return Na(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Gi(e,t.A||"0");case"provider":return t.C;default:throw new Fi(Mi.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},vl.prototype.enableNetwork=function(){return this.Yd(),this.Kd.enableNetwork()},vl.prototype.disableNetwork=function(){return this.Yd(),this.Kd.disableNetwork()},vl.prototype.enablePersistence=function(t){var e,n;if(this.Kd)throw new Fi(Mi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var i=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Ea("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),i=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.rv(this.tv,{ka:!0,cacheSizeBytes:this.nv.cacheSizeBytes,synchronizeTabs:i})},vl.prototype.clearPersistence=function(){return c(this,void 0,void 0,function(){var i,e=this;return y(this,function(t){if(void 0!==this.Kd&&!this.Kd.kd)throw new Fi(Mi.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return i=new Da,this.Hd.Xr(function(){return c(e,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.sv(),[4,this.tv.clearPersistence(e)];case 1:return t.sent(),i.resolve(),[3,3];case 2:return n=t.sent(),i.reject(n),[3,3];case 3:return[2]}})})}),[2,i.promise]})})},vl.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(vl.prototype,"uv",{get:function(){return this.Yd(),this.Kd.kd},enumerable:!0,configurable:!0}),vl.prototype.waitForPendingWrites=function(){return this.Yd(),this.Kd.waitForPendingWrites()},vl.prototype.onSnapshotsInSync=function(t){if(this.Yd(),Wc(t))return this.ov(t);gh("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.ov(e)},vl.prototype.ov=function(t){var e=this,n=new jc({next:function(){t.next&&t.next()},error:function(t){throw Ta("Uncaught Error in onSnapshotsInSync")}});return this.Kd.wd(n),function(){n.Ld(),e.Kd.md(n)}},vl.prototype.Yd=function(){return this.Kd||this.rv(new Ku,{ka:!1}),this.Kd},vl.prototype.sv=function(){return new _a(this.zd,this.$d,this.nv.host,this.nv.ssl,this.nv.forceLongPolling)},vl.prototype.rv=function(t,e){Na(!!this.nv.host,"FirestoreSettings.host is not set"),Na(!this.Kd,"configureClient() called multiple times");var n=this.sv();return this.Kd=new qc(ya.Lt(),n,this.Zd,this.Hd),this.Kd.start(t,e)},vl.prototype.ev=function(i){var t=new fa(i,{de:ya.Lt().de});return new yc(t,function(t){if(t instanceof nl){var e=i,n=t.firestore.zd;if(!n.isEqual(e))throw new Fi(Mi.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new dc(i,t.hv)}return t})},vl.Xd=function(t){if(!kl(t.options,"projectId"))throw new Fi(Mi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e=t.options.projectId;if(!e||"string"!=typeof e)throw new Fi(Mi.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Oa(e)},Object.defineProperty(vl.prototype,"app",{get:function(){if(!this.Jd)throw new Fi(Mi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Jd},enumerable:!0,configurable:!0}),vl.prototype.collection=function(t){return yh("Firestore.collection",arguments,1),gh("Firestore.collection","non-empty string",1,t),this.Yd(),new bl(tr.Y(t),this)},vl.prototype.doc=function(t){return yh("Firestore.doc",arguments,1),gh("Firestore.doc","non-empty string",1,t),this.Yd(),nl.av(tr.Y(t),this)},vl.prototype.collectionGroup=function(t){if(yh("Firestore.collectionGroup",arguments,1),gh("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Yd(),new sl(new xo(tr.K,t),this)},vl.prototype.runTransaction=function(e){var n=this;return yh("Firestore.runTransaction",arguments,1),gh("Firestore.runTransaction","function",1,e),this.Yd().transaction(function(t){return e(new tl(n,t))})},vl.prototype.batch=function(){return this.Yd(),new el(this)},Object.defineProperty(vl,"logLevel",{get:function(){switch(ga()){case a.DEBUG:return"debug";case a.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),vl.setLogLevel=function(t){switch(yh("Firestore.setLogLevel",arguments,1),gh("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":wa(a.DEBUG);break;case"error":wa(a.ERROR);break;case"silent":wa(a.SILENT);break;default:throw new Fi(Mi.INVALID_ARGUMENT,"Invalid log level: "+t)}},vl.prototype.cv=function(){return this.nv.timestampsInSnapshots},vl),tl=(yl.prototype.get=function(t){var n=this;yh("Transaction.get",arguments,1);var i=Al("Transaction.get",t,this.fv);return this.lv.lookup([i.hv]).then(function(t){if(!t||1!==t.length)return Ta("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Uo)return new rl(n.fv,i.hv,null,!1,!1,i.dv);if(e instanceof Po)return new rl(n.fv,i.hv,e,!1,!1,i.dv);throw Ta("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},yl.prototype.set=function(t,e,n){mh("Transaction.set",arguments,2,3);var i=Al("Transaction.set",t,this.fv);n=Il("Transaction.set",n);var r=Sl(i.dv,e,"Transaction.set"),o=r[0],s=r[1],a=n.merge||n.mergeFields?this.fv.iv.Jc(s,o,n.mergeFields):this.fv.iv.Gc(s,o);return this.lv.set(i.hv,a),this},yl.prototype.update=function(t,e,n){for(var i,r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return r="string"==typeof e||e instanceof Mh?(vh("Transaction.update",arguments,3),i=Al("Transaction.update",t,this.fv),this.fv.iv.Xc("Transaction.update",e,n,o)):(yh("Transaction.update",arguments,2),i=Al("Transaction.update",t,this.fv),this.fv.iv.Hc("Transaction.update",e)),this.lv.update(i.hv,r),this},yl.prototype.delete=function(t){yh("Transaction.delete",arguments,1);var e=Al("Transaction.delete",t,this.fv);return this.lv.delete(e.hv),this},yl),el=(dl.prototype.set=function(t,e,n){mh("WriteBatch.set",arguments,2,3),this.mv();var i=Al("WriteBatch.set",t,this.fv);n=Il("WriteBatch.set",n);var r=Sl(i.dv,e,"WriteBatch.set"),o=r[0],s=r[1],a=n.merge||n.mergeFields?this.fv.iv.Jc(s,o,n.mergeFields):this.fv.iv.Gc(s,o);return this.vv=this.vv.concat(a.Fc(i.hv,Ao.NONE)),this},dl.prototype.update=function(t,e,n){for(var i,r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.mv(),r="string"==typeof e||e instanceof Mh?(vh("WriteBatch.update",arguments,3),i=Al("WriteBatch.update",t,this.fv),this.fv.iv.Xc("WriteBatch.update",e,n,o)):(yh("WriteBatch.update",arguments,2),i=Al("WriteBatch.update",t,this.fv),this.fv.iv.Hc("WriteBatch.update",e)),this.vv=this.vv.concat(r.Fc(i.hv,Ao.exists(!0))),this},dl.prototype.delete=function(t){yh("WriteBatch.delete",arguments,1),this.mv();var e=Al("WriteBatch.delete",t,this.fv);return this.vv=this.vv.concat(new Do(e.hv,Ao.NONE)),this},dl.prototype.commit=function(){return this.mv(),this.wv=!0,0<this.vv.length?this.fv.Yd().write(this.vv):Promise.resolve()},dl.prototype.mv=function(){if(this.wv)throw new Fi(Mi.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},dl),nl=(pl.av=function(t,e,n){if(t.length%2!=0)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.H()+" has "+t.length);return new pl(new ir(t),e,n)},Object.defineProperty(pl.prototype,"id",{get:function(){return this.hv.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"parent",{get:function(){return new bl(this.hv.path.L(),this.firestore,this.dv)},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"path",{get:function(){return this.hv.path.H()},enumerable:!0,configurable:!0}),pl.prototype.collection=function(t){if(yh("DocumentReference.collection",arguments,1),gh("DocumentReference.collection","non-empty string",1,t),!t)throw new Fi(Mi.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=tr.Y(t);return new bl(this.hv.path.child(e),this.firestore)},pl.prototype.isEqual=function(t){if(!(t instanceof pl))throw Rh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.hv.isEqual(t.hv)&&this.dv===t.dv},pl.prototype.set=function(t,e){mh("DocumentReference.set",arguments,1,2),e=Il("DocumentReference.set",e);var n=Sl(this.dv,t,"DocumentReference.set"),i=n[0],r=n[1],o=e.merge||e.mergeFields?this.firestore.iv.Jc(r,i,e.mergeFields):this.firestore.iv.Gc(r,i);return this.Kd.write(o.Fc(this.hv,Ao.NONE))},pl.prototype.update=function(t,e){for(var n,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return n="string"==typeof t||t instanceof Mh?(vh("DocumentReference.update",arguments,2),this.firestore.iv.Xc("DocumentReference.update",t,e,i)):(yh("DocumentReference.update",arguments,1),this.firestore.iv.Hc("DocumentReference.update",t)),this.Kd.write(n.Fc(this.hv,Ao.exists(!0)))},pl.prototype.delete=function(){return yh("DocumentReference.delete",arguments,0),this.Kd.write([new Do(this.hv,Ao.NONE)])},pl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];mh("DocumentReference.onSnapshot",arguments,1,4);var n,i={includeMetadataChanges:!1},r=0;"object"!=typeof t[r]||Wc(t[r])||(kh("DocumentReference.onSnapshot",i=t[r],["includeMetadataChanges"]),Eh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",i.includeMetadataChanges),r++);var o={includeMetadataChanges:i.includeMetadataChanges};return n=Wc(t[r])?t[r]:(gh("DocumentReference.onSnapshot","function",r,t[r]),wh("DocumentReference.onSnapshot","function",r+1,t[r+1]),wh("DocumentReference.onSnapshot","function",r+2,t[r+2]),{next:t[r],error:t[r+1],complete:t[r+2]}),this.pv(o,n)},pl.prototype.pv=function(t,n){var i=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var r=new jc({next:function(t){if(n.next){Na(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(i.hv);n.next(new rl(i.firestore,i.hv,e,t.fromCache,t.hasPendingWrites,i.dv))}},error:e}),o=this.Kd.listen(xo.Nn(this.hv.path),r,t);return function(){r.Ld(),i.Kd.Qf(o)}},pl.prototype.get=function(n){var i=this;return mh("DocumentReference.get",arguments,0,1),Nl("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?i.firestore.Yd().Fd(i.hv).then(function(t){e(new rl(i.firestore,i.hv,t,!0,t instanceof Po&&t.nn,i.dv))},t):i.gv(e,t,n)})},pl.prototype.gv=function(e,n,i){var r=this.pv({includeMetadataChanges:!0,Ed:!0},{next:function(t){r(),!t.exists&&t.metadata.fromCache?n(new Fi(Mi.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&i&&"server"===i.source?n(new Fi(Mi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},pl.prototype.withConverter=function(t){return new pl(this.hv,this.firestore,t)},pl),il=(fl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},fl),rl=(ll.prototype.data=function(t){if(mh("DocumentSnapshot.data",arguments,0,1),t=Tl("DocumentSnapshot.data",t),this.bv){if(this.dv){var e=new ol(this.fv,this.hv,this.bv,this.yv,this._v);return this.dv.fromFirestore(e,t)}return new Xc(this.fv,this.fv.cv(),t.serverTimestamps,void 0).qd(this.bv.yn())}},ll.prototype.get=function(t,e){if(mh("DocumentSnapshot.get",arguments,1,2),e=Tl("DocumentSnapshot.get",e),this.bv){var n=this.bv.data().field(bc("DocumentSnapshot.get",t));if(null!==n)return new Xc(this.fv,this.fv.cv(),e.serverTimestamps,this.dv).qd(n)}},Object.defineProperty(ll.prototype,"id",{get:function(){return this.hv.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(ll.prototype,"ref",{get:function(){return new nl(this.hv,this.fv,this.dv)},enumerable:!0,configurable:!0}),Object.defineProperty(ll.prototype,"exists",{get:function(){return null!==this.bv},enumerable:!0,configurable:!0}),Object.defineProperty(ll.prototype,"metadata",{get:function(){return new il(this._v,this.yv)},enumerable:!0,configurable:!0}),ll.prototype.isEqual=function(t){if(!(t instanceof ll))throw Rh("isEqual","DocumentSnapshot",1,t);return this.fv===t.fv&&this.yv===t.yv&&this.hv.isEqual(t.hv)&&(null===this.bv?null===t.bv:this.bv.isEqual(t.bv))&&this.dv===t.dv},ll),ol=(t(cl,Kc=rl),cl.prototype.data=function(t){var e=Kc.prototype.data.call(this,t);return Na(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},cl),sl=(hl.prototype.where=function(t,e,n){var i;yh("Query.where",arguments,3),Sh("Query.where",3,n),function(t,e,n,i){if(!e.some(function(t){return t===i}))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid value "+Ah(i)+" provided to function "+t+"() for its "+Dh(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var r=bc("Query.where",t),o=qo.Y(e);if(r.$()){if(o===qo.ARRAY_CONTAINS||o===qo.ARRAY_CONTAINS_ANY)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===qo.IN){this.Ev(n,o);for(var s=[],a=0,u=n;a<u.length;a++){var h=u[a];s.push(this.Sv(h))}i={arrayValue:{values:s}}}else i=this.Sv(n)}else o!==qo.IN&&o!==qo.ARRAY_CONTAINS_ANY||this.Ev(n,o),i=this.firestore.iv.$c("Query.where",n,o===qo.IN);var c=jo.create(r,o,i);return this.Av(c),new hl(this.Tv.Vn(c),this.firestore,this.dv)},hl.prototype.orderBy=function(t,e){var n;if(mh("Query.orderBy",arguments,1,2),wh("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Yo.ASCENDING;else{if("desc"!==e)throw new Fi(Mi.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Yo.DESCENDING}if(null!==this.Tv.startAt)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.Tv.endAt)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=bc("Query.orderBy",t),r=new Ko(i,n);return this.Iv(r),new hl(this.Tv.kn(r),this.firestore,this.dv)},hl.prototype.limit=function(t){return yh("Query.limit",arguments,1),gh("Query.limit","number",1,t),_h("Query.limit",1,t),new hl(this.Tv.Fn(t),this.firestore,this.dv)},hl.prototype.limitToLast=function(t){return yh("Query.limitToLast",arguments,1),gh("Query.limitToLast","number",1,t),_h("Query.limitToLast",1,t),new hl(this.Tv.jn(t),this.firestore,this.dv)},hl.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];vh("Query.startAt",arguments,1);var i=this.Cv("Query.startAt",t,e,!0);return new hl(this.Tv.Un(i),this.firestore,this.dv)},hl.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];vh("Query.startAfter",arguments,1);var i=this.Cv("Query.startAfter",t,e,!1);return new hl(this.Tv.Un(i),this.firestore,this.dv)},hl.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];vh("Query.endBefore",arguments,1);var i=this.Cv("Query.endBefore",t,e,!0);return new hl(this.Tv.Ln(i),this.firestore,this.dv)},hl.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];vh("Query.endAt",arguments,1);var i=this.Cv("Query.endAt",t,e,!1);return new hl(this.Tv.Ln(i),this.firestore,this.dv)},hl.prototype.isEqual=function(t){if(!(t instanceof hl))throw Rh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.Tv.isEqual(t.Tv)},hl.prototype.withConverter=function(t){return new hl(this.Tv,this.firestore,t)},hl.prototype.Cv=function(t,e,n,i){if(Sh(t,1,e),e instanceof rl){if(0<n.length)throw new Fi(Mi.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var r=e;if(!r.exists)throw new Fi(Mi.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.Rv(r.bv,i)}var o=[e].concat(n);return this.Nv(t,o,i)},hl.prototype.Rv=function(t,e){for(var n=[],i=0,r=this.Tv.orderBy;i<r.length;i++){var o=r[i];if(o.field.$())n.push(Gr(this.firestore.zd,t.key));else{var s=t.field(o.field);if(Dr(s))throw new Fi(Mi.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var a=o.field.H();throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}n.push(s)}}return new Wo(n,e)},hl.prototype.Nv=function(t,e,n){var i=this.Tv.Sn;if(e.length>i.length)throw new Fi(Mi.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var r=[],o=0;o<e.length;o++){var s=e[o];if(i[o].field.$()){if("string"!=typeof s)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.Tv.Kn()&&-1!==s.indexOf("/"))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this.Tv.path.child(tr.Y(s));if(!ir.nt(a))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new ir(a);r.push(Gr(this.firestore.zd,u))}else{var h=this.firestore.iv.$c(t,s);r.push(h)}}return new Wo(r,n)},hl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];mh("Query.onSnapshot",arguments,1,4);var n,i={},r=0;return"object"!=typeof t[r]||Wc(t[r])||(kh("Query.onSnapshot",i=t[r],["includeMetadataChanges"]),Eh("Query.onSnapshot","boolean","includeMetadataChanges",i.includeMetadataChanges),r++),n=Wc(t[r])?t[r]:(gh("Query.onSnapshot","function",r,t[r]),wh("Query.onSnapshot","function",r+1,t[r+1]),wh("Query.onSnapshot","function",r+2,t[r+2]),{next:t[r],error:t[r+1],complete:t[r+2]}),this.Ov(this.Tv),this.pv(i,n)},hl.prototype.pv=function(t,e){var n=this,i=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(i=e.error.bind(e));var r=new jc({next:function(t){e.next&&e.next(new al(n.firestore,n.Tv,t,n.dv))},error:i}),o=this.firestore.Yd(),s=o.listen(this.Tv,r,t);return function(){r.Ld(),o.Qf(s)}},hl.prototype.Ov=function(t){if(t.Hn()&&0===t.Sn.length)throw new Fi(Mi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},hl.prototype.get=function(n){var i=this;return mh("Query.get",arguments,0,1),Nl("Query.get",n),this.Ov(this.Tv),new Promise(function(e,t){n&&"cache"===n.source?i.firestore.Yd().jd(i.Tv).then(function(t){e(new al(i.firestore,i.Tv,t,i.dv))},t):i.gv(e,t,n)})},hl.prototype.gv=function(e,n,i){var r=this.pv({includeMetadataChanges:!0,Ed:!0},{next:function(t){r(),t.metadata.fromCache&&i&&"server"===i.source?n(new Fi(Mi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},hl.prototype.Sv=function(t){if("string"==typeof t){if(""===t)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.Tv.Kn()&&-1!==t.indexOf("/"))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.Tv.path.child(tr.Y(t));if(!ir.nt(e))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Gr(this.firestore.zd,new ir(e))}if(t instanceof nl){var n=t;return Gr(this.firestore.zd,n.hv)}throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ah(t)+".")},hl.prototype.Ev=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},hl.prototype.Av=function(t){if(t instanceof jo){var e=[qo.ARRAY_CONTAINS,qo.ARRAY_CONTAINS_ANY],n=[qo.IN,qo.ARRAY_CONTAINS_ANY],i=0<=e.indexOf(t.op),r=0<=n.indexOf(t.op);if(t.Pn()){var o=this.Tv.On();if(null!==o&&!o.isEqual(t.field))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.Tv.Dn();null!==s&&this.Dv(t.field,s)}else if(r||i){var a=null;if(r&&(a=this.Tv.Yn(n)),null===a&&i&&(a=this.Tv.Yn(e)),null!=a)throw a===t.op?new Fi(Mi.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Fi(Mi.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+a.toString()+"' filters.")}}},hl.prototype.Iv=function(t){if(null===this.Tv.Dn()){var e=this.Tv.On();null!==e&&this.Dv(e,t.field)}},hl.prototype.Dv=function(t,e){if(!e.isEqual(t))throw new Fi(Mi.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},hl),al=(Object.defineProperty(ul.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(ul.prototype,"empty",{get:function(){return this.Pv.docs.M()},enumerable:!0,configurable:!0}),Object.defineProperty(ul.prototype,"size",{get:function(){return this.Pv.docs.size},enumerable:!0,configurable:!0}),ul.prototype.forEach=function(e,n){var i=this;mh("QuerySnapshot.forEach",arguments,1,2),gh("QuerySnapshot.forEach","function",1,e),this.Pv.docs.forEach(function(t){e.call(n,i.jv(t))})},Object.defineProperty(ul.prototype,"query",{get:function(){return new sl(this.Vv,this.fv,this.dv)},enumerable:!0,configurable:!0}),ul.prototype.docChanges=function(t){t&&(kh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Eh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Pv.di)throw new Fi(Mi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.kv&&this.Fv===e||(this.kv=function(r,e,o,s){if(o.ci.M()){var n,i=0;return o.docChanges.map(function(t){var e=new ol(r,t.doc.key,t.doc,o.fromCache,o.fi.has(t.doc.key),s);return Na(0===t.type,"Invalid event type for first snapshot"),Na(!n||o.query.Bn(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:i++}})}var a=o.ci;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new ol(r,t.doc.key,t.doc,o.fromCache,o.fi.has(t.doc.key),s),n=-1,i=-1;return 0!==t.type&&(Na(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),1!==t.type&&(i=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ta("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:i}})}(this.fv,e,this.Pv,this.dv),this.Fv=e),this.kv},ul.prototype.isEqual=function(t){if(!(t instanceof ul))throw Rh("isEqual","QuerySnapshot",1,t);return this.fv===t.fv&&this.Vv.isEqual(t.Vv)&&this.Pv.isEqual(t.Pv)&&this.dv===t.dv},ul.prototype.jv=function(t){return new ol(this.fv,t.key,t,this.metadata.fromCache,this.Pv.fi.has(t.key),this.dv)},ul);function ul(t,e,n,i){this.fv=t,this.Vv=e,this.Pv=n,this.dv=i,this.kv=null,this.Fv=null,this.metadata=new il(n.hasPendingWrites,n.fromCache)}function hl(t,e,n){this.Tv=t,this.firestore=e,this.dv=n}function cl(){return null!==Kc&&Kc.apply(this,arguments)||this}function ll(t,e,n,i,r,o){this.fv=t,this.hv=e,this.bv=n,this.yv=i,this._v=r,this.dv=o}function fl(t,e){this.hasPendingWrites=t,this.fromCache=e}function pl(t,e,n){this.hv=t,this.firestore=e,this.dv=n,this.Kd=this.firestore.Yd()}function dl(t){this.fv=t,this.vv=[],this.wv=!1}function yl(t,e){this.fv=t,this.lv=e}function vl(t,e,n){var i=this;if(void 0===n&&(n=new Ku),this.Jd=null,this.Hd=new Fa,this.INTERNAL={delete:function(){return c(i,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Yd(),[4,this.Kd.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this.Jd=r,this.zd=vl.Xd(r),this.$d=r.name,this.Zd=new qi(e)}else{var o=t;if(!o.projectId)throw new Fi(Mi.INVALID_ARGUMENT,"Must provide projectId");this.zd=new Oa(o.projectId,o.database),this.$d="[DEFAULT]",this.Zd=new xi}this.tv=n,this.nv=new $c({}),this.iv=this.ev(this.zd)}function ml(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Fi(Mi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else bh("settings","non-empty string","host",t.host),this.host=t.host,Eh("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(kh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Eh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Eh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Ea("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Ea("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,Eh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ja.Vs;else{if(t.cacheSizeBytes!==Jc&&t.cacheSizeBytes<Ja.Ds)throw new Fi(Mi.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ja.Ds);this.cacheSizeBytes=t.cacheSizeBytes}Eh("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function gl(t,e,n,i){this.firestore=t,this.timestampsInSnapshots=e,this.Md=n,this.converter=i}r(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(al.prototype.docChanges,t,{get:function(){return function(){throw new Fi(Mi.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var wl,bl=(t(El,wl=sl),Object.defineProperty(El.prototype,"id",{get:function(){return this.Tv.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(El.prototype,"parent",{get:function(){var t=this.Tv.path.L();return t.M()?null:new nl(new ir(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(El.prototype,"path",{get:function(){return this.Tv.path.H()},enumerable:!0,configurable:!0}),El.prototype.doc=function(t){if(mh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Aa.pr()),gh("CollectionReference.doc","non-empty string",1,t),""===t)throw new Fi(Mi.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=tr.Y(t);return nl.av(this.Tv.path.child(e),this.firestore,this.dv)},El.prototype.add=function(t){yh("CollectionReference.add",arguments,1),gh("CollectionReference.add","object",1,this.dv?this.dv.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},El.prototype.withConverter=function(t){return new El(this.Uv,this.firestore,t)},El);function El(t,e,n){var i=wl.call(this,xo.Nn(t),e,n)||this;if((i.Uv=t).length%2!=1)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.H()+" has "+t.length);return i}function Il(t,e){if(void 0===e)return{merge:!1};if(kh(t,e,["merge","mergeFields"]),Eh(t,"boolean","merge",e.merge),function(t,e,n,i,r){void 0!==i&&function(t,e,n,i,r){if(!(i instanceof Array))throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ah(i));for(var o=0;o<i.length;++o)if(!r(i[o]))throw new Fi(Mi.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Ah(i[o]))}(t,e,n,i,r)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof Mh}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Fi(Mi.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Tl(t,e){return void 0===e?{}:(kh(t,e,["serverTimestamps"]),Ih(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Nl(t,e){wh(t,"object",1,e),e&&(kh(t,e,["source"]),Ih(t,0,"source",e.source,["default","server","cache"]))}function Al(t,e,n){if(e instanceof nl){if(e.firestore!==n)throw new Fi(Mi.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Rh(t,"DocumentReference",1,e)}function Sl(t,e,n){var i;return t?(i=t.toFirestore(e),n="toFirestore() in "+n):i=e,[i,n]}function kl(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Rl,_l=Ch(Zc,"Use firebase.firestore() instead."),Dl=Ch(tl,"Use firebase.firestore().runTransaction() instead."),Ol=Ch(el,"Use firebase.firestore().batch() instead."),Cl=Ch(nl,"Use firebase.firestore().doc() instead."),Ll=Ch(rl),Vl=Ch(ol),Pl=Ch(sl),Ul=Ch(al),Ml=Ch(bl,"Use firebase.firestore().collection() instead."),Fl={Firestore:_l,GeoPoint:Zh,Timestamp:Ji,Blob:Uh,Transaction:Dl,WriteBatch:Ol,DocumentReference:Cl,DocumentSnapshot:Ll,Query:Pl,QueryDocumentSnapshot:Vl,QuerySnapshot:Ul,CollectionReference:Ml,FieldPath:Mh,FieldValue:$h,setLogLevel:Zc.setLogLevel,CACHE_SIZE_UNLIMITED:Jc},xl=(Jl.prototype.Af=function(t){},Jl.prototype.shutdown=function(){},Jl),ql=(Xl.prototype.Af=function(t){this.Bv.push(t)},Xl.prototype.shutdown=function(){window.removeEventListener("online",this.Lv),window.removeEventListener("offline",this.qv)},Xl.prototype.Qv=function(){window.addEventListener("online",this.Lv),window.addEventListener("offline",this.qv)},Xl.prototype.Mv=function(){ba("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Bv;t<e.length;t++)(0,e[t])(0)},Xl.prototype.xv=function(){ba("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Bv;t<e.length;t++)(0,e[t])(1)},Xl.xo=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Xl),jl=(Kl.prototype.lc=function(t){Na(!this.zv,"Called onOpen on stream twice!"),this.zv=t},Kl.prototype.oc=function(t){Na(!this.Jv,"Called onClose on stream twice!"),this.Jv=t},Kl.prototype.onMessage=function(t){Na(!this.Hv,"Called onMessage on stream twice!"),this.Hv=t},Kl.prototype.close=function(){this.Gv()},Kl.prototype.send=function(t){this.Wv(t)},Kl.prototype.Yv=function(){Na(void 0!==this.zv,"Cannot call onOpen because no callback was set"),this.zv()},Kl.prototype.Kv=function(t){Na(void 0!==this.Jv,"Cannot call onClose because no callback was set"),this.Jv(t)},Kl.prototype.Xv=function(t){Na(void 0!==this.Hv,"Cannot call onMessage because no callback was set"),this.Hv(t)},Kl),Gl={BatchGetDocuments:"batchGet",Commit:"commit"},Bl="gl-js/ fire/"+Pi,Hl=(Wl.prototype.Zv=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=Bl},Wl.prototype.Sc=function(u,i,r){var h=this,c=this.tw(u);return new Promise(function(o,s){var a=new Vi;a.listenOnce(Ci.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Oi.NO_ERROR:var t=a.getResponseJson();ba("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Oi.TIMEOUT:ba("Connection",'RPC "'+u+'" timed out'),s(new Fi(Mi.DEADLINE_EXCEEDED,"Request time out"));break;case Oi.HTTP_ERROR:var e=a.getStatus();if(ba("Connection",'RPC "'+u+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var i=(r=n.status.toLowerCase().replace("_","-"),0<=Object.values(Mi).indexOf(r)?r:Mi.UNKNOWN);s(new Fi(i,n.message))}else s(new Fi(Mi.UNKNOWN,"Server responded with status "+a.getStatus()))}else ba("Connection",'RPC "'+u+'" failed'),s(new Fi(Mi.UNAVAILABLE,"Connection failed."));break;default:Ta('RPC "'+u+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{ba("Connection",'RPC "'+u+'" completed.')}var r});var t=l({},i);delete t.database;var e=JSON.stringify(t);ba("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.Zv(n,r),a.send(c,"POST",e,n,15)})},Wl.prototype.Ac=function(t,e,n){return this.Sc(t,e,n)},Wl.prototype.dc=function(t,e){var n=[this.$v,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Di(),r={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ce.projectId+"/databases/"+this.ce.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Zv(r.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=d().indexOf("Electron/")||function(){var t=d();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=d().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(r.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}ba("Connection","Creating WebChannel: "+o+" "+r);var u=i.createWebChannel(o,r),a=!1,h=!1,c=new jl({Wv:function(t){h?ba("Connection","Not sending because WebChannel is closed:",t):(a||(ba("Connection","Opening WebChannel transport."),u.open(),a=!0),ba("Connection","WebChannel sending:",t),u.send(t))},Gv:function(){return u.close()}});return s(Li.EventType.OPEN,function(){h||ba("Connection","WebChannel transport opened.")}),s(Li.EventType.CLOSE,function(){h||(h=!0,ba("Connection","WebChannel transport closed"),c.Kv())}),s(Li.EventType.ERROR,function(t){h||(h=!0,ba("Connection","WebChannel transport errored:",t),c.Kv(new Fi(Mi.UNAVAILABLE,"The operation could not be completed")))}),s(Li.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];Na(!!n,"Got a webchannel message without data.");var i=n,r=i.error||(null===(e=i[0])||void 0===e?void 0:e.error);if(r){ba("Connection","WebChannel received error:",r);var o=r.status,s=function(){var t=so[o];if(void 0!==t)return Ds(t)}(),a=r.message;void 0===s&&(s=Mi.INTERNAL,a="Unknown error status: "+o+" with message "+r.message),h=!0,c.Kv(new Fi(s,a)),u.close()}else ba("Connection","WebChannel received:",n),c.Xv(n)}}),setTimeout(function(){c.Yv()},0),c},Wl.prototype.tw=function(t){var e=Gl[t];return Na(void 0!==e,"Unknown REST mapping for: "+t),this.$v+"/v1/projects/"+this.ce.projectId+"/databases/"+this.ce.database+"/documents:"+e},Wl),zl=window.crypto||window.__PRIVATE_msCrypto,Ql=(Object.defineProperty(Yl.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Yl.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Yl.prototype.Od=function(t){return Promise.resolve(new Hl(t))},Yl.prototype.Dd=function(){return ql.xo()?new ql:new xl},Yl.prototype.Vd=function(t){return new fa(t,{de:!0})},Yl.prototype.mr=function(t){return JSON.stringify(t)},Yl.prototype.atob=function(t){return atob(t)},Yl.prototype.btoa=function(t){return btoa(t)},Yl.prototype.randomBytes=function(t){if(t<=0)return new Uint8Array;var e=new Uint8Array(t);return zl.getRandomValues(e),e},Yl);function Yl(){this.de=!0,this.Ic="undefined"!=typeof atob}function Wl(t){this.ce=t.ce;var e=t.ssl?"https":"http";this.$v=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Kl(t){this.Wv=t.Wv,this.Gv=t.Gv}function Xl(){var t=this;this.Lv=function(){return t.Mv()},this.qv=function(){return t.xv()},this.Bv=[],this.Qv()}function Jl(){}ya.wr(new Ql),(Rl=$l).INTERNAL.registerComponent(new I("firestore",function(t){return function(t,e){return new Zc(t,e,new Ku)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(l({},Fl))),Rl.registerVersion("@firebase/firestore","1.13.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.memory.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.memory.js.map
